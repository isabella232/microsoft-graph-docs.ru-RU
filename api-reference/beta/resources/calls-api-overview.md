---
title: Работа с API звонков и собраний по сети в Microsoft Graph
description: API звонков и собраний по сети в Microsoft Graph добавляет новое измерение для взаимодействия приложений и служб с пользователями путем использования функций голоса и видео. API позволяет создавать звонки и принимать их от пользователей и приложений в Microsoft Teams. С помощью этих API можно создать приложение-службу (бот), которое может действовать как участник звонка или собрания.
author: VinodRavichandran
localization_priority: Priority
ms.prod: microsoft-teams
ms.openlocfilehash: a84900147679901ad45a19180c05f17246768479
ms.sourcegitcommit: 014eb3944306948edbb6560dbe689816a168c4f7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2019
ms.locfileid: "33328318"
---
# <a name="working-with-the-calls-and-online-meetings-api-in-microsoft-graph"></a><span data-ttu-id="56688-105">Работа с API звонков и собраний по сети в Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="56688-105">Working with the calls and online meetings API in Microsoft Graph</span></span>

[!INCLUDE [beta-disclaimer](../../includes/beta-disclaimer.md)]

<span data-ttu-id="56688-106">API звонков и собраний по сети в Microsoft Graph добавляет новое измерение для взаимодействия приложений и служб с пользователями путем использования функций голоса и видео.</span><span class="sxs-lookup"><span data-stu-id="56688-106">The Microsoft Graph calls and online meetings API adds a new dimension to how your apps and services can interact with users by enabling voice and video features.</span></span> <span data-ttu-id="56688-107">API позволяет создавать звонки и принимать их от пользователей и приложений в Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="56688-107">The API enables you to create calls and receive calls from users and applications in Microsoft Teams.</span></span> <span data-ttu-id="56688-108">С помощью этих API можно создать приложение-службу (бот), которое может действовать как участник звонка или собрания.</span><span class="sxs-lookup"><span data-stu-id="56688-108">You can use these APIs to build a service application (bot) that can act as a participant in a call or meeting.</span></span>

## <a name="call-types"></a><span data-ttu-id="56688-109">Типы звонков</span><span class="sxs-lookup"><span data-stu-id="56688-109">Call types</span></span>

<span data-ttu-id="56688-110">Звонки разделяются на одноранговые и многопользовательские.</span><span class="sxs-lookup"><span data-stu-id="56688-110">Calls are categorized as peer-to-peer or multiparty calls.</span></span> <span data-ttu-id="56688-111">Пользователь может инициировать одноранговый звонок с помощью вашего бота или пригласить бота в существующую многопользовательскую конференцию.</span><span class="sxs-lookup"><span data-stu-id="56688-111">A user can initiate a peer-to-peer call with your bot or invite your bot into an existing multiparty conference.</span></span> <span data-ttu-id="56688-112">Если пользователь приглашает бота в одноранговый звонок, разрешения не требуются.</span><span class="sxs-lookup"><span data-stu-id="56688-112">No permissions are necessary when the user is inviting the bot to a peer-to-peer call.</span></span> <span data-ttu-id="56688-113">Чтобы ваш бот мог участвовать в многопользовательском звонке, ему необходимо разрешение администратора клиента на присоединение к групповому звонку.</span><span class="sxs-lookup"><span data-stu-id="56688-113">For your bot to participate in a multiparty call, the bot needs to have permission from the tenant administrator to join a group call.</span></span>

![Изображение однорангового и многопользовательского звонков](https://cdn.graph.office.net/prod/GraphDocuments/en-us/concepts/images/call-types.png)

<span data-ttu-id="56688-115">Если ваш бот создает звонок, у него должно быть разрешение на инициацию или инициацию группового звонка.</span><span class="sxs-lookup"><span data-stu-id="56688-115">If your bot is creating the call, it needs to have either the initiate or the initiate-group-call permission.</span></span> <span data-ttu-id="56688-116">У вашего бота есть возможность создать одноранговый звонок или многопользовательский звонок.</span><span class="sxs-lookup"><span data-stu-id="56688-116">Your bot has the option to create a peer-to-peer call or a multiparty call.</span></span>

- <span data-ttu-id="56688-117">Для однорангового звонка бот должен указать только один целевой объект без координат собрания.</span><span class="sxs-lookup"><span data-stu-id="56688-117">For a peer-to-peer call, the bot needs to specify only one target and no meeting coordinates.</span></span> 
- <span data-ttu-id="56688-118">Если ваш бот инициирует звонок с несколькими участниками, в фоновом режиме настраивается незапланированное собрание и все присоединяются к этой конференции.</span><span class="sxs-lookup"><span data-stu-id="56688-118">If your bot initiates a call with multiple participants, an ad hoc meeting is set up behind the scenes and everyone joins that conference.</span></span> <span data-ttu-id="56688-119">Если указаны координаты собрания, настраивается многопользовательский звонок, даже если существует только один целевой объект.</span><span class="sxs-lookup"><span data-stu-id="56688-119">If meeting coordinates are specified, a multiparty call is set up even if there is only one target.</span></span>

<span data-ttu-id="56688-120">Звонок может начаться как одноранговый и расшириться до многопользовательского.</span><span class="sxs-lookup"><span data-stu-id="56688-120">A call might start as peer-to-peer and escalate to multiparty.</span></span> <span data-ttu-id="56688-121">Конференция подготавливается автоматически, и в нее перенаправляется мультимедийный контент.</span><span class="sxs-lookup"><span data-stu-id="56688-121">A conference is provisioned automatically and the media is retargeted to the conference.</span></span> <span data-ttu-id="56688-122">Ваш бот может запустить расширение, пригласив других пользователей, при условии наличия разрешения на инициацию группового звонка.</span><span class="sxs-lookup"><span data-stu-id="56688-122">Your bot can initiate escalation by inviting others, provided your bot has the initiate-group-call permission.</span></span> <span data-ttu-id="56688-123">Если расширение инициировано другим участником, а у бота нет разрешения на присоединение к групповому звонку, бот исключается из звонка.</span><span class="sxs-lookup"><span data-stu-id="56688-123">If escalation is initiated by another participant and the bot does not have join-group-call permission, your bot is dropped from the call.</span></span>

> <span data-ttu-id="56688-124">**Важно!** Если звонок расширяется с однорангового до многопользовательского, доступны не все многопользовательские функции.</span><span class="sxs-lookup"><span data-stu-id="56688-124">**Important:** When a call is escalated from peer-to-peer to multiparty, not all multiparty features are available.</span></span> <span data-ttu-id="56688-125">В частности, бот не будет получать обновления состава.</span><span class="sxs-lookup"><span data-stu-id="56688-125">Specifically, the bot will not receive roster updates.</span></span>

## <a name="signaling"></a><span data-ttu-id="56688-126">Передача сигналов</span><span class="sxs-lookup"><span data-stu-id="56688-126">Signaling</span></span>

### <a name="incoming-call"></a><span data-ttu-id="56688-127">Входящий звонок</span><span class="sxs-lookup"><span data-stu-id="56688-127">Incoming call</span></span>

<span data-ttu-id="56688-128">Для получения входящего звонка необходимо зарегистрировать бота звонков.</span><span class="sxs-lookup"><span data-stu-id="56688-128">To receive an incoming call, you need to register the calling bot.</span></span> <span data-ttu-id="56688-129">Когда бот получает уведомление о входящем звонке, у него есть указанные ниже возможности.</span><span class="sxs-lookup"><span data-stu-id="56688-129">When the bot receives the incoming notification, it has the following options.</span></span>

| <span data-ttu-id="56688-130">Метод</span><span class="sxs-lookup"><span data-stu-id="56688-130">Method</span></span>                              | <span data-ttu-id="56688-131">Описание</span><span class="sxs-lookup"><span data-stu-id="56688-131">Description</span></span>                                  |
|:------------------------------------|:---------------------------------------------|
| [<span data-ttu-id="56688-132">Ответ</span><span class="sxs-lookup"><span data-stu-id="56688-132">Answer</span></span>](../api/call-answer.md)     | <span data-ttu-id="56688-133">Ответ на входящий звонок.</span><span class="sxs-lookup"><span data-stu-id="56688-133">Answer the incoming call.</span></span>                    |
| [<span data-ttu-id="56688-134">Отклонение</span><span class="sxs-lookup"><span data-stu-id="56688-134">Reject</span></span>](../api/call-reject.md)     | <span data-ttu-id="56688-135">Отклонение и завершение звонка.</span><span class="sxs-lookup"><span data-stu-id="56688-135">Reject and hangup the call.</span></span>                  |
| [<span data-ttu-id="56688-136">Перенаправление</span><span class="sxs-lookup"><span data-stu-id="56688-136">Redirect</span></span>](../api/call-redirect.md) | <span data-ttu-id="56688-137">Перенаправление звонка.</span><span class="sxs-lookup"><span data-stu-id="56688-137">Redirect the call.</span></span>                           |

<span data-ttu-id="56688-138">Бот может перенаправлять звонок другому пользователю или боту.</span><span class="sxs-lookup"><span data-stu-id="56688-138">The bot can redirect the call to another user or a bot.</span></span> <span data-ttu-id="56688-139">Бот также может перенаправить его в голосовую почту пользователя.</span><span class="sxs-lookup"><span data-stu-id="56688-139">The bot can also redirect it to a user's voicemail.</span></span>

![Изображение бота, перенаправляющего звонок в голосовую почту](https://cdn.graph.office.net/prod/GraphDocuments/en-us/concepts/images/call-handling.png)

> <span data-ttu-id="56688-141">**Важно!** Перенаправление или выполнение исходящих звонков в ТСОП в настоящее время не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="56688-141">**Important:** Redirecting or making outbound calls to PSTN is currently not supported.</span></span>

### <a name="in-call"></a><span data-ttu-id="56688-142">Входящий звонок</span><span class="sxs-lookup"><span data-stu-id="56688-142">In-call</span></span>

<span data-ttu-id="56688-143">Для бота доступны операции над объектом call.</span><span class="sxs-lookup"><span data-stu-id="56688-143">Operations for the bot are available on the call object.</span></span> <span data-ttu-id="56688-144">Они влияют на бота, как на участника звонка.</span><span class="sxs-lookup"><span data-stu-id="56688-144">These affect the bot as the participant in the call.</span></span>

| <span data-ttu-id="56688-145">Метод</span><span class="sxs-lookup"><span data-stu-id="56688-145">Method</span></span>                                                            | <span data-ttu-id="56688-146">Описание</span><span class="sxs-lookup"><span data-stu-id="56688-146">Description</span></span>                                  |
|:------------------------------------------------------------------|:---------------------------------------------|
| [<span data-ttu-id="56688-147">Отключение звука</span><span class="sxs-lookup"><span data-stu-id="56688-147">Mute</span></span>](../api/call-mute.md)                                       | <span data-ttu-id="56688-148">Отключение своего звука в звонке.</span><span class="sxs-lookup"><span data-stu-id="56688-148">Mute self in the call.</span></span>                       |
| [<span data-ttu-id="56688-149">Включение звука</span><span class="sxs-lookup"><span data-stu-id="56688-149">Unmute</span></span>](../api/call-unmute.md)                                   | <span data-ttu-id="56688-150">Включение своего звука в звонке.</span><span class="sxs-lookup"><span data-stu-id="56688-150">Unmute self in the call.</span></span>                     |
| [<span data-ttu-id="56688-151">UpdateMetadata</span><span class="sxs-lookup"><span data-stu-id="56688-151">UpdateMetadata</span></span>](../api/call-updatemetadata.md)                   | <span data-ttu-id="56688-152">Обновление метаданных для себя в списке.</span><span class="sxs-lookup"><span data-stu-id="56688-152">Update metadata for self in roster.</span></span>          |
| [<span data-ttu-id="56688-153">ChangeScreenSharingRole</span><span class="sxs-lookup"><span data-stu-id="56688-153">ChangeScreenSharingRole</span></span>](../api/call-changescreensharingrole.md) | <span data-ttu-id="56688-154">Начало и прекращение демонстрации экрана в звонке.</span><span class="sxs-lookup"><span data-stu-id="56688-154">Start and stop sharing screen in the call.</span></span>   |

<span data-ttu-id="56688-155">Чтобы взаимодействовать с другими участниками звонка, используйте объект participants.</span><span class="sxs-lookup"><span data-stu-id="56688-155">To interact with other participants on the call, use the participants object.</span></span>

| <span data-ttu-id="56688-156">Метод</span><span class="sxs-lookup"><span data-stu-id="56688-156">Method</span></span>                                                            | <span data-ttu-id="56688-157">Описание</span><span class="sxs-lookup"><span data-stu-id="56688-157">Description</span></span>                                  |
|:------------------------------------------------------------------|:---------------------------------------------|
| [<span data-ttu-id="56688-158">Перечисление участников</span><span class="sxs-lookup"><span data-stu-id="56688-158">List participants</span></span>](../api/call-list-participants.md)             | <span data-ttu-id="56688-159">Получение коллекции объектов participant.</span><span class="sxs-lookup"><span data-stu-id="56688-159">Get a participant object collection.</span></span>         |
| [<span data-ttu-id="56688-160">Приглашение участников</span><span class="sxs-lookup"><span data-stu-id="56688-160">Invite Participants</span></span>](../api/participant-invite.md)               | <span data-ttu-id="56688-161">Приглашение участников в активный звонок.</span><span class="sxs-lookup"><span data-stu-id="56688-161">Invite participants to the active call.</span></span>      |
| [<span data-ttu-id="56688-162">Отключение звука всех участников</span><span class="sxs-lookup"><span data-stu-id="56688-162">Mute All Participants</span></span>](../api/participant-muteall.md)            | <span data-ttu-id="56688-163">Отключение звука всех участников звонка.</span><span class="sxs-lookup"><span data-stu-id="56688-163">Mute all participants in the call.</span></span>           |

## <a name="media"></a><span data-ttu-id="56688-164">Мультимедиа</span><span class="sxs-lookup"><span data-stu-id="56688-164">Media</span></span>

<span data-ttu-id="56688-165">Обработка мультимедиа осуществляется с помощью платформы мультимедиа в реальном времени Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="56688-165">Media processing is managed through the Microsoft Real-time Media Platform.</span></span> <span data-ttu-id="56688-166">Платформа мультимедиа в реальном времени помогает ботам участвовать в аудио- и видеозвонках и собраниях Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="56688-166">The Real-time Media Platform helps bots engage in Microsoft Teams audio/video calls and meetings.</span></span> <span data-ttu-id="56688-167">Она позволяет ботам в режиме реального времени участвовать в одноранговых и многопользовательских звонках.</span><span class="sxs-lookup"><span data-stu-id="56688-167">It allows real-time bots to participate in both peer-to-peer and multiparty calls.</span></span>

<span data-ttu-id="56688-168">Когда бот отвечает на входящий звонок или присоединяется к новому или существующему звонку, он должен сообщить платформе мультимедиа в реальном времени, как будет обрабатываться мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="56688-168">When the bot answers an incoming call, or joins a new or existing call, it needs to tell the Real-time Media Platform how media will be handled.</span></span> <span data-ttu-id="56688-169">При создании системы интерактивного голосового ответа (IVR) можно отказаться от дорогостоящей обработки аудио в пользу мультимедиа компонентов, размещаемых в службе Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="56688-169">If you are building an Interactive Voice Response (IVR) system, you can offload the expensive audio processing to Microsoft service hosted media components.</span></span> <span data-ttu-id="56688-170">Если боту требуется прямой доступ к потокам мультимедиа, мы предлагаем вариант размещения мультимедиа в приложении с помощью SDK мультимедиа в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="56688-170">If your bot requires direct access to media streams, we offer an application-hosted media option through the Real-time Media SDK.</span></span>

### <a name="service-hosted-media"></a><span data-ttu-id="56688-171">Мультимедиа, размещенные в службе</span><span class="sxs-lookup"><span data-stu-id="56688-171">Service-hosted media</span></span>

<span data-ttu-id="56688-172">Боты могут управлять рабочим процессом и перенести обработку звука в платформу мультимедиа в реальном времени Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="56688-172">Bots can manage the workflow and offload audio processing to the Microsoft Real-time Media Platform.</span></span> <span data-ttu-id="56688-173">При размещении мультимедиа в службе существует несколько вариантов реализации и размещения вашего бота.</span><span class="sxs-lookup"><span data-stu-id="56688-173">With service-hosted media, you have serveral options to implement and host your bot.</span></span> <span data-ttu-id="56688-174">Рекомендуется использовать один из доступных пакетов [SDK](https://developer.microsoft.com/graph/code-samples-and-sdks).</span><span class="sxs-lookup"><span data-stu-id="56688-174">Consider using one of the available [SDKs](https://developer.microsoft.com/graph/code-samples-and-sdks).</span></span> <span data-ttu-id="56688-175">Бот для мультимедийного содержимого, размещенного в службе, можно реализовать в виде службы без отслеживания состояния, так как он не обрабатывает мультимедиа в локальном расположении.</span><span class="sxs-lookup"><span data-stu-id="56688-175">A service-hosted media bot can be implemented as a stateless service as it does not process media locally.</span></span>

| <span data-ttu-id="56688-176">Метод</span><span class="sxs-lookup"><span data-stu-id="56688-176">Method</span></span>                                                        | <span data-ttu-id="56688-177">Описание</span><span class="sxs-lookup"><span data-stu-id="56688-177">Description</span></span>                                             |
|:--------------------------------------------------------------|:--------------------------------------------------------|
| [<span data-ttu-id="56688-178">PlayPrompt</span><span class="sxs-lookup"><span data-stu-id="56688-178">PlayPrompt</span></span>](../api/call-playprompt.md)                       | <span data-ttu-id="56688-179">Воспроизведение аудиоклипа для пользователя.</span><span class="sxs-lookup"><span data-stu-id="56688-179">Play an audio clip to the user.</span></span>                         |
| [<span data-ttu-id="56688-180">Запись</span><span class="sxs-lookup"><span data-stu-id="56688-180">Record</span></span>](../api/call-record.md)                               | <span data-ttu-id="56688-181">Необязательное воспроизведение запроса и запись аудиоклипа.</span><span class="sxs-lookup"><span data-stu-id="56688-181">Optionally play a prompt and record an audio clip.</span></span>      |
| [<span data-ttu-id="56688-182">SubscribeToTone</span><span class="sxs-lookup"><span data-stu-id="56688-182">SubscribeToTone</span></span>](../api/call-subscribetotone.md)             | <span data-ttu-id="56688-183">Подписка на тоны DTMF от имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="56688-183">Subscribe to DTMF tones from the user.</span></span>                  |
| [<span data-ttu-id="56688-184">CancelMediaProcessing</span><span class="sxs-lookup"><span data-stu-id="56688-184">CancelMediaProcessing</span></span>](../api/call-cancelmediaprocessing.md) | <span data-ttu-id="56688-185">Отмена всей обработки мультимедиа, находящейся в очереди.</span><span class="sxs-lookup"><span data-stu-id="56688-185">Cancel any media processing already queued.</span></span>             |

### <a name="application-hosted-media"></a><span data-ttu-id="56688-186">Мультимедиа, размещенные в приложении</span><span class="sxs-lookup"><span data-stu-id="56688-186">Application-hosted media</span></span>

<span data-ttu-id="56688-187">Чтобы бот получил прямой доступ к мультимедиа, ему требуется разрешение Access-Media.</span><span class="sxs-lookup"><span data-stu-id="56688-187">For the bot to get direct access to the media, the bot needs the Access-Media permission.</span></span> <span data-ttu-id="56688-188">Библиотека мультимедиа в реальном времени и пакеты SDK с отслеживанием состояния помогут вам создавать ботов звонков с широкими возможностями работы с мультимедиа в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="56688-188">The Real-time Media library and the stateful SDK helps you build rich real-time media calling bots.</span></span> <span data-ttu-id="56688-189">Бот, размещенный в приложении, должен располагаться в среде Windows.</span><span class="sxs-lookup"><span data-stu-id="56688-189">An application-hosted bot must be hosted in a Windows environment.</span></span> <span data-ttu-id="56688-190">[Примеры мультимедиа, размещенных в приложении](https://github.com/microsoftgraph/microsoft-graph-comms-samples), демонстрируют, как создать бота на разных платформах Azure (включая облачные службы и Service Fabric).</span><span class="sxs-lookup"><span data-stu-id="56688-190">[Application hosted media samples](https://github.com/microsoftgraph/microsoft-graph-comms-samples) show how to build the bot in various Azure Platforms (including Cloud Services and Service Fabric).</span></span>

<span data-ttu-id="56688-191">Для упрощения создания ботов можно использовать [пакет SDK звонков Microsoft Graph](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/articles/index.html).</span><span class="sxs-lookup"><span data-stu-id="56688-191">You can use the [Microsoft Graph Calls SDK](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/articles/index.html) to simplify the creation of bots.</span></span> <span data-ttu-id="56688-192">Пакет SDK предоставляет функции для управления состояниями ресурсов в памяти и получения стека мультимедиа разработчиков бота.</span><span class="sxs-lookup"><span data-stu-id="56688-192">The SDK provides functionality to manage the states of the resources in memory and to pull in bot developers' media stack.</span></span>

<span data-ttu-id="56688-193">Пакет SDK мультимедиа позволяет боту отправлять и получать аудио и видеоконтент, а также содержимое при демонстрации экрана с видеоизображением.</span><span class="sxs-lookup"><span data-stu-id="56688-193">The Media SDK allows the bot to send and receive audio, video, and video-based screen sharing content.</span></span> <span data-ttu-id="56688-194">Демонстрация экрана с видеоизображением моделируется как видеоканал.</span><span class="sxs-lookup"><span data-stu-id="56688-194">Video-based screen sharing is modeled as a video channel.</span></span> <span data-ttu-id="56688-195">Бот может подписаться на смешанный звуковой канал и несколько видеоканалов.</span><span class="sxs-lookup"><span data-stu-id="56688-195">The bot can subscribe to the mixed audio channel and multiple video channels.</span></span> <span data-ttu-id="56688-196">В случае видеоканала бот может выбрать отправку и получение видео в виде зашифрованного потока H.264 или в виде раскодированных необработанных кадров.</span><span class="sxs-lookup"><span data-stu-id="56688-196">For the video channel, the bot has a choice to send and receive video as an encoded H.264 stream or as decoded raw frames.</span></span>

> <span data-ttu-id="56688-197">**Примечание.** Вы не можете использовать API Microsoft.Graph.Calls.Media для записи. В противном случае сохраняется мультимедийное содержимое звонков или собраний, к которым получает доступ ваш бот.</span><span class="sxs-lookup"><span data-stu-id="56688-197">**Note:** You may not use the Microsoft.Graph.Calls.Media API to record or otherwise persist media content from calls or meetings that your bot accesses.</span></span>

## <a name="see-also"></a><span data-ttu-id="56688-198">См. также</span><span class="sxs-lookup"><span data-stu-id="56688-198">See also</span></span>

[<span data-ttu-id="56688-199">Примеры API звонков и собраний по сети</span><span class="sxs-lookup"><span data-stu-id="56688-199">Calls and online meetings API samples</span></span>](https://github.com/microsoftgraph/microsoft-graph-comms-samples/)

[<span data-ttu-id="56688-200">Известные проблемы</span><span class="sxs-lookup"><span data-stu-id="56688-200">Known issues</span></span>](/graph/known-issues#calls-and-online-meetings)
