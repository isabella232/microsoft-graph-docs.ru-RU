---
title: Работа с API звонков и собраний по сети в Microsoft Graph
description: API звонков и собраний по сети в Microsoft Graph добавляет новое измерение для взаимодействия приложений и служб с пользователями путем использования функций голоса и видео. API позволяет создавать звонки и принимать их от пользователей и приложений в Microsoft Teams. С помощью этих API можно создать приложение-службу (бот), которое может действовать как участник звонка или собрания.
author: VinodRavichandran
localization_priority: Priority
ms.prod: microsoft-teams
doc_type: conceptualPageType
ms.openlocfilehash: dea588035e2f19361a36450bb49b4c5b2d9391b5
ms.sourcegitcommit: 2c62457e57467b8d50f21b255b553106a9a5d8d6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/31/2019
ms.locfileid: "36013012"
---
# <a name="working-with-the-calls-and-online-meetings-api-in-microsoft-graph"></a>Работа с API звонков и собраний по сети в Microsoft Graph

[!INCLUDE [beta-disclaimer](../../includes/beta-disclaimer.md)]

API звонков и собраний по сети в Microsoft Graph добавляет новое измерение для взаимодействия приложений и служб с пользователями путем использования функций голоса и видео. API позволяет создавать звонки и принимать их от пользователей и приложений в Microsoft Teams. С помощью этих API можно создать приложение-службу (бот), которое может действовать как участник звонка или собрания.

## <a name="call-types"></a>Типы звонков

Звонки разделяются на одноранговые и многопользовательские. Пользователь может инициировать одноранговый звонок с помощью вашего бота или пригласить бота в существующую многопользовательскую конференцию. Если пользователь приглашает бота в одноранговый звонок, разрешения не требуются. Чтобы ваш бот мог участвовать в многопользовательском звонке, ему необходимо разрешение администратора клиента на присоединение к групповому звонку.

![Изображение однорангового и многопользовательского звонков](https://cdn.graph.office.net/prod/GraphDocuments/en-us/concepts/images/call-types.png)

Если ваш бот создает звонок, у него должно быть разрешение на инициацию или инициацию группового звонка. У вашего бота есть возможность создать одноранговый звонок или многопользовательский звонок.

- Для однорангового звонка бот должен указать только один целевой объект без координат собрания. 
- Если ваш бот инициирует звонок с несколькими участниками, в фоновом режиме настраивается незапланированное собрание и все присоединяются к этой конференции. Если указаны координаты собрания, настраивается многопользовательский звонок, даже если существует только один целевой объект.

Звонок может начаться как одноранговый и расшириться до многопользовательского. Конференция подготавливается автоматически, и в нее перенаправляется мультимедийный контент. Ваш бот может запустить расширение, пригласив других пользователей, при условии наличия разрешения на инициацию группового звонка. Если расширение инициировано другим участником, а у бота нет разрешения на присоединение к групповому звонку, бот исключается из звонка.

> **Важно!** Если звонок расширяется с однорангового до многопользовательского, доступны не все многопользовательские функции. В частности, бот не будет получать обновления состава.

## <a name="signaling"></a>Передача сигналов

### <a name="incoming-call"></a>Входящий звонок

Для получения входящего звонка необходимо зарегистрировать бота звонков. Когда бот получает уведомление о входящем звонке, у него есть указанные ниже возможности.

| Метод                              | Описание                                  |
|:------------------------------------|:---------------------------------------------|
| [Ответ](../api/call-answer.md)     | Ответ на входящий звонок.                    |
| [Отклонение](../api/call-reject.md)     | Отклонение и завершение звонка.                  |
| [Перенаправление](../api/call-redirect.md) | Перенаправление звонка.                           |

Бот может перенаправлять звонок другому пользователю или боту. Бот также может перенаправить его в голосовую почту пользователя.

![Изображение бота, перенаправляющего звонок в голосовую почту](https://cdn.graph.office.net/prod/GraphDocuments/en-us/concepts/images/call-handling.png)

> **Важно!** Перенаправление или выполнение исходящих звонков в ТСОП в настоящее время не поддерживается.

### <a name="in-call"></a>Входящий звонок

Для бота доступны операции над объектом call. Они влияют на бота, как на участника звонка.

| Метод                                                            | Описание                                  |
|:------------------------------------------------------------------|:---------------------------------------------|
| [Отключение звука](../api/call-mute.md)                                       | Отключение своего звука в звонке.                       |
| [Включение звука](../api/call-unmute.md)                                   | Включение своего звука в звонке.                     |
| [UpdateMetadata](../api/call-updatemetadata.md)                   | Обновление метаданных для себя в списке.          |
| [ChangeScreenSharingRole](../api/call-changescreensharingrole.md) | Начало и прекращение демонстрации экрана в звонке.   |

Чтобы взаимодействовать с другими участниками звонка, используйте объект participants.

| Метод                                                            | Описание                                  |
|:------------------------------------------------------------------|:---------------------------------------------|
| [Перечисление участников](../api/call-list-participants.md)             | Получение коллекции объектов participant.         |
| [Приглашение участников](../api/participant-invite.md)               | Приглашение участников в активный звонок.      |
| [Отключение звука всех участников](../api/participant-muteall.md)            | Отключение звука всех участников звонка.           |

## <a name="media"></a>Мультимедиа

Обработка мультимедиа осуществляется с помощью платформы мультимедиа в реальном времени Майкрософт. Платформа мультимедиа в реальном времени помогает ботам участвовать в аудио- и видеозвонках и собраниях Microsoft Teams. Она позволяет ботам в режиме реального времени участвовать в одноранговых и многопользовательских звонках.

Когда бот отвечает на входящий звонок или присоединяется к новому или существующему звонку, он должен сообщить платформе мультимедиа в реальном времени, как будет обрабатываться мультимедиа. При создании системы интерактивного голосового ответа (IVR) можно отказаться от дорогостоящей обработки аудио в пользу мультимедиа компонентов, размещаемых в службе Майкрософт. Если боту требуется прямой доступ к потокам мультимедиа, мы предлагаем вариант размещения мультимедиа в приложении с помощью SDK мультимедиа в реальном времени.

### <a name="service-hosted-media"></a>Мультимедиа, размещенные в службе

Боты могут управлять рабочим процессом и перенести обработку звука в платформу мультимедиа в реальном времени Майкрософт. При размещении мультимедиа в службе существует несколько вариантов реализации и размещения вашего бота. Рекомендуется использовать один из доступных пакетов [SDK](https://developer.microsoft.com/graph/code-samples-and-sdks). Бот для мультимедийного содержимого, размещенного в службе, можно реализовать в виде службы без отслеживания состояния, так как он не обрабатывает мультимедиа в локальном расположении.

| Метод                                                        | Описание                                             |
|:--------------------------------------------------------------|:--------------------------------------------------------|
| [PlayPrompt](../api/call-playprompt.md)                       | Воспроизведение аудиоклипа для пользователя.                         |
| [Запись](../api/call-record.md)                               | Необязательное воспроизведение запроса и запись аудиоклипа.      |
| [SubscribeToTone](../api/call-subscribetotone.md)             | Подписка на тоны DTMF от имени пользователя.                  |
| [CancelMediaProcessing](../api/call-cancelmediaprocessing.md) | Отмена всей обработки мультимедиа, находящейся в очереди.             |

### <a name="application-hosted-media"></a>Мультимедиа, размещенные в приложении

Чтобы бот получил прямой доступ к мультимедиа, ему требуется разрешение Access-Media. Библиотека мультимедиа в реальном времени и пакеты SDK с отслеживанием состояния помогут вам создавать ботов звонков с широкими возможностями работы с мультимедиа в режиме реального времени. Бот, размещенный в приложении, должен располагаться в среде Windows. [Примеры мультимедиа, размещенных в приложении](https://github.com/microsoftgraph/microsoft-graph-comms-samples), демонстрируют, как создать бота на разных платформах Azure (включая облачные службы и Service Fabric).

Для упрощения создания ботов можно использовать [пакет SDK звонков Microsoft Graph](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/articles/index.html). Пакет SDK предоставляет функции для управления состояниями ресурсов в памяти и получения стека мультимедиа разработчиков бота.

Пакет SDK мультимедиа позволяет боту отправлять и получать аудио и видеоконтент, а также содержимое при демонстрации экрана с видеоизображением. Демонстрация экрана с видеоизображением моделируется как видеоканал. Бот может подписаться на смешанный звуковой канал и несколько видеоканалов. В случае видеоканала бот может выбрать отправку и получение видео в виде зашифрованного потока H.264 или в виде раскодированных необработанных кадров.

> **Примечание.** Вы не можете использовать API Microsoft.Graph.Calls.Media для записи. В противном случае сохраняется мультимедийное содержимое звонков или собраний, к которым получает доступ ваш бот.

## <a name="see-also"></a>См. также

[Примеры API звонков и собраний по сети](https://github.com/microsoftgraph/microsoft-graph-comms-samples/)

[Известные проблемы](/graph/known-issues#calls-and-online-meetings)
