---
title: Использование API Поиска (Майкрософт) для запросов данных
description: С помощью API поиска приложения могут искать данные Microsoft 365 в контексте пользователя, прошедшего проверку подлинности.
localization_priority: Priority
author: nmoreau
ms.prod: search
doc_type: resourcePageType
ms.openlocfilehash: b363031992b58808d79747cdd122d56a98ebdb77
ms.sourcegitcommit: 366178d3fc37439791061082da80a63fba2c27df
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2020
ms.locfileid: "48921804"
---
# <a name="use-the-microsoft-search-api-to-query-data"></a><span data-ttu-id="2e347-103">Использование API Поиска (Майкрософт) для запросов данных</span><span class="sxs-lookup"><span data-stu-id="2e347-103">Use the Microsoft Search API to query data</span></span>

[!INCLUDE [beta-disclaimer](../../includes/beta-disclaimer.md)]

<span data-ttu-id="2e347-104">Вы можете использовать API Поиска (Майкрософт) для запроса данных Microsoft 365 в своих приложениях.</span><span class="sxs-lookup"><span data-stu-id="2e347-104">You can use the Microsoft Search API to query Microsoft 365 data in your apps.</span></span>

<span data-ttu-id="2e347-105">Поисковые запросы выполняются в контексте вошедшего пользователя, указанного [маркером доступа с делегированными разрешениями](/graph/auth-v2-user).</span><span class="sxs-lookup"><span data-stu-id="2e347-105">Search requests run in the context of the signed-in user, identified using an [access token with delegated permissions](/graph/auth-v2-user).</span></span>

[!INCLUDE [search-api-deprecation](../../includes/search-api-deprecation.md)]

## <a name="common-use-cases"></a><span data-ttu-id="2e347-106">Основные варианты использования</span><span class="sxs-lookup"><span data-stu-id="2e347-106">Common use cases</span></span>

<span data-ttu-id="2e347-107">API Microsoft Search предоставляет метод [query](../api/search-query.md) для поиска по данным в Microsoft Search; в этот метод передается [searchRequest](searchRequest.md) в теле запроса, определяя характер поиска.</span><span class="sxs-lookup"><span data-stu-id="2e347-107">The Microsoft Search API provides a [query](../api/search-query.md) method to search across your data in Microsoft Search, where you pass a [searchRequest](searchRequest.md) in the request body, defining the specifics of your search.</span></span>

<span data-ttu-id="2e347-108">В этом разделе перечислены распространенные варианты использования метода **query** с применением свойств и параметров, заданных в тексте запроса **query** [searchRequest](searchRequest.md).</span><span class="sxs-lookup"><span data-stu-id="2e347-108">This section lists the common use cases of the **query** method, based on the properties and parameters you set in the **query** [searchRequest](searchRequest.md) body.</span></span>

<span data-ttu-id="2e347-p101">Поисковые запросы выполняются от имени пользователя. Результаты поиска ограничиваются для применения правил контроля доступа к элементам. Например, в контексте файлов разрешения для них оцениваются в составе поискового запроса. Пользователь не может обратиться в результатах поиска к большему количеству элементов, чем он мог бы получить из соответствующей операции GET с теми же разрешениями и управлением доступом.</span><span class="sxs-lookup"><span data-stu-id="2e347-p101">Search requests run on behalf of the user. Search results are scoped to enforce any access control applied to the items.  For example, in the context of files, permissions on the files are evaluated as part of the search request. Users cannot access more items in a search than they can otherwise obtain from a corresponding GET operation with the same permissions and access control.</span></span>

| <span data-ttu-id="2e347-113">Варианты использования</span><span class="sxs-lookup"><span data-stu-id="2e347-113">Use cases</span></span> | <span data-ttu-id="2e347-114">Свойства, определяемые в тексте запроса query</span><span class="sxs-lookup"><span data-stu-id="2e347-114">Properties to define in the query request body</span></span> |
|:------------------|:---------|
|[<span data-ttu-id="2e347-115">Результаты поиска в области по типам объектов</span><span class="sxs-lookup"><span data-stu-id="2e347-115">Scope search results based on entity types</span></span>](#scope-search-based-on-entity-types)| <span data-ttu-id="2e347-116">**entityTypes**</span><span class="sxs-lookup"><span data-stu-id="2e347-116">**entityTypes**</span></span> |
|[<span data-ttu-id="2e347-117">Результаты со страницы</span><span class="sxs-lookup"><span data-stu-id="2e347-117">Page results</span></span>](#page-search-results) | <span data-ttu-id="2e347-118">**from** и **size**</span><span class="sxs-lookup"><span data-stu-id="2e347-118">**from** and **size**</span></span> |
|[<span data-ttu-id="2e347-119">Получение наиболее релевантных электронных писем</span><span class="sxs-lookup"><span data-stu-id="2e347-119">Get the most relevant emails</span></span>](#get-the-most-relevant-emails) | <span data-ttu-id="2e347-120">**enableTopResults**</span><span class="sxs-lookup"><span data-stu-id="2e347-120">**enableTopResults**</span></span> |
|[<span data-ttu-id="2e347-121">Получение выбранных свойств</span><span class="sxs-lookup"><span data-stu-id="2e347-121">Get selected properties</span></span>](#get-selected-properties) | <span data-ttu-id="2e347-122">**fields**</span><span class="sxs-lookup"><span data-stu-id="2e347-122">**fields**</span></span> |
|[<span data-ttu-id="2e347-123">Использование KQL в терминах запросов</span><span class="sxs-lookup"><span data-stu-id="2e347-123">Use KQL in query terms</span></span>](#keyword-query-language-kql-support) | <span data-ttu-id="2e347-124">**query**</span><span class="sxs-lookup"><span data-stu-id="2e347-124">**query**</span></span> |
|[<span data-ttu-id="2e347-125">Сортировка результатов поиска</span><span class="sxs-lookup"><span data-stu-id="2e347-125">Sort search results</span></span>](#sort-search-results)| <span data-ttu-id="2e347-126">**sort**</span><span class="sxs-lookup"><span data-stu-id="2e347-126">**sort**</span></span> |
|[<span data-ttu-id="2e347-127">Уточнение результатов с помощью агрегатов</span><span class="sxs-lookup"><span data-stu-id="2e347-127">Refine results using aggregations</span></span>](#refine-results-using-aggregations)| <span data-ttu-id="2e347-128">**aggregations**</span><span class="sxs-lookup"><span data-stu-id="2e347-128">**aggregations**</span></span> |
|[<span data-ttu-id="2e347-129">Поиск в соединителях Graph</span><span class="sxs-lookup"><span data-stu-id="2e347-129">Search across Graph connectors</span></span>](/graph/search-concept-custom-types)| <span data-ttu-id="2e347-130">**contentSources**</span><span class="sxs-lookup"><span data-stu-id="2e347-130">**contentSources**</span></span> |

## <a name="scope-search-based-on-entity-types"></a><span data-ttu-id="2e347-131">Поиск в области по типам объектов</span><span class="sxs-lookup"><span data-stu-id="2e347-131">Scope search based on entity types</span></span>

<span data-ttu-id="2e347-p102">Область действия поискового запроса определяется с помощью свойства **entityTypes** полезных данных запроса **query**. В таблице ниже описаны доступные типы запросов и поддерживаемые разрешения на доступ к данным.</span><span class="sxs-lookup"><span data-stu-id="2e347-p102">Define the scope of the search request using the **entityTypes** property in the **query** request payload. The following table describes the types available to query and the supported permissions to access the data.</span></span>

| <span data-ttu-id="2e347-134">EntityType</span><span class="sxs-lookup"><span data-stu-id="2e347-134">EntityType</span></span> | <span data-ttu-id="2e347-135">Область разрешений, необходимая для доступа к элементам</span><span class="sxs-lookup"><span data-stu-id="2e347-135">Permission scope required to access the items</span></span>| <span data-ttu-id="2e347-136">Источник</span><span class="sxs-lookup"><span data-stu-id="2e347-136">Source</span></span>| <span data-ttu-id="2e347-137">Примечание</span><span class="sxs-lookup"><span data-stu-id="2e347-137">Comment</span></span>|
|:------------------|:---------|:---------|:---------|
|[<span data-ttu-id="2e347-138">message</span><span class="sxs-lookup"><span data-stu-id="2e347-138">message</span></span>](message.md)|<span data-ttu-id="2e347-139">Mail.Read, Mail.ReadWrite</span><span class="sxs-lookup"><span data-stu-id="2e347-139">Mail.Read, Mail.ReadWrite</span></span>| <span data-ttu-id="2e347-140">Exchange Online</span><span class="sxs-lookup"><span data-stu-id="2e347-140">Exchange Online</span></span>| <span data-ttu-id="2e347-141">Сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="2e347-141">Email messages.</span></span>|
|[<span data-ttu-id="2e347-142">event</span><span class="sxs-lookup"><span data-stu-id="2e347-142">event</span></span>](event.md) |<span data-ttu-id="2e347-143">Calendars.Read, Calendars.ReadWrite</span><span class="sxs-lookup"><span data-stu-id="2e347-143">Calendars.Read, Calendars.ReadWrite</span></span>| <span data-ttu-id="2e347-144">Exchange Online</span><span class="sxs-lookup"><span data-stu-id="2e347-144">Exchange Online</span></span>|<span data-ttu-id="2e347-145">События календаря.</span><span class="sxs-lookup"><span data-stu-id="2e347-145">Calendar events.</span></span> |
|[<span data-ttu-id="2e347-146">drive</span><span class="sxs-lookup"><span data-stu-id="2e347-146">drive</span></span>](drive.md)|<span data-ttu-id="2e347-147">Files.Read.All, Files.ReadWrite.All, Sites.Read.All, Sites.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="2e347-147">Files.Read.All, Files.ReadWrite.All, Sites.Read.All, Sites.ReadWrite.All</span></span>| <span data-ttu-id="2e347-148">SharePoint</span><span class="sxs-lookup"><span data-stu-id="2e347-148">SharePoint</span></span> | <span data-ttu-id="2e347-149">Библиотеки документов.</span><span class="sxs-lookup"><span data-stu-id="2e347-149">Document libraries.</span></span>|
|[<span data-ttu-id="2e347-150">driveItem</span><span class="sxs-lookup"><span data-stu-id="2e347-150">driveItem</span></span>](driveitem.md)|<span data-ttu-id="2e347-151">Files.Read.All, Files.ReadWrite.All, Sites.Read.All, Sites.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="2e347-151">Files.Read.All, Files.ReadWrite.All, Sites.Read.All, Sites.ReadWrite.All</span></span>| <span data-ttu-id="2e347-152">SharePoint и OneDrive</span><span class="sxs-lookup"><span data-stu-id="2e347-152">SharePoint and OneDrive</span></span> | <span data-ttu-id="2e347-153">Файлы, папки, страницы и новости.</span><span class="sxs-lookup"><span data-stu-id="2e347-153">Files, folders, pages, and news.</span></span> |
|[<span data-ttu-id="2e347-154">list</span><span class="sxs-lookup"><span data-stu-id="2e347-154">list</span></span>](list.md)|<span data-ttu-id="2e347-155">Sites.Read.All, Sites.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="2e347-155">Sites.Read.All, Sites.ReadWrite.All</span></span>| <span data-ttu-id="2e347-156">SharePoint и OneDrive</span><span class="sxs-lookup"><span data-stu-id="2e347-156">SharePoint and OneDrive</span></span> | <span data-ttu-id="2e347-p103">Списки. Обратите внимание, что библиотеки документов также возвращаются в виде списков.</span><span class="sxs-lookup"><span data-stu-id="2e347-p103">Lists. Note that document libraries are also returned as lists.</span></span> |
|[<span data-ttu-id="2e347-159">listItem</span><span class="sxs-lookup"><span data-stu-id="2e347-159">listItem</span></span>](listitem.md)|<span data-ttu-id="2e347-160">Sites.Read.All, Sites.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="2e347-160">Sites.Read.All, Sites.ReadWrite.All</span></span>| <span data-ttu-id="2e347-161">SharePoint и OneDrive</span><span class="sxs-lookup"><span data-stu-id="2e347-161">SharePoint and OneDrive</span></span> | <span data-ttu-id="2e347-p104">Элементы списка. Учтите, что файлы и папки также возвращаются как элементы списка; **listItem** — это суперкласс **driveItem**.</span><span class="sxs-lookup"><span data-stu-id="2e347-p104">List items. Note that files and folders are also returned as list items; **listItem** is the super class of **driveItem**.</span></span> |
|[<span data-ttu-id="2e347-164">site</span><span class="sxs-lookup"><span data-stu-id="2e347-164">site</span></span>](site.md)|<span data-ttu-id="2e347-165">Sites.Read.All, Sites.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="2e347-165">Sites.Read.All, Sites.ReadWrite.All</span></span>| <span data-ttu-id="2e347-166">SharePoint</span><span class="sxs-lookup"><span data-stu-id="2e347-166">SharePoint</span></span> | <span data-ttu-id="2e347-167">Сайты в SharePoint.</span><span class="sxs-lookup"><span data-stu-id="2e347-167">Sites in SharePoint.</span></span>|
|[<span data-ttu-id="2e347-168">externalItem</span><span class="sxs-lookup"><span data-stu-id="2e347-168">externalItem</span></span>](externalitem.md)|<span data-ttu-id="2e347-169">ExternalItem.Read.All</span><span class="sxs-lookup"><span data-stu-id="2e347-169">ExternalItem.Read.All</span></span>| <span data-ttu-id="2e347-170">Соединители Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="2e347-170">Microsoft Graph connectors</span></span>| <span data-ttu-id="2e347-171">Все содержимое, размещаемое с помощью API соединителей Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="2e347-171">All content ingested with the Microsoft Graph connectors API.</span></span>|

## <a name="page-search-results"></a><span data-ttu-id="2e347-172">Результаты поиска на странице</span><span class="sxs-lookup"><span data-stu-id="2e347-172">Page search results</span></span>

<span data-ttu-id="2e347-173">Управляйте разбивкой результатов поиска на страницы, указав описанные ниже два свойства в тексте запроса **query**.</span><span class="sxs-lookup"><span data-stu-id="2e347-173">Control pagination of the search results by specifying the following two properties in the **query** request body:</span></span>

- <span data-ttu-id="2e347-p105">**from**  — целое значение, указывающее начальную точку (начиная с 0) для перечисления результатов поиска на странице. Значение по умолчанию – 0.</span><span class="sxs-lookup"><span data-stu-id="2e347-p105">**from** - An integer that indicates the 0-based starting point to list search results on the page. The default value is 0.</span></span>

- <span data-ttu-id="2e347-p106">**size**  — целое число, обозначающее количество результатов, возвращаемых для страницы. Значение по умолчанию – 25.</span><span class="sxs-lookup"><span data-stu-id="2e347-p106">**size** - An integer that indicates the number of results to be returned for a page. The default value is 25.</span></span>

<span data-ttu-id="2e347-178">При поиске объекта **event** или **message** учитывайте указанные ниже ограничения.</span><span class="sxs-lookup"><span data-stu-id="2e347-178">Note the following limits if you're searching the **event** or **message** entity:</span></span>

- <span data-ttu-id="2e347-179">Значение **from** должно начинаться с нуля для запроса первой страницы. В противном случае запрос возвращает ошибку HTTP 400 `Bad request`.</span><span class="sxs-lookup"><span data-stu-id="2e347-179">**from** must start at zero in the first page request; otherwise, the request results in an HTTP 400 `Bad request`.</span></span>
- <span data-ttu-id="2e347-180">Максимальное количество результатов на странице ( **size** ) составляет 25 для **message** и **event**.</span><span class="sxs-lookup"><span data-stu-id="2e347-180">The maximum results per page ( **size** ) is 25 for **message** and **event**.</span></span> 

<span data-ttu-id="2e347-p107">Для SharePoint и OneDrive ограничений нет. Рекомендуемый размер страницы — 200. Чем больше размер страницы, тем, как правило, больше задержка.</span><span class="sxs-lookup"><span data-stu-id="2e347-p107">There is no upper limit for SharePoint or OneDrive items. A reasonable page size is 200. A larger page size generally incurs higher latency.</span></span>

<span data-ttu-id="2e347-184">Рекомендации:</span><span class="sxs-lookup"><span data-stu-id="2e347-184">Best practices:</span></span>

- <span data-ttu-id="2e347-p108">В исходном запросе задайте меньший размер первой страницы. Например, задайте для свойства **from** значение 0, а для свойства **size**  — 25.</span><span class="sxs-lookup"><span data-stu-id="2e347-p108">Specify a smaller first page in the initial request. For example, specify **from** as 0, **size** as 25.</span></span>
- <span data-ttu-id="2e347-p109">Для получения последующих страниц обновите свойства **from** и **size**. Вы можете увеличивать размер страницы в каждом последующем запросе. В приведенной ниже таблице показан пример.</span><span class="sxs-lookup"><span data-stu-id="2e347-p109">Paginate subsequent pages by updating the **from** and **size** properties. You can increase the page size in each subsequent request. The following table shows an example.</span></span>

    | <span data-ttu-id="2e347-190">Page</span><span class="sxs-lookup"><span data-stu-id="2e347-190">Page</span></span> | <span data-ttu-id="2e347-191">from</span><span class="sxs-lookup"><span data-stu-id="2e347-191">from</span></span> | <span data-ttu-id="2e347-192">size</span><span class="sxs-lookup"><span data-stu-id="2e347-192">size</span></span> |
    |:-----|:-----|:-----|
    | <span data-ttu-id="2e347-193">1</span><span class="sxs-lookup"><span data-stu-id="2e347-193">1</span></span>    | <span data-ttu-id="2e347-194">0</span><span class="sxs-lookup"><span data-stu-id="2e347-194">0</span></span> | <span data-ttu-id="2e347-195">25</span><span class="sxs-lookup"><span data-stu-id="2e347-195">25</span></span> |
    | <span data-ttu-id="2e347-196">2</span><span class="sxs-lookup"><span data-stu-id="2e347-196">2</span></span>    | <span data-ttu-id="2e347-197">25</span><span class="sxs-lookup"><span data-stu-id="2e347-197">25</span></span> | <span data-ttu-id="2e347-198">50</span><span class="sxs-lookup"><span data-stu-id="2e347-198">50</span></span> |
    | <span data-ttu-id="2e347-199">3</span><span class="sxs-lookup"><span data-stu-id="2e347-199">3</span></span>    | <span data-ttu-id="2e347-200">75</span><span class="sxs-lookup"><span data-stu-id="2e347-200">75</span></span> | <span data-ttu-id="2e347-201">75</span><span class="sxs-lookup"><span data-stu-id="2e347-201">75</span></span> |
    | <span data-ttu-id="2e347-202">4</span><span class="sxs-lookup"><span data-stu-id="2e347-202">4</span></span>    | <span data-ttu-id="2e347-203">150</span><span class="sxs-lookup"><span data-stu-id="2e347-203">150</span></span> | <span data-ttu-id="2e347-204">100</span><span class="sxs-lookup"><span data-stu-id="2e347-204">100</span></span> |

## <a name="get-the-most-relevant-emails"></a><span data-ttu-id="2e347-205">Получение наиболее релевантных электронных писем</span><span class="sxs-lookup"><span data-stu-id="2e347-205">Get the most relevant emails</span></span>

<span data-ttu-id="2e347-206">Если при поиске объекта **message** задать для свойства **enableTopResults** значение `true`, возвращается гибридный список сообщений: первые три сообщения в отклике сортируются по релевантности, а остальные — по дате/времени.</span><span class="sxs-lookup"><span data-stu-id="2e347-206">When searching the **message** entity, specifying **enableTopResults** as `true` returns a hybrid list of messages: the first three messages in the response are sorted by relevance; the remaining messages are sorted by date/time.</span></span>

## <a name="get-selected-properties"></a><span data-ttu-id="2e347-207">Получение выбранных свойств</span><span class="sxs-lookup"><span data-stu-id="2e347-207">Get selected properties</span></span>

<span data-ttu-id="2e347-p110">При поиске по типу сущности, например **message** , **event** , **drive** , **driveItem** , **list** , **listItem** , **site** , **externalItem** , можно включить в свойство **itfields** определенные свойства сущности, которые следует возвратить в результатах поиска. Аналогично используется [параметр $select системного запроса OData](/graph/query-parameters#select-parameter) в запросах REST. API поиска не поддерживает эти параметры запроса, так как их действие подавляется в теле запроса POST.</span><span class="sxs-lookup"><span data-stu-id="2e347-p110">When searching an entity type, such as **message** , **event** , **drive** , **driveItem** , **list** , **listItem** , **site** , **externalItem** , you can include in the **fields** property specific entity properties to return in the search results. This is similar to using the [OData system query option, $select](/graph/query-parameters#select-parameter) in REST requests. The search API does not technically support these query options because the behavior is expressed in the POST body.</span></span>

<span data-ttu-id="2e347-211">Для всех этих типов сущностей указание свойства **fields** сокращает количество свойств, возвращаемых в отклике, что оптимизирует нагрузку на линию.</span><span class="sxs-lookup"><span data-stu-id="2e347-211">For all these entity types, specifying the **fields** property reduces the number of properties returned in the response, optimizing the payload over the wire.</span></span>

<span data-ttu-id="2e347-p111">**listItem** и **externalItem**  — единственные поддерживаемые сущности, которые позволяют настройку расширенных полей в схеме. Из всех других сущностей расширенные свойства невозможно получить. Например, при создании поля для **externalItem** в схеме поиска, или при наличии пользовательского столбца в **listItem** , эти свойства можно извлечь из поиска. Чтобы получить расширенное свойство файла, укажите в запросе тип **listItem**.</span><span class="sxs-lookup"><span data-stu-id="2e347-p111">The **listItem** and **externalItem** entities are the only supported entities that allow getting extended fields configured in the schema. You cannot retrieve extended properties from all the other entities. For example, if you created a field for **externalItem** in the search schema, or if you have a custom column on a **listItem** , you can retrieve these properties from search. To retrieve an extended property on a file, specify the **listItem** type in the request.</span></span>

<span data-ttu-id="2e347-p112">Если поля, указанные в свойстве **fields** , отсутствуют в схеме, они не будут возвращены в отклике. Недопустимые поля в запросе игнорируются без уведомления.</span><span class="sxs-lookup"><span data-stu-id="2e347-p112">If the **fields** specified in the request are not present in the schema, they will not be returned in the response. Invalid fields in the request are silently ignored.</span></span>

<span data-ttu-id="2e347-p113">Если в запросе отсутствуют поля, указанные в свойстве **fields** , вы получите набор свойств для всех типов по умолчанию. При использовании расширенных свойств **listItem** и **externalItem** ведут себя иначе, если поля, указанные в свойстве **fields** , не переданы в запрос.</span><span class="sxs-lookup"><span data-stu-id="2e347-p113">If you do not specify any **fields** in the request,  you will get the default set of properties for all types. For extended properties, **listItem** and **externalItem** behave differently when no **fields** are passed in the request:</span></span>

- <span data-ttu-id="2e347-220">**listItem** не возвращает никаких настраиваемых полей.</span><span class="sxs-lookup"><span data-stu-id="2e347-220">**listItem** will not return any custom field.</span></span>
- <span data-ttu-id="2e347-221">**externalItem** возвращает все поля с атрибутом **retrievable** в схеме соединителя Microsoft Graph для этого конкретного подключения.</span><span class="sxs-lookup"><span data-stu-id="2e347-221">**externalItem** will return all the fields marked with the **retrievable** attribute in the Microsoft Graph connector schema for that particular connection.</span></span>

## <a name="keyword-query-language-kql-support"></a><span data-ttu-id="2e347-222">Поддержка языка KQL</span><span class="sxs-lookup"><span data-stu-id="2e347-222">Keyword Query Language (KQL) support</span></span>

<span data-ttu-id="2e347-p114">Вы можете указать произвольный текст ключевых слов (например, `AND` и `OR`) и ограничения свойств в синтаксисе KQL в фактической строке поискового запроса (свойства **query** в тексте запроса **query** ). Синтаксис и команда зависят от типов объектов (в свойстве **entityTypes** ), указанных в тексте того же запроса **query**.</span><span class="sxs-lookup"><span data-stu-id="2e347-p114">Specify free text keywords, operators (such as `AND`, `OR`), and property restrictions in KQL syntax in the actual search query string ( **query** property of the **query** request body). The syntax and command depend on the entity types (in the **entityTypes** property) you target in the same **query** request body.</span></span>

<span data-ttu-id="2e347-p115">Свойства, доступные для поиска, зависят от типа объекта. Подробнее см. в:</span><span class="sxs-lookup"><span data-stu-id="2e347-p115">Depending on the entity type, the searchable properties vary. For details, see:</span></span>

- [<span data-ttu-id="2e347-227">Свойства электронной почты</span><span class="sxs-lookup"><span data-stu-id="2e347-227">Email properties</span></span>](/microsoft-365/compliance/keyword-queries-and-search-conditions#searchable-email-properties)
- [<span data-ttu-id="2e347-228">Свойства сайта</span><span class="sxs-lookup"><span data-stu-id="2e347-228">Site properties</span></span>](/microsoft-365/compliance/keyword-queries-and-search-conditions#searchable-site-properties)

## <a name="sort-search-results"></a><span data-ttu-id="2e347-229">Сортировка результатов поиска</span><span class="sxs-lookup"><span data-stu-id="2e347-229">Sort search results</span></span>

<span data-ttu-id="2e347-230">Результаты поиска в отклике отсортированы в следующем стандартном порядке:</span><span class="sxs-lookup"><span data-stu-id="2e347-230">Search results in the response are sorted in the following default sort order:</span></span>

- <span data-ttu-id="2e347-231">**message** и **event** сортируются по дате.</span><span class="sxs-lookup"><span data-stu-id="2e347-231">**message** and **event** are sorted by date.</span></span>
- <span data-ttu-id="2e347-232">Все типы SharePoint, OneDrive и соединителей сортируются по релевантности.</span><span class="sxs-lookup"><span data-stu-id="2e347-232">All SharePoint, OneDrive and connector types are sorted by relevance.</span></span>

<span data-ttu-id="2e347-p116">Метод [query](../api/search-query.md) позволяет задать порядок поиска, указав **sortProperties** в параметре `requests`, который представляет собой набор объектов [searchRequest](./searchrequest.md). Это дает возможность указать список из одного или нескольких сортируемых средств и порядок сортировки.</span><span class="sxs-lookup"><span data-stu-id="2e347-p116">The [query](../api/search-query.md) method lets you customize the search order by specifying the **sortProperties** on the `requests` parameter, which is a collection of [searchRequest](./searchrequest.md) objects. This allows you to specify a list of one or more sortable properties and the sort order.</span></span>

<span data-ttu-id="2e347-235">Учтите, что сортировка результатов в настоящее время поддерживается только для следующих типов SharePoint и OneDrive: [driveItem](driveitem.md), [listItem](listitem.md), [list](list.md), [site](site.md).</span><span class="sxs-lookup"><span data-stu-id="2e347-235">Note that sorting results is currently only supported on the following SharePoint and OneDrive types: [driveItem](driveitem.md), [listItem](listitem.md), [list](list.md), [site](site.md).</span></span>

<span data-ttu-id="2e347-p117">Свойства, к которым применяется предложение sort, должны быть сортируемыми в [схеме поиска](/sharepoint/manage-search-schema) SharePoint. Если свойство, указанное в запросе, не является сортируемым или не существует, в отклике будет возвращена ошибка `HTTP 400 Bad Request`. Обратите внимание, что нельзя задать сортировку документов по релевантности с использованием [sortProperty](sortproperty.md).</span><span class="sxs-lookup"><span data-stu-id="2e347-p117">The properties on which the sort clause are applied need to be sortable in the SharePoint [search schema](/sharepoint/manage-search-schema). If the property specified in the request is not sortable or does not exist, the response will return an error, `HTTP 400 Bad Request`. Note that you cannot specify to sort documents by relevance using [sortProperty](sortproperty.md).</span></span>

<span data-ttu-id="2e347-239">При указании параметра **name** объекта [sortProperty](sortproperty.md) можно использовать имя свойства из типа Microsoft Graph (например, в [driveItem](driveitem.md)) или имя управляемого свойства в индексе поиска.</span><span class="sxs-lookup"><span data-stu-id="2e347-239">When specifying the **name** of a [sortProperty](sortproperty.md) object, you can either use the property name from the Microsoft Graph type (for example, in [driveItem](driveitem.md)), or the name of the managed property in the search index.</span></span>

<span data-ttu-id="2e347-240">Примеры сортировки результатов см. в разделе [Сортировка результатов поиска](/graph/search-concept-sort).</span><span class="sxs-lookup"><span data-stu-id="2e347-240">See [sort search results](/graph/search-concept-sort) for examples that show how to sort results.</span></span>

## <a name="refine-results-using-aggregations"></a><span data-ttu-id="2e347-241">Уточнение результатов с помощью агрегатов</span><span class="sxs-lookup"><span data-stu-id="2e347-241">Refine results using aggregations</span></span>

<span data-ttu-id="2e347-p118">Агрегаты (также называемые уточнениями в SharePoint) — это очень популярное средство, которое позволяет расширить возможности поиска. В дополнение к результатам они предоставляют некоторые обобщенные сведения о наборе данных, из которого получены результатов поиска. Например, можно представить сведения о наиболее заметных авторах документов, которые удовлетворяют запросу, или о самых распространенных типах файлов и т. д.</span><span class="sxs-lookup"><span data-stu-id="2e347-p118">Aggregations (also known as refiners in SharePoint) are a very popular way to enhance a search experience. In addition to the results, they provide some level of aggregate information on the matching set of search results. For example, you can provide information on the most represented authors of the documents matching the query, or the most represented file types, etc.</span></span>

<span data-ttu-id="2e347-p119">В [searchRequest](./searchrequest.md) укажите агрегаты, которые нужно получить в дополнение к результатам поиска. Описание каждого агрегата приведено в [aggregationOption](./aggregationoption.md), где указывается свойство, на основе которого будет рассчитываться агрегат, и количество [searchBucket](searchBucket.md), возвращаемое в отклике.</span><span class="sxs-lookup"><span data-stu-id="2e347-p119">In the [searchRequest](./searchrequest.md), specify the aggregations that should be returned in addition to the search results. The description of each aggregation is defined in the [aggregationOption](./aggregationoption.md), which specifies the property on which the aggregation should be computed, and the number of [searchBucket](searchBucket.md) to be returned in the response.</span></span>

<span data-ttu-id="2e347-p120">Свойства, по которым запрашивается агрегат, должны быть уточняемыми в [схеме поиска](/sharepoint/manage-search-schema) SharePoint. Если указанное свойство не является уточняемым или не существует, отклик возвращает `HTTP 400 Bad Request`.</span><span class="sxs-lookup"><span data-stu-id="2e347-p120">The properties on which the aggregation is requested need to be refinable in the SharePoint [search schema](/sharepoint/manage-search-schema). If the property specified is not refinable or does not exist, the response returns `HTTP 400 Bad Request`.</span></span>

<span data-ttu-id="2e347-p121">Когда будет получен отклик, содержащий набор объектов [searchBucket](searchBucket.md), можно уточнить поисковый запрос, ограничив его только совпадающими элементами из одного объекта [searchBucket](searchBucket.md). Это достигается путем передачи значения **aggregationsFilterToken** в свойстве **aggregationFilters** последующего [searchRequest](./searchrequest.md).</span><span class="sxs-lookup"><span data-stu-id="2e347-p121">Once the response is returned containing the collection of [searchBucket](searchBucket.md) objects, it is possible to refine the search request to only the matching elements contained in one [searchBucket](searchBucket.md). This is achieved by passing back the  **aggregationsFilterToken** value in the **aggregationFilters** property of the subsequent [searchRequest](./searchrequest.md).</span></span>

<span data-ttu-id="2e347-251">В настоящий момент агрегаты поддерживаются для любого свойства с возможностью уточнения в следующих типах SharePoint и OneDrive: [driveItem](driveitem.md), [listItem](listitem.md), [list](list.md), [site](site.md) и в соединителях Microsoft Graph [externalItem](externalItem.md).</span><span class="sxs-lookup"><span data-stu-id="2e347-251">Aggregations are currently supported for any refinable property on the following SharePoint and OneDrive types: [driveItem](driveitem.md), [listItem](listitem.md), [list](list.md), [site](site.md), and on Microsoft Graph connectors [externalItem](externalItem.md).</span></span>

<span data-ttu-id="2e347-252">Примеры использования агрегатов для улучшения и снижения объема результатов поиска см. в разделе [Уточнение результатов поиска](/graph/search-concept-aggregation).</span><span class="sxs-lookup"><span data-stu-id="2e347-252">See [refine search results](/graph/search-concept-aggregation) for examples that show using aggregation to enhance and narrow down search results.</span></span>

## <a name="error-handling"></a><span data-ttu-id="2e347-253">Обработка ошибок</span><span class="sxs-lookup"><span data-stu-id="2e347-253">Error handling</span></span>

<span data-ttu-id="2e347-254">API поиска возвращает отклики с ошибками, описанные в [определении объектов ошибок OData](http://docs.oasis-open.org/odata/odata-json-format/v4.01/cs01/odata-json-format-v4.01-cs01.html#sec_ErrorResponse), каждый из которых представляет собой объект JSON, содержащий код и сообщение.</span><span class="sxs-lookup"><span data-stu-id="2e347-254">The search API returns error responses as defined by [OData error object definition](http://docs.oasis-open.org/odata/odata-json-format/v4.01/cs01/odata-json-format-v4.01-cs01.html#sec_ErrorResponse), each of which is a JSON object containing a code and a message.</span></span>

<!---TODOSEARCHAPI Describe the know errors: bad requests.--->

## <a name="known-limitations"></a><span data-ttu-id="2e347-255">Известные ограничения</span><span class="sxs-lookup"><span data-stu-id="2e347-255">Known limitations</span></span>

<span data-ttu-id="2e347-256">На API поиска распространяются описанные ниже ограничения.</span><span class="sxs-lookup"><span data-stu-id="2e347-256">The search API has the following limitations:</span></span>

- <span data-ttu-id="2e347-257">Метод **query** определяется, чтобы разрешить передачу коллекции из одного или нескольких экземпляров **searchRequest**.</span><span class="sxs-lookup"><span data-stu-id="2e347-257">The **query** method is defined to allow passing a collection of one or more **searchRequest** instances at once.</span></span> <span data-ttu-id="2e347-258">Однако в настоящее время служба может обрабатывать только по одному экземпляру [searchRequest](./searchrequest.md) за раз.</span><span class="sxs-lookup"><span data-stu-id="2e347-258">However, the service currently supports only a single [searchRequest](./searchrequest.md) at a time.</span></span>

- <span data-ttu-id="2e347-259">Ресурс [searchRequest](./searchrequest.md) поддерживает одновременную передачу объектов нескольких типов.</span><span class="sxs-lookup"><span data-stu-id="2e347-259">The [searchRequest](./searchrequest.md) resource supports passing multiple types of entities at a time.</span></span> <span data-ttu-id="2e347-260">Однако в настоящее время поддерживается только следующее сочетание для типов объектов SharePoint и OneDrive: **driveItem** , **drive** , **site** , **list** , **listItem**.</span><span class="sxs-lookup"><span data-stu-id="2e347-260">However, currently the only supported combination is for SharePoint and OneDrive entityTypes: **driveItem** , **drive** , **site** , **list** , **listItem**.</span></span>
<span data-ttu-id="2e347-261">Любые сочетания, включающие **message** , **event** , типы SharePoint и OneDrive или **externalItem** , пока не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="2e347-261">Any combinations involving **message** , **event** , SharePoint and OneDrive types , or **externalItem** are currently not supported.</span></span>  

- <span data-ttu-id="2e347-262">Свойство **contentSource** , определяющее используемое соединение, применимо только при присвоении свойству **entityType** значения `externalItem`.</span><span class="sxs-lookup"><span data-stu-id="2e347-262">The **contentSource** property, which defines the connection to use, is only applicable when **entityType** is specified as `externalItem`.</span></span>

- <span data-ttu-id="2e347-263">API поиска не поддерживает настраиваемую сортировку для **message** , **event** или **externalItem**.</span><span class="sxs-lookup"><span data-stu-id="2e347-263">The search API does not support custom sort for **message** , **event** or  **externalItem**.</span></span>

- <span data-ttu-id="2e347-264">API поиска не поддерживает агрегаты для **message** , **event** , **site** или **drive**.</span><span class="sxs-lookup"><span data-stu-id="2e347-264">The search API does not support aggregations for **message** , **event** , **site** or **drive**.</span></span>

## <a name="schema-change-deprecation-warning"></a><span data-ttu-id="2e347-265">Предупреждение об устаревании изменений схемы</span><span class="sxs-lookup"><span data-stu-id="2e347-265">Schema change deprecation warning</span></span>

<span data-ttu-id="2e347-266">Свойства, используемые в поисковом запросе и отклике, были переименованы или удалены.</span><span class="sxs-lookup"><span data-stu-id="2e347-266">Properties used in a search request and response have been renamed or removed.</span></span> <span data-ttu-id="2e347-267">В большинстве случаев первоначальные свойства устаревают и заменяются текущими свойствами, как указано в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="2e347-267">In most cases, the original properties are being deprecated and replaced by the current properties, as listed in the table below.</span></span>

<span data-ttu-id="2e347-268">Обновите существующие приложения так, чтобы в них использовались текущие имена свойств и типов, а отклик содержал имена текущих свойств.</span><span class="sxs-lookup"><span data-stu-id="2e347-268">Start updating any existing apps to use current property and type names, and to get current property names in the response.</span></span>
<span data-ttu-id="2e347-269">Для обеспечения обратной совместимости первоначальные свойства и типы доступны и могут использоваться до **31 декабря 2020 г.** , после этого они будут удалены.</span><span class="sxs-lookup"><span data-stu-id="2e347-269">For backward compatibility, the original properties and types are accessible and functional until **December 31, 2020** , after which they will be removed.</span></span>

| <span data-ttu-id="2e347-270">Ресурс</span><span class="sxs-lookup"><span data-stu-id="2e347-270">Resource</span></span>                           | <span data-ttu-id="2e347-271">Тип изменения</span><span class="sxs-lookup"><span data-stu-id="2e347-271">Change type</span></span>   | <span data-ttu-id="2e347-272">Первоначальное свойство</span><span class="sxs-lookup"><span data-stu-id="2e347-272">Original property</span></span> | <span data-ttu-id="2e347-273">Текущее свойство</span><span class="sxs-lookup"><span data-stu-id="2e347-273">Current property</span></span>|
|:-----------------------------------|:--------------|:------------------|:----------------|
| [<span data-ttu-id="2e347-274">searchRequest</span><span class="sxs-lookup"><span data-stu-id="2e347-274">searchRequest</span></span>](./searchrequest.md)| <span data-ttu-id="2e347-275">Переименованное свойство</span><span class="sxs-lookup"><span data-stu-id="2e347-275">Rename property</span></span> | <span data-ttu-id="2e347-276">**stored_fields**</span><span class="sxs-lookup"><span data-stu-id="2e347-276">**stored_fields**</span></span> | <span data-ttu-id="2e347-277">**fields**</span><span class="sxs-lookup"><span data-stu-id="2e347-277">**fields**</span></span>      |
| [<span data-ttu-id="2e347-278">searchQuery</span><span class="sxs-lookup"><span data-stu-id="2e347-278">searchQuery</span></span>](./searchquery.md)    | <span data-ttu-id="2e347-279">Переименованное свойство</span><span class="sxs-lookup"><span data-stu-id="2e347-279">Rename property</span></span> | <span data-ttu-id="2e347-280">**query_string**</span><span class="sxs-lookup"><span data-stu-id="2e347-280">**query_string**</span></span> | <span data-ttu-id="2e347-281">**queryString**</span><span class="sxs-lookup"><span data-stu-id="2e347-281">**queryString**</span></span> |
| [<span data-ttu-id="2e347-282">searchQueryString</span><span class="sxs-lookup"><span data-stu-id="2e347-282">searchQueryString</span></span>](./searchquerystring.md) | <span data-ttu-id="2e347-283">Устаревший ресурс</span><span class="sxs-lookup"><span data-stu-id="2e347-283">Deprecate resource</span></span> | <span data-ttu-id="2e347-284">Неприменимо</span><span class="sxs-lookup"><span data-stu-id="2e347-284">Not applicable</span></span> | <span data-ttu-id="2e347-285">Неприменимо</span><span class="sxs-lookup"><span data-stu-id="2e347-285">Not applicable</span></span> |
| [<span data-ttu-id="2e347-286">searchHit</span><span class="sxs-lookup"><span data-stu-id="2e347-286">searchHit</span></span>](./searchhit.md)        | <span data-ttu-id="2e347-287">Переименованное свойство</span><span class="sxs-lookup"><span data-stu-id="2e347-287">Rename property</span></span> | <span data-ttu-id="2e347-288">**_id**</span><span class="sxs-lookup"><span data-stu-id="2e347-288">**_id**</span></span> | <span data-ttu-id="2e347-289">**hitId**</span><span class="sxs-lookup"><span data-stu-id="2e347-289">**hitId**</span></span> |
| [<span data-ttu-id="2e347-290">searchHit</span><span class="sxs-lookup"><span data-stu-id="2e347-290">searchHit</span></span>](./searchhit.md)        | <span data-ttu-id="2e347-291">Переименованное свойство</span><span class="sxs-lookup"><span data-stu-id="2e347-291">Rename property</span></span> | <span data-ttu-id="2e347-292">**_score**</span><span class="sxs-lookup"><span data-stu-id="2e347-292">**_score**</span></span> | <span data-ttu-id="2e347-293">**rank**</span><span class="sxs-lookup"><span data-stu-id="2e347-293">**rank**</span></span> |
| [<span data-ttu-id="2e347-294">searchHit</span><span class="sxs-lookup"><span data-stu-id="2e347-294">searchHit</span></span>](./searchhit.md)        | <span data-ttu-id="2e347-295">Удаленное свойство</span><span class="sxs-lookup"><span data-stu-id="2e347-295">Remove property</span></span> | <span data-ttu-id="2e347-296">**_sortField**</span><span class="sxs-lookup"><span data-stu-id="2e347-296">**_sortField**</span></span> | <span data-ttu-id="2e347-297">Неприменимо</span><span class="sxs-lookup"><span data-stu-id="2e347-297">Not applicable</span></span> |
| [<span data-ttu-id="2e347-298">searchHit</span><span class="sxs-lookup"><span data-stu-id="2e347-298">searchHit</span></span>](./searchhit.md)        | <span data-ttu-id="2e347-299">Переименованное свойство</span><span class="sxs-lookup"><span data-stu-id="2e347-299">Rename property</span></span> | <span data-ttu-id="2e347-300">**_source**</span><span class="sxs-lookup"><span data-stu-id="2e347-300">**_source**</span></span> | <span data-ttu-id="2e347-301">**resource**</span><span class="sxs-lookup"><span data-stu-id="2e347-301">**resource**</span></span> |
| [<span data-ttu-id="2e347-302">searchHit</span><span class="sxs-lookup"><span data-stu-id="2e347-302">searchHit</span></span>](./searchhit.md)        | <span data-ttu-id="2e347-303">Переименованное свойство</span><span class="sxs-lookup"><span data-stu-id="2e347-303">Rename property</span></span> | <span data-ttu-id="2e347-304">**_summary**</span><span class="sxs-lookup"><span data-stu-id="2e347-304">**_summary**</span></span>  | <span data-ttu-id="2e347-305">**summary**</span><span class="sxs-lookup"><span data-stu-id="2e347-305">**summary**</span></span>  |

## <a name="search-samples"></a><span data-ttu-id="2e347-306">Примеры поиска</span><span class="sxs-lookup"><span data-stu-id="2e347-306">Search samples</span></span>

- <span data-ttu-id="2e347-307">Подробнее о некоторых основных вариантах использования:</span><span class="sxs-lookup"><span data-stu-id="2e347-307">Learn more about a few key use cases:</span></span>
  - [<span data-ttu-id="2e347-308">Поиск сообщений Outlook</span><span class="sxs-lookup"><span data-stu-id="2e347-308">Search Outlook messages</span></span>](/graph/search-concept-messages)
  - [<span data-ttu-id="2e347-309">Поиск событий календаря</span><span class="sxs-lookup"><span data-stu-id="2e347-309">Search calendar events</span></span>](/graph/search-concept-events)
  - [<span data-ttu-id="2e347-310">Поиск содержимого в OneDrive и SharePoint</span><span class="sxs-lookup"><span data-stu-id="2e347-310">Search content in Sharepoint and OneDrive</span></span>](/graph/search-concept-files)
  - [<span data-ttu-id="2e347-311">Поиск внешнего контента</span><span class="sxs-lookup"><span data-stu-id="2e347-311">Search external content</span></span>](/graph/search-concept-custom-types)
  - [<span data-ttu-id="2e347-312">Сортировка результатов поиска</span><span class="sxs-lookup"><span data-stu-id="2e347-312">Sort search results</span></span>](/graph/search-concept-sort)
  - [<span data-ttu-id="2e347-313">Уточнение результатов поиска</span><span class="sxs-lookup"><span data-stu-id="2e347-313">Refine search results</span></span>](/graph/search-concept-aggregation)

- <span data-ttu-id="2e347-314">Узнайте больше об API в [песочнице Graph](https://developer.microsoft.com/graph/graph-explorer).</span><span class="sxs-lookup"><span data-stu-id="2e347-314">Explore the search APIs in  [Graph Explorer](https://developer.microsoft.com/graph/graph-explorer).</span></span>


## <a name="whats-new"></a><span data-ttu-id="2e347-315">Новые возможности</span><span class="sxs-lookup"><span data-stu-id="2e347-315">What's new</span></span>

<span data-ttu-id="2e347-316">Узнайте о [новых функциях и обновлениях](/graph/whats-new-overview) для этого набора API.</span><span class="sxs-lookup"><span data-stu-id="2e347-316">Find out about the [latest new features and updates](/graph/whats-new-overview) for this API set.</span></span>