# <a name="microsoft-graph-throttling-guidance"></a><span data-ttu-id="9cfd0-101">Руководство по регулированию Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="9cfd0-101">Microsoft Graph throttling guidance</span></span>


<span data-ttu-id="9cfd0-p101">Регулирование позволяет ограничить количество одновременных вызовов службы, чтобы предотвратить перегрузку ресурсов. Служба Microsoft Graph предназначена для обработки большого количества запросов. Регулирование помогает поддерживать оптимальную производительность и надежность службы Microsoft Graph, если выполняется слишком много запросов.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-p101">Throttling limits the number of concurrent calls to a service to prevent overuse of resources. Microsoft Graph is designed to handle a high volume of requests. If an overwhelming number of requests occurs, throttling helps maintain optimal performance and reliability of the Microsoft Graph service.</span></span>

<span data-ttu-id="9cfd0-p102">Ограничения регулирования зависят от сценария. Например, при выполнении большого количества операций записи вероятность того, что понадобится регулирование, выше, чем при выполнении только операций чтения.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-p102">Throttling limits vary based on the scenario. For example, if you are performing a large volume of writes, the possibility for throttling is higher than if you are only performing reads.</span></span>

## <a name="what-happens-when-throttling-occurs"></a><span data-ttu-id="9cfd0-107">Что происходит при регулировании?</span><span class="sxs-lookup"><span data-stu-id="9cfd0-107">What happens when throttling occurs?</span></span>

<span data-ttu-id="9cfd0-p103">При превышении порогового значения регулирования Microsoft Graph на некоторое время запрещает все последующие запросы от этого клиента. В случае регулирования Microsoft Graph возвращает код состояния HTTP 429 (слишком много запросов), а запросы завершаются ошибкой. Рекомендуемое время ожидания возвращается в заголовке отклика на невыполненный запрос. Поведение регулирования зависит от типа и количества запросов. Например, при большом количестве запросов будут регулироваться запросы всех типов. Пороговые значения ограничений зависят от типа запроса. Могут возникать ситуации, в которых запросы на запись регулируются, а запросы на чтение разрешаются.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-p103">When a throttling threshold is exceeded, Microsoft Graph limits any further requests from that client for a period of time. When throttling occurs, Microsoft Graph returns HTTP status code 429 (Too many requests), and the requests fail. A suggested wait time is returned in the response header of the failed request. Throttling behavior can depend on the type and number of requests. For example, if you have a high volume of requests, all requests types are throttled. Threshold limits vary based on the request type. Therefore, you could encounter a scenario where writes are throttled but reads are still permitted.</span></span> 

## <a name="common-throttling-scenarios"></a><span data-ttu-id="9cfd0-115">Распространенные сценарии регулирования</span><span class="sxs-lookup"><span data-stu-id="9cfd0-115">Common throttling scenarios</span></span>

<span data-ttu-id="9cfd0-116">Наиболее распространенные причины регулирования клиентов:</span><span class="sxs-lookup"><span data-stu-id="9cfd0-116">The most common causes of throttling of clients include:</span></span>

* <span data-ttu-id="9cfd0-117">большое количество запросов во всех приложениях клиента;</span><span class="sxs-lookup"><span data-stu-id="9cfd0-117">A large number of requests across all applications in a tenant.</span></span>
* <span data-ttu-id="9cfd0-118">большое количество запросов из конкретного приложения всех клиентов.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-118">A large number of requests from a particular application across all tenants.</span></span>

## <a name="best-practices-to-handle-throttling"></a><span data-ttu-id="9cfd0-119">Рекомендации по работе с регулированием</span><span class="sxs-lookup"><span data-stu-id="9cfd0-119">Best practices to handle throttling</span></span>

<span data-ttu-id="9cfd0-120">Ниже приведены рекомендации по работе с регулированием.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-120">The following are best practices for handling throttling:</span></span>

* <span data-ttu-id="9cfd0-121">Сократите число операций каждого запроса.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-121">Reduce the number of operations per request.</span></span>
* <span data-ttu-id="9cfd0-122">Сократите частоту вызовов.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-122">Reduce the frequency of calls.</span></span>
* <span data-ttu-id="9cfd0-123">Избегайте немедленных повторов, так как запросы накапливаются, и их количество превышает ограничения использования.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-123">Avoid immediate retries, because all requests accrue against your usage limits.</span></span>

<span data-ttu-id="9cfd0-124">Во время реализации обработки ошибок можно обнаружить регулирование с помощью кода ошибки HTTP 429.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-124">When you implement error handling, use the HTTP error code 429 to detect throttling.</span></span> <span data-ttu-id="9cfd0-125">Неудачный отклик содержит в заголовке поле *Retry-After*.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-125">The failed response includes the *Retry-After* field in the response header.</span></span> <span data-ttu-id="9cfd0-126">Самый быстрый способ откорректировать регулирование — применить к запросам задержку *Retry-After*, так как Microsoft Graph продолжает регистрировать в журнале использование ресурсов при регулировании клиента.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-126">When you implement error handling, use the HTTP error code 429 to detect throttling. The failed response includes the Retry-After field in the response header. Backing off requests using the *Retry-After* delay is the fastest way to recover from throttling because Microsoft Graph continues to log resource usage while a client is being throttled.</span></span>

1. <span data-ttu-id="9cfd0-127">Подождите столько секунд, сколько указано в поле *Retry-After*.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-127">Wait the number of seconds specified in the *Retry-After* field.</span></span>
2. <span data-ttu-id="9cfd0-128">Повторите запрос.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-128">Retry the request.</span></span>
3. <span data-ttu-id="9cfd0-p105">Если запрос снова не удастся и будет получен код ошибки 429, регулирование продолжается. Используйте рекомендуемую задержку Retry-After, затем повторите запрос. Выполняйте эти действия, пока запрос не будет удачно выполнен.</span><span class="sxs-lookup"><span data-stu-id="9cfd0-p105">If the request fails again with a 429 error code, you are still being throttled. Continue to use the recommended Retry-After delay and retry the request until it succeeds.</span></span>

<span data-ttu-id="9cfd0-131">Заголовок Retry-After сейчас доступен для ресурсов, представляющих следующее:</span><span class="sxs-lookup"><span data-stu-id="9cfd0-131">The following resources currently provide a retry-after header:</span></span>
- <span data-ttu-id="9cfd0-132">[пользователь](../api-reference/v1.0/resources/user.md);</span><span class="sxs-lookup"><span data-stu-id="9cfd0-132">[User](../api-reference/v1.0/resources/user.md)</span></span>
- <span data-ttu-id="9cfd0-133">[фотография](../api-reference/v1.0/resources/profilephoto.md);</span><span class="sxs-lookup"><span data-stu-id="9cfd0-133">[Photo](../api-reference/v1.0/resources/profilephoto.md)</span></span>
- <span data-ttu-id="9cfd0-134">[почта](../api-reference/v1.0/resources/message.md);</span><span class="sxs-lookup"><span data-stu-id="9cfd0-134">[mail](../api-reference/v1.0/resources/message.md)</span></span>
- <span data-ttu-id="9cfd0-135">[календарь (пользователи и группы)](../api-reference/v1.0/resources/event.md);</span><span class="sxs-lookup"><span data-stu-id="9cfd0-135">[Calendar (users and groups)](../api-reference/v1.0/resources/event.md)</span></span>
- <span data-ttu-id="9cfd0-136">[контакт](../api-reference/v1.0/resources/contact.md);</span><span class="sxs-lookup"><span data-stu-id="9cfd0-136">[Contact](../api-reference/v1.0/resources/contact.md)</span></span>
- <span data-ttu-id="9cfd0-137">[вложение](../api-reference/v1.0/resources/attachment.md);</span><span class="sxs-lookup"><span data-stu-id="9cfd0-137">[Attachment](../api-reference/v1.0/resources/attachment.md)</span></span>
- <span data-ttu-id="9cfd0-138">[групповые чаты](../api-reference/v1.0/resources/conversation.md);</span><span class="sxs-lookup"><span data-stu-id="9cfd0-138">[Group conversations](../api-reference/v1.0/resources/conversation.md)</span></span>
- <span data-ttu-id="9cfd0-139">[люди и социальные медиа](../api-reference/beta/resources/social_overview.md);</span><span class="sxs-lookup"><span data-stu-id="9cfd0-139">[People and social](../api-reference/beta/resources/social_overview.md)</span></span>
- <span data-ttu-id="9cfd0-140">[хранилище (OneDrive)](../api-reference/v1.0/resources/drive.md).</span><span class="sxs-lookup"><span data-stu-id="9cfd0-140">[Drive (OneDrive)](../api-reference/v1.0/resources/drive.md)</span></span>

<span data-ttu-id="9cfd0-141">Развернутое описание регулирования в Microsoft Cloud см. в [этой статье]((https://msdn.microsoft.com/ru-RU/library/office/dn589798.aspx)).</span><span class="sxs-lookup"><span data-stu-id="9cfd0-141">For a broader discussion of throttling on the Microsoft Cloud, see [Throttling Pattern]((https://msdn.microsoft.com/ru-RU/library/office/dn589798.aspx)).</span></span>
