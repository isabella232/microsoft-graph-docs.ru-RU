---
title: Интеграция оповещений API безопасности Microsoft Graph с IBM QRadar SIEM при помощи Azure Monitor
description: Поставщиками безопасности Microsoft Graph можно управлять через одну конечную точку REST. Эту конечную точку можно настроить для службы Azure Monitor, поддерживающей соединители для нескольких продуктов SIEM. Инструкции, приведенные в этапах 1 и 2 этой статьи, относятся ко всем соединителям Azure Monitor, поддерживающим получение данных через концентраторы событий. В этой статье описана сквозная интеграция соединителя QRadar SIEM.
author: Preetikr
ms.openlocfilehash: 663ff74741bdb3847cc0b47b56651c28bceef8f8
ms.sourcegitcommit: 6a82bf240a3cfc0baabd227349e08a08311e3d44
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/18/2018
ms.locfileid: "27309263"
---
# <a name="integrate-microsoft-graph-security-api-alerts-with-ibm-qradar-siem-using-azure-monitor"></a>Интеграция оповещений API безопасности Microsoft Graph с IBM QRadar SIEM при помощи Azure Monitor

Поставщиками безопасности Microsoft Graph можно управлять через одну конечную точку REST. Эту конечную точку можно настроить для службы [Azure Monitor](https://docs.microsoft.com/ru-RU/azure/monitoring-and-diagnostics/), поддерживающей соединители для нескольких продуктов SIEM. Инструкции, приведенные в этапах 1 и 2 этой статьи, относятся ко всем соединителям Azure Monitor, поддерживающим получение данных через концентраторы событий. В этой статье описана сквозная интеграция соединителя [QRadar](https://www.ibm.com/us-en/marketplace/ibm-qradar-siem) SIEM.

Процесс интеграции состоит из следующих этапов:

1. [Настройка концентратора событий Azure на получение оповещений системы безопасности для клиента](#step-1-set-up-an-event-hubs-namespace-in-azure-to-receive-security-alerts-for-your-tenant).
2. [Настройка Azure Monitor на отправку оповещений системы безопасности из клиента в концентратор событий](#step-2-configure-azure-monitor-to-send-security-alerts-from-your-tenant-to-the-event-hub).
3. [Скачивание и установка QRadar для использования оповещений системы безопасности](#step-3-download-and-install-the-qradar-to-consume-security-alerts).

После выполнения этих действий IBM QRadar будет получать оповещения системы безопасности от всех интегрированных с Microsoft Graph средств обеспечения безопасности, лицензии на которые есть в клиенте. Все новые лицензированные средства обеспечения безопасности также будут отправлять оповещения через это соединение по той же схеме. Дополнительная интеграция не требуется.

## <a name="step-1-set-up-an-event-hubs-namespace-in-azure-to-receive-security-alerts-for-your-tenant"></a>Этап 1. Настройка пространства имен для концентраторов событий в Azure на получение оповещений системы безопасности для клиента

Для начала необходимо создать пространство имен [концентраторов событий Microsoft Azure](https://docs.microsoft.com/ru-RU/azure/event-hubs/) и концентратор событий. Это пространство имен и концентратор событий будут пунктом назначения для всех оповещений системы безопасности в организации. Пространство имен концентраторов событий — это логическая группа концентраторов событий с одной и той же политикой доступа. Обратите внимание на несколько особенностей этого пространства имен и создаваемых вами концентраторов событий.

- Рекомендуем использовать стандартное пространство имен концентраторов событий, особенно при отправке других данных мониторинга Azure через те же концентраторы событий.
- Как правило, требуется только одна единица пропускной способности. Если активность использования концентратора повысится, вы можете вручную увеличивать количество единиц пропускной способности для пространства имен или включить автоматическое расширение.
- Количество единиц пропускной способности позволяет повышать масштаб пропускной способности для концентраторов событий. Путем изменения количества разделов вы можете параллелизовать потребление для множества пользователей. Скорость одного раздела может достигать 20 МБ/с или приблизительно 20 000 сообщений в секунду. Поддержка получения данных из нескольких разделов зависит от того, какое средство получает данные. Если вы не уверены, сколько разделов следует создать, рекомендуем начать с четырех.
- Рекомендуем задать для концентратора событий срок хранения сообщений, составляющий 7 дней. Благодаря этому, если средство получения данных выйдет из строя более чем на день, оно сможет продолжить работу с того же момента (для событий не старше 7 дней).
- Рекомендуем использовать для концентратора событий группу потребителей по умолчанию. Создавать другие группы потребителей или использовать отдельную группу не требуется, если вы не планируете получать данные из одного концентратора событий с помощью двух разных средств.
- Как правило, на компьютере, получающем данные из концентратора событий, должны быть открыты порты 5671 и 5672.

См. также: [Часто задаваемые вопросы о концентраторах событий в Azure](https://docs.microsoft.com/ru-RU/azure/event-hubs/event-hubs-faq).

1. Войдите на [портал Azure](https://portal.azure.com/) и нажмите **Создать ресурс** в левой верхней части экрана.

    ![Изображение кнопки для создания ресурса](images/create-resource.png)

2. Выберите **"Интернет вещей"**, а затем — **Концентраторы событий**.

    ![Изображение концентраторов событий](images/event-hubs.png)

3. В поле **Создать пространство имен** введите имя пространства имен. Убедившись, что имя пространства имен доступно, выберите ценовую категорию (базовую или стандартную). Кроме того, выберите подписку Azure, группу ресурсов и расположение для создания ресурса. Нажмите кнопку **Создать**, чтобы создать пространство имен. Возможно, вам потребуется подождать несколько минут, чтобы система полностью подготовила ресурсы.

    ![Изображение окна для создания пространства имен](images/create-namespace.png)

## <a name="step-2-configure-azure-monitor-to-send-security-alerts-from-your-tenant-to-the-event-hub"></a>Этап 2. Настройка Azure Monitor на отправку оповещений системы безопасности из клиента в концентратор событий

Достаточно один раз включить потоковую передачу оповещений от системы безопасности организации через Azure Monitor для всего клиента Azure Active Directory (Azure AD). Все продукты с поддержкой и лицензией на API безопасности Microsoft Graph начнут отправлять оповещения системы безопасности в Azure Monitor, выполняя потоковую передачу данных принимающим приложениям. Все остальные продукты с поддержкой API безопасности Microsoft Graph, лицензированные и развернутые в организации, автоматически начнут потоковую передачу оповещений системы безопасности с использованием той же конфигурации Azure Monitor. От организации не потребуется дополнительных действий по интеграции.

Оповещения системы безопасности обладают широкими правами, и их обычно могут просматривать только сотрудники групп реагирования и глобальные администраторы организации. По этой причине, чтобы настроить интеграцию оповещений системы безопасности в клиенте с системами SIEM, необходима учетная запись глобального администратора Azure AD. Эта учетная запись потребуется только один раз, во время настройки, чтобы запросить отправку оповещений от службы безопасности организации в Azure Monitor.

> **Примечание.** В настоящее время колонка параметров диагностики в Azure Monitor не поддерживает настройку ресурсов на уровне клиента. Оповещения API безопасности Microsoft Graph являются ресурсом на уровне клиента, что требует использования API Azure Resource Manager, чтобы настроить Azure Monitor на поддержку получения оповещений от системы безопасности организации.

1. В подписке Azure (можно найти в разделе "Все службы") зарегистрируйте "microsoft.insights" (Azure Monitor) в качестве поставщика ресурсов.  
 > **Примечание.** Не указывайте "Microsoft.SecurityGraph" (API безопасности Microsoft Graph) в качестве поставщика ресурсов в своей подписке Azure, поскольку "Microsoft.SecurityGraph" является ресурсом на уровне клиента, как указано выше. Настройка на уровне клиента рассматривается в п. 6 ниже.

2. Чтобы настроить Azure Monitor с помощью API Azure Resource Manager, приобретите средство [ARMClient](https://github.com/projectkudu/ARMClient). С его помощью можно отправлять вызовы REST API на портал Azure из командной строки.

3. Подготовьте примерно такой файл JSON с запросом параметров диагностики:

    ``` json
    {
      "location": "",
      "properties": {
        "name": "securityApiAlerts",
        "serviceBusRuleId": "/subscriptions/SUBSCRIPTION_ID/resourceGroups/RESOURCE_GROUP/providers/Microsoft.EventHub/namespaces/EVENT_HUB_NAMESPACE/authorizationrules/RootManageSharedAccessKey",
        "logs": [
          {
            "category": "Alert",
            "enabled": true,
            "retentionPolicy": {
              "enabled": true,
              "days": 7
            }
          }
        ]
      }
    }
    ```

  Замените значения в файле JSON, как указано ниже.

  * **SUBSCRIPTION_ID** — это ИД подписки Azure, где размещаются группа ресурсов и пространство имен концентраторов событий, в которые будут отправляться оповещения системы безопасности из вашей организации.
  * **RESOURCE_GROUP** — это группа ресурсов, содержащая пространство имен концентраторов событий, в которое будут отправляться оповещения системы безопасности из вашей организации.
  * **EVENT_HUB_NAMESPACE** — это пространство концентраторов событий, в которое будут отправляться оповещения системы безопасности из вашей организации.
  * **"days"** — это количество дней, в течение которого в концентраторе событий будут храниться сообщения.
  
&nbsp;

4. Сохраните файл в формате JSON в том же каталоге, где будет запускаться программа ARMClient.exe. Например, назовите файл **AzMonConfig.json.**

5. Выполните приведенную ниже команду, чтобы войти в средство ARMClient. Необходимо использовать учетные данные глобального администратора.

    ``` shell
    ARMClient.exe login
    ```

6. Выполните приведенную ниже команду, чтобы настроить Azure Monitor на отправку оповещений системы безопасности в пространство имен концентраторов событий. При этом в пространстве имен будет автоматически подготовлен концентратор событий, в который будет запущен поток оповещений системы безопасности. Убедитесь, что имя параметра (в данном примере — **securityApiAlerts**) совпадает с указанным в поле **name** JSON-файла.

    ``` shell
    ARMClient.exe put https://management.azure.com/providers/Microsoft.SecurityGraph/diagnosticSettings/securityApiAlerts?api-version=2017-04-01-preview  @".\AzMonConfig.json"
    ```

7. Чтобы убедиться, что параметры применены должным образом, выполните приведенную ниже команду и убедитесь, что выходные данные совпадают с параметрами из JSON-файла.

    ``` shell
    ARMClient.exe get https://management.azure.com/providers/Microsoft.SecurityGraph/diagnosticSettings/securityApiAlerts?api-version=2017-04-01-preview
    ```

8. Закройте средство ARMClient. Теперь Azure Monitor настроен на отправку оповещений системы безопасности из клиента в концентратор событий.

## <a name="step-3-download-and-install-the-qradar-to-consume-security-alerts"></a>Этап 3. Скачивание и установка QRadar для использования оповещений системы безопасности

1. Скачайте и установите [IBM QRadar](https://www.ibm.com/us-en/marketplace/ibm-qradar-siem). **Требуется версия 7.2.8 с исправлением 7 или более поздняя**, чтобы считывать события из концентратора событий Microsoft Azure.
2. Чтобы настроить концентратор событий, выполните действия, описанные в статье [Настройка концентраторов событий Microsoft Azure с помощью IBM QRadar](https://www.ibm.com/support/knowledgecenter/SS42VS_DSM/t_dsm_guide_microsoft_azure_enable_event_hubs.html).
3. Наконец, выполните действия, описанные в статье [Настройка QRadar для сбора событий из концентраторов событий Microsoft Azure с помощью протокола концентраторов событий Microsoft Azure](https://www.ibm.com/support/knowledgecenter/SS42VS_DSM/t_logsource_microsoft_azure_event_hubs.html), чтобы начать отображение оповещений системы безопасности.
  
 > **Примечание.** Интеграция Microsoft Azure с IBM QRadar поддерживает события, перечисленные в [спецификациях Microsoft Azure DSM](https://www.ibm.com/support/knowledgecenter/SS42VS_DSM/c_dsm_guide_microsoft_azure_DSM_specs.html). В настоящее время мы работаем с IBM QRadar над добавлением полной поддержки оповещений API безопасности Microsoft Graph. В данный момент можно получать оповещения API безопасности Microsoft Graph и просматривать их в консоли IBM QRadar. Вы можете использовать [редактор DSM](https://www.ibm.com/support/knowledgecenter/SS42VS_7.2.8/com.ibm.qradar.doc/c_qradar_adm_dsm_ed_overview.html), чтобы включить анализ оповещений API безопасности Microsoft Graph.  
