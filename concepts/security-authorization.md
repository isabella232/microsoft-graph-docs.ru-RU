---
title: Авторизация и API безопасности Microsoft Graph
description: Данные безопасности, доступные через API безопасности Microsoft Graph, являются конфиденциальными и защищаются как разрешениями, так и ролями Azure Active Directory (Azure AD).
author: preetikr
localization_priority: Priority
ms.prod: security
ms.openlocfilehash: 52f781eecef1da2d801025d4ba2409f9297b5cd8
ms.sourcegitcommit: b8d01acfc1cb7610a0e1f5c18065da415bae0777
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "33621230"
---
# <a name="authorization-and-the-microsoft-graph-security-api"></a><span data-ttu-id="f7f3e-103">Авторизация и API безопасности Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="f7f3e-103">Authorization and the Microsoft Graph Security API</span></span>

<span data-ttu-id="f7f3e-104">Данные безопасности, доступные через API безопасности Microsoft Graph, являются конфиденциальными и защищаются как разрешениями, так и ролями Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-104">Security data accessible via the Microsoft Graph Security API is sensitive and protected by both permissions and Azure Active Directory (Azure AD) roles.</span></span>

<span data-ttu-id="f7f3e-105">API безопасности Microsoft Graph поддерживает два типа авторизации:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-105">The Microsoft Graph Security API supports two types of authorization:</span></span>

- <span data-ttu-id="f7f3e-106">**Авторизация на уровне приложения:** отсутствует вошедший в систему пользователь (например, сценарий SIEM).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-106">**Application-level authorization** - There is no signed-in user (for example, a SIEM scenario).</span></span> <span data-ttu-id="f7f3e-107">Разрешения, предоставленные приложению, определяют авторизацию.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-107">The permissions granted to the application determine authorization.</span></span> 
    ><span data-ttu-id="f7f3e-108">**Примечание.** Этот вариант также поддерживает сценарии, в которых управление доступом на основе ролей (RBAC) осуществляется приложением.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-108">**Note:** This option can also support cases where Role-Based Access Control (RBAC) is managed by the application.</span></span>
- <span data-ttu-id="f7f3e-109">**Авторизация, делегированная пользователю:** вход осуществляет пользователь, являющийся участником клиента Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-109">**User delegated authorization** - A user who is a member of the Azure AD tenant is signed in.</span></span> <span data-ttu-id="f7f3e-110">Пользователь должен быть участником с ролью ограниченного администратора Azure AD — читатель безопасности или администратор безопасности, помимо предоставления необходимых разрешений приложением.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-110">The user must be a member of an Azure AD Limited Admin role - either Security Reader or Securty Administrator - in addition to the application having been granted the required permissions.</span></span>

<span data-ttu-id="f7f3e-111">При вызове API безопасности Microsoft Graph из песочницы Graph:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-111">If you're calling the Microsoft Graph Security API from Graph Explorer:</span></span>

- <span data-ttu-id="f7f3e-112">Администратор клиента Azure AD должен явным образом предоставить согласие на требуемые разрешения для приложения песочницы Graph.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-112">The Azure AD tenant admin must explicitly grant consent for the requested permissions to the Graph Explorer application.</span></span>
- <span data-ttu-id="f7f3e-113">Пользователь должен быть участником с ограниченной административной ролью читателя безопасности в Azure AD (читателем безопасности или администратором безопасности).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-113">The user must be a member of the Security Reader Limited Admin role in Azure AD (either Security Reader or Security Administrator).</span></span>

><span data-ttu-id="f7f3e-114">**Примечание.** Песочница Graph не поддерживает авторизацию на уровне приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-114">**Note**: Graph Explorer does not support application-level authorization.</span></span>

<span data-ttu-id="f7f3e-115">При вызове API безопасности Microsoft Graph из пользовательского или собственного приложения:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-115">If you're calling the Microsoft Graph Security API from a custom or your own application:</span></span>

- <span data-ttu-id="f7f3e-116">Администратор клиента Azure AD клиента должен явным образом предоставить разрешение для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-116">The Azure AD tenant admin must explicitly grant consent to your application.</span></span> <span data-ttu-id="f7f3e-117">Это необходимо как для авторизации на уровне приложения, так и для авторизации, делегированной пользователю.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-117">This is required both for application-level authorization and user delegated authorization.</span></span>
- <span data-ttu-id="f7f3e-118">При использовании авторизации, делегированной пользователю, пользователь должен быть участником с ограниченной административной ролью администратора или читателя безопасности в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-118">If you're using user delegated authorization, the user must be a member of the Security Reader or Security Administrator Limited Admin role in Azure AD.</span></span>

## <a name="manage-authorization-in-security-api-client-applications"></a><span data-ttu-id="f7f3e-119">Управление авторизацией в клиентских приложениях API безопасности</span><span class="sxs-lookup"><span data-stu-id="f7f3e-119">Manage authorization in security API client applications</span></span>

<span data-ttu-id="f7f3e-120">Данные безопасности, предоставляемые посредством API безопасности Microsoft Graph, являются конфиденциальными и должны защищаться соответствующими механизмами аутентификации и авторизации.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-120">Security data provided via the Microsoft Graph Security API is sensitive and must be protected by appropriate authentication and authorization mechanisms.</span></span> <span data-ttu-id="f7f3e-121">В таблице ниже перечислены необходимые действия, чтобы зарегистрировать и создать клиентское приложение, в котором есть доступ к API безопасности Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-121">The following table lists the steps to register and create a client application that can access the Microsoft Graph Security API.</span></span>

| <span data-ttu-id="f7f3e-122">**Кто**</span><span class="sxs-lookup"><span data-stu-id="f7f3e-122">**Who**</span></span> | <span data-ttu-id="f7f3e-123">**Действие**</span><span class="sxs-lookup"><span data-stu-id="f7f3e-123">**Action**</span></span> |
|:---------------------|:------------------|
|<span data-ttu-id="f7f3e-124">Разработчик приложения или владелец</span><span class="sxs-lookup"><span data-stu-id="f7f3e-124">Application developer or owner</span></span>|<span data-ttu-id="f7f3e-125">Регистрация приложения в качестве корпоративного приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-125">Register the application as an enterprise application.</span></span>|
|<span data-ttu-id="f7f3e-126">Администратор клиента</span><span class="sxs-lookup"><span data-stu-id="f7f3e-126">Tenant admin</span></span>|<span data-ttu-id="f7f3e-127">Предоставление разрешений для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-127">Grant permissions to the application.</span></span>|
|<span data-ttu-id="f7f3e-128">Администратор клиента</span><span class="sxs-lookup"><span data-stu-id="f7f3e-128">Tenant admin</span></span>|<span data-ttu-id="f7f3e-129">Назначение ролей пользователям</span><span class="sxs-lookup"><span data-stu-id="f7f3e-129">Assign roles to users.</span></span>|
|<span data-ttu-id="f7f3e-130">Разработчик приложения</span><span class="sxs-lookup"><span data-stu-id="f7f3e-130">Application developer</span></span>|<span data-ttu-id="f7f3e-131">Вход в качестве пользователя и использование приложения для доступа к API безопасности Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-131">Sign in as the user and use the application to access the Microsoft Graph Security API.</span></span>|

<span data-ttu-id="f7f3e-132">Регистрация приложения лишь определяет, какие разрешения необходимы приложению, чтобы его запустить.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-132">Application registration only defines which permissions the application needs in order to run.</span></span> <span data-ttu-id="f7f3e-133">Она НЕ предоставляет разрешений для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-133">It does NOT grant these permissions to the application.</span></span>

<span data-ttu-id="f7f3e-134">Администратор клиента Azure AD ДОЛЖЕН явным образом предоставить разрешения для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-134">The Azure AD tenant administrator MUST explicitly grant the permissions to the application.</span></span> <span data-ttu-id="f7f3e-135">Это должно выполняться для каждого клиента *каждый раз*, когда разрешения приложения изменяются на портале регистрации приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-135">This must be done per tenant and must be *performed every time* the application permissions are changed in the application registration portal.</span></span>

<span data-ttu-id="f7f3e-136">Предположим, например, что у вас есть приложение, два клиента Azure AD, **T1** и **T2,** и два разрешения, **P1** и **P2**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-136">For example, assume that you have an application, two Azure AD tenants, **T1** and **T2**, and two permissions, **P1** and **P2**.</span></span> <span data-ttu-id="f7f3e-137">Ниже приведен процесс авторизация.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-137">The following is the authorization process:</span></span>

- <span data-ttu-id="f7f3e-138">Приложение регистрируется для затребования разрешения **P1**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-138">The application registers to require permission **P1**.</span></span>
- <span data-ttu-id="f7f3e-139">Когда пользователи клиента **T1** получают маркер Azure AD для этого приложения, маркер не содержит каких-либо разрешений.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-139">When users in tenant **T1** get an Azure AD token for this application, the token does not contain any permissions.</span></span>
- <span data-ttu-id="f7f3e-140">Администратор Azure AD клиента **T1** явным образом предоставляет разрешения для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-140">The Azure AD admin of tenant **T1** explicitly grants permissions to the application.</span></span> <span data-ttu-id="f7f3e-141">Когда пользователи клиента **T1** получают маркер Azure AD для приложения, он содержит разрешение **P1**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-141">When users in tenant **T1** get an Azure AD token for the application, it will contain permission **P1**.</span></span>
- <span data-ttu-id="f7f3e-142">Когда пользователи клиента **T2** получают маркер Azure AD для приложения, маркер не содержит каких-либо разрешений, поскольку администратор клиента **T2** еще не предоставил разрешений для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-142">When users in tenant **T2** get an Azure AD token for the application, the token does not contain any permissions - because the admin of tenant **T2** did not yet grant permissions to the application.</span></span> <span data-ttu-id="f7f3e-143">Разрешение должно быть предоставлено *для каждого клиента* и *для каждого приложения*.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-143">Permission must be granted *per tenant* and *per application*.</span></span>
- <span data-ttu-id="f7f3e-144">Регистрация приложения изменяется и теперь требует разрешений **P1** и **P2**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-144">The application has its registration changed to now require permissions **P1** and **P2**.</span></span>
- <span data-ttu-id="f7f3e-145">Когда пользователи клиента **T1** получают маркер Azure AD для приложения, он содержит только разрешение **P1**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-145">When users in tenant **T1** get an Azure AD token for the application, it only contains permission **P1**.</span></span> <span data-ttu-id="f7f3e-146">Разрешения, предоставленные приложению, фиксируются в виде снимков полученного. Они *не изменяются автоматически* после изменения регистрации приложения (разрешения).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-146">Permissions granted to an application are recorded as snapshots of what was granted - they *do not change automatically* after the application registration (permission) changes.</span></span>
- <span data-ttu-id="f7f3e-147">Администратор клиента **T2** предоставляет разрешения **P1** и **P2** для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-147">The admin of tenant **T2** grants permissions **P1** and **P2** to the application.</span></span> <span data-ttu-id="f7f3e-148">Теперь, когда пользователи клиента **T2** получают маркер Azure AD для приложения, маркер содержит разрешения **P1** и **P2**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-148">Now, when users in tenant **T2** get an Azure AD token for the application, the token will contain permissions **P1** and **P2**.</span></span>

><span data-ttu-id="f7f3e-149">**Примечание**. Маркеры Azure AD для приложения в клиенте **T1** и приложения в клиенте **T2** содержат разные разрешения, потому что каждый администратор клиента предоставил разные разрешения для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-149">**Note**: The Azure AD tokens for the application in tenant **T1** and the application in tenant **T2** contain different permissions, because each tenant admin has granted different permissions to the application.</span></span>

- <span data-ttu-id="f7f3e-150">Чтобы приложение вновь заработало в клиенте **T1**, администратор клиента **T1** должен явным образом предоставить разрешения **P1** и **P2** для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-150">To make the application work again in tenant **T1**, the admin of tenant **T1** must explicitly grant permissions **P1** and **P2** to the application.</span></span>

## <a name="register-an-application-with-the-microsoft-identity-platform-endpoint"></a><span data-ttu-id="f7f3e-151">Регистрация приложения с помощью конечной точки платформы удостоверений Майкрософт</span><span class="sxs-lookup"><span data-stu-id="f7f3e-151">Register an application with the Microsoft identity platform</span></span>

<span data-ttu-id="f7f3e-152">Чтобы зарегистрировать приложение в конечной точке платформы удостоверений Майкрософт, необходимо следующее:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-152">To register an application to the Azure AD v2.0 endpoint, you'll need:</span></span>

- <span data-ttu-id="f7f3e-153">**Имя приложения** — строка, используемая в качестве имени приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-153">**Application name** - A string used for the application name.</span></span>
- <span data-ttu-id="f7f3e-154">**URL-адрес перенаправления** — URL-адрес, куда направляется ответ по проверке подлинности из Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-154">**Redirect URL** - The URL where the authentication response from Azure AD is sent.</span></span> <span data-ttu-id="f7f3e-155">Чтобы начать, можно использовать домашнюю страницу веб-приложения тестового клиента.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-155">To start, you can use the test client web app homepage.</span></span>
- <span data-ttu-id="f7f3e-156">**Требуемые разрешения** — разрешения, необходимые для вашего приложения, чтобы вызвать Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-156">**Required Permissions** - The permissions that your application requires to be able to call Microsoft Graph.</span></span>

<span data-ttu-id="f7f3e-157">Чтобы зарегистрировать приложение:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-157">To register your application:</span></span>

1. <span data-ttu-id="f7f3e-158">Перейдите на [портал регистрации приложений Azure](https://go.microsoft.com/fwlink/?linkid=2083908) и выполните вход.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-158">Go to the [Azure portal](https://go.microsoft.com/fwlink/?linkid=2083908) and sign in.</span></span>
    ><span data-ttu-id="f7f3e-159">**Примечание**. Вам не нужно быть администратором клиента. Вы будете перенаправлены в список **Мои приложения**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-159">**Note**: You don't have to be a tenant admin. You will be redirected to the **My applications** list.</span></span>
2. <span data-ttu-id="f7f3e-160">Выберите **Новая регистрация**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-160">Choose **New registration**.</span></span>
3. <span data-ttu-id="f7f3e-161">На странице регистрации нового приложения введите значение в поле **Имя** и выберите поддерживаемые типы учетных записей.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-161">On the registration page for the new application, enter a value for **Name** and select the account types you wish to support.</span></span> <span data-ttu-id="f7f3e-162">В поле **URI перенаправления** введите URL-адрес перенаправления.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-162">In the **Redirect URL** field, enter the redirect URL.</span></span>
4. <span data-ttu-id="f7f3e-163">Нажмите кнопку **Зарегистрировать**, чтобы создать приложение и посмотреть его обзорную страницу.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-163">Select **Register** to create the app and view its overview page.</span></span>
5. <span data-ttu-id="f7f3e-164">Перейдите на страницу **Разрешения API** приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-164">Go to the app's **API permissions** page.</span></span>
6. <span data-ttu-id="f7f3e-165">Нажмите кнопку **Добавить разрешение** и выберите вариант **Microsoft Graph** во всплывающем окне.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-165">Select **Add a permission** and then choose **Microsoft Graph** in the flyout.</span></span> <span data-ttu-id="f7f3e-166">Выберите **Делегированные разрешения**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-166">Select **Delegated permissions**.</span></span> <span data-ttu-id="f7f3e-167">Чтобы найти и выбрать требующиеся разрешения, используйте поле поиска.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-167">Use the search box to find and select the required permissions.</span></span> <span data-ttu-id="f7f3e-168">Список разрешений см. в статье [Разрешения безопасности](permissions-reference.md#security-permissions).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-168">For a list of permissions, see [Security permissions](permissions-reference.md#security-permissions).</span></span>

    ><span data-ttu-id="f7f3e-169">**Примечание.** Microsoft Graph Security API требуется область \*.Read.All для запросов GET и область \*.ReadWrite.All для запросов PATCH/POST/DELETE.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-169">**Note:** The Microsoft Graph Security API requires the \*.Read.All scope for GET queries, and the \*.ReadWrite.All scope for PATCH/POST/DELETE queries.</span></span>

    |<span data-ttu-id="f7f3e-170">Разрешение</span><span class="sxs-lookup"><span data-stu-id="f7f3e-170">Permission</span></span> | <span data-ttu-id="f7f3e-171">Объект</span><span class="sxs-lookup"><span data-stu-id="f7f3e-171">Entity</span></span> | <span data-ttu-id="f7f3e-172">Поддерживаемые запросы</span><span class="sxs-lookup"><span data-stu-id="f7f3e-172">Supported requests</span></span> |
    |:----------|:-------|:-------------------|
    |<span data-ttu-id="f7f3e-173">SecurityActions.Read.All</span><span class="sxs-lookup"><span data-stu-id="f7f3e-173">SecurityActions.Read.All</span></span>| <span data-ttu-id="f7f3e-174">&bull; [securityActions](/graph/api/resources/securityaction?view=graph-rest-beta) (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-174">&bull; [securityActions](/graph/api/resources/securityaction?view=graph-rest-beta) (preview)</span></span> | <span data-ttu-id="f7f3e-175">GET</span><span class="sxs-lookup"><span data-stu-id="f7f3e-175">GET</span></span> |
    |<span data-ttu-id="f7f3e-176">SecurityActions.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="f7f3e-176">SecurityActions.ReadWrite.All</span></span>| <span data-ttu-id="f7f3e-177">&bull; [securityActions](/graph/api/resources/securityaction?view=graph-rest-beta) (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-177">&bull; [securityActions](/graph/api/resources/securityaction?view=graph-rest-beta) (preview)</span></span> | <span data-ttu-id="f7f3e-178">GET, POST</span><span class="sxs-lookup"><span data-stu-id="f7f3e-178">GET, POST</span></span> |
    |<span data-ttu-id="f7f3e-179">SecurityEvents.Read.All</span><span class="sxs-lookup"><span data-stu-id="f7f3e-179">SecurityEvents.Read.All</span></span> | <span data-ttu-id="f7f3e-180">&bull; [alerts](/graph/api/resources/alert?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-180">&bull; [alerts](/graph/api/resources/alert?view=graph-rest-1.0)</span></span></br> <span data-ttu-id="f7f3e-181">&bull; [secureScores](/graph/api/resources/securescores?view=graph-rest-beta)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-181">&bull; [secureScores](/graph/api/resources/securescores?view=graph-rest-beta) (preview)</span></span> </br> <span data-ttu-id="f7f3e-182">&bull; [secureScoreControlProfiles](/graph/api/resources/securescorecontrolprofiles?view=graph-rest-beta)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-182">&bull; [secureScoreControlProfiles](/graph/api/resources/securescorecontrolprofiles?view=graph-rest-beta)</span></span> | <span data-ttu-id="f7f3e-183">GET</span><span class="sxs-lookup"><span data-stu-id="f7f3e-183">GET</span></span> |
    |<span data-ttu-id="f7f3e-184">SecurityEvents.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="f7f3e-184">SecurityEvents.ReadWrite.All</span></span> | <span data-ttu-id="f7f3e-185">&bull; [alerts](/graph/api/resources/alert?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-185">&bull; [alerts](/graph/api/resources/alert?view=graph-rest-1.0)</span></span></br> <span data-ttu-id="f7f3e-186">&bull; [secureScores](/graph/api/resources/securescores?view=graph-rest-beta)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-186">&bull; [secureScores](/graph/api/resources/securescores?view=graph-rest-beta) (preview)</span></span> </br> <span data-ttu-id="f7f3e-187">&bull; [secureScoreControlProfiles](/graph/api/resources/securescorecontrolprofiles?view=graph-rest-beta)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-187">&bull; [secureScoreControlProfiles](/graph/api/resources/securescorecontrolprofiles?view=graph-rest-beta)</span></span> | <span data-ttu-id="f7f3e-188">GET, POST, PATCH</span><span class="sxs-lookup"><span data-stu-id="f7f3e-188">GET, POST, PATCH</span></span> |
    |<span data-ttu-id="f7f3e-189">ThreatIndicators.ReadWrite.OwnedBy</span><span class="sxs-lookup"><span data-stu-id="f7f3e-189">ThreatIndicators.ReadWrite.OwnedBy</span></span> | <span data-ttu-id="f7f3e-190">&bull; [tiIndicator](/graph/api/resources/tiindicator?view=graph-rest-beta) (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-190">&bull; [tiIndicator](/graph/api/resources/tiindicator?view=graph-rest-beta) (preview)</span></span> | <span data-ttu-id="f7f3e-191">GET, POST, PATCH, DELETE</span><span class="sxs-lookup"><span data-stu-id="f7f3e-191">GET, POST, PATCH, DELETE</span></span>|

7. <span data-ttu-id="f7f3e-192">Нажмите кнопку **Добавить разрешения**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-192">Choose **Add permissions**.</span></span>

<span data-ttu-id="f7f3e-193">Сохраните следующие сведения:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-193">Save the following information:</span></span>

- <span data-ttu-id="f7f3e-194">Идентификатор приложения (клиента)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-194">Application (client) ID</span></span>
- <span data-ttu-id="f7f3e-195">URL-адрес перенаправления</span><span class="sxs-lookup"><span data-stu-id="f7f3e-195">Redirect URL</span></span>
- <span data-ttu-id="f7f3e-196">Список необходимых разрешений</span><span class="sxs-lookup"><span data-stu-id="f7f3e-196">List of required permissions</span></span>

<span data-ttu-id="f7f3e-197">Дополнительные сведения см. в статье [Регистрация приложения с помощью платформы удостоверений Майкрософт](auth-register-app-v2.md).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-197">For more information, see [Register your app with the Microsoft identity platform](auth-register-app-v2.md).</span></span>

## <a name="grant-permissions-to-an-application"></a><span data-ttu-id="f7f3e-198">Предоставление разрешений для приложения</span><span class="sxs-lookup"><span data-stu-id="f7f3e-198">Grant permissions to an application</span></span>

<span data-ttu-id="f7f3e-199">Регистрация приложения лишь определяет, какое разрешение требуется для приложение. Она не предоставляет эти разрешения для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-199">Application registration only defines which permission the application requires - it does not grant these permissions to the application.</span></span> <span data-ttu-id="f7f3e-200">Администратор клиента Azure AD должен явным образом предоставить эти разрешения, вызвав конечную точку разрешения администратора.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-200">An Azure AD tenant administrator must explicitly grant these permissions by making a call to the admin consent endpoint.</span></span> <span data-ttu-id="f7f3e-201">Дополнительные сведения см. в статье [Использование конечной точки разрешения администратора](https://docs.microsoft.com/ru-RU/azure/active-directory/develop/active-directory-v2-scopes#using-the-admin-consent-endpoint).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-201">For details, see [Using the admin consent endpoint](https://docs.microsoft.com/ru-RU/azure/active-directory/develop/active-directory-v2-scopes#using-the-admin-consent-endpoint).</span></span>

<span data-ttu-id="f7f3e-202">Чтобы предоставить разрешения для приложения, необходимо следующее:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-202">To grant permissions to an application, you'll need:</span></span>

- <span data-ttu-id="f7f3e-203">**Идентификатор приложения**. Идентификатор приложения из портала регистрации приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-203">**Application ID** - The application ID from application registration portal.</span></span>
- <span data-ttu-id="f7f3e-204">**URL-адрес перенаправления** — строка, заданная на портале регистрации приложений Azure для отклика проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-204">**Redirect URL** - The string you set in the application registration portal for authentication response.</span></span>

<span data-ttu-id="f7f3e-205">Чтобы предоставить разрешения:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-205">To grant the permissions:</span></span>

- <span data-ttu-id="f7f3e-206">В текстовом редакторе создайте следующую строку URL-адреса:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-206">In a text editor, create following URL string:</span></span>

    `https://login.microsoftonline.com/common/adminconsent?client_id=<Application Id>&state=12345&redirect_uri=<Redirect URL>`

- <span data-ttu-id="f7f3e-207">В веб-браузере перейдите на этот URL-адрес и войдите в качестве администратора клиента.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-207">In a web browser, go to this URL, and sign in as a tenant administrator.</span></span> <span data-ttu-id="f7f3e-208">Диалоговое окно отображает список разрешений, требуемых для приложения, как указано на портале регистрации приложений.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-208">The dialog box shows the list of permission the application requires, as specified in the application registration portal.</span></span> <span data-ttu-id="f7f3e-209">Нажмите кнопку **OK**, чтобы предоставить эти разрешения для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-209">Choose **OK** to grant the application these permissions.</span></span>

> <span data-ttu-id="f7f3e-210">**Примечание.** Это действие предоставляет разрешения для приложения, а не для пользователей.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-210">**Note:** This step grants permissions to the application - not to users.</span></span> <span data-ttu-id="f7f3e-211">Это означает, что всем пользователям, относящимся к клиенту Azure AD, которые используют это приложение, будут предоставлены эти разрешения, даже пользователям без прав администратора.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-211">This means that all users belonging to the Azure AD tenant that use this application will be granted these permissions - even non-admin users.</span></span>

## <a name="assign-azure-ad-roles-to-users"></a><span data-ttu-id="f7f3e-212">Назначение ролей Azure AD для пользователей</span><span class="sxs-lookup"><span data-stu-id="f7f3e-212">Assign Azure AD roles to users</span></span>

<span data-ttu-id="f7f3e-213">После получения приложением разрешений, каждый, кто имеет доступ к приложению (т. е. участники клиента Azure AD), получат предоставленные разрешения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-213">After an application is granted permissions, everyone with access to the application (that is, members of the Azure AD tenant) will receive the granted permissions.</span></span> <span data-ttu-id="f7f3e-214">Чтобы обеспечить дополнительную защиту конфиденциальных данных безопасности, API безопасности также требует, чтобы пользователям была назначена роль **читателя безопасности** Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-214">To further protect sensitive security data, the Microsoft Graph Security API also requires users to be assigned the Azure AD **Security Reader** role.</span></span> <span data-ttu-id="f7f3e-215">Дополнительные сведения см. в статьях [Назначение ролей администратора](https://docs.microsoft.com/ru-RU/azure/active-directory/active-directory-assign-admin-roles-azure-portal) и [Назначение пользователю ролей администратора](https://docs.microsoft.com/ru-RU/azure/active-directory/active-directory-users-assign-role-azure-portal).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-215">For details, see [Assigning administrator roles](https://docs.microsoft.com/ru-RU/azure/active-directory/active-directory-assign-admin-roles-azure-portal) and [Assign a user to administrator roles](https://docs.microsoft.com/ru-RU/azure/active-directory/active-directory-users-assign-role-azure-portal).</span></span>

><span data-ttu-id="f7f3e-216">**Примечание.** Вы должны быть администратором клиента, чтобы выполнить это действие.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-216">**Note:** You must be a tenant admin to perform this step.</span></span>

<span data-ttu-id="f7f3e-217">Чтобы назначить роли пользователям:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-217">To assign roles to users:</span></span>

- <span data-ttu-id="f7f3e-218">Войдите на [портал Azure](https://portal.azure.com) (https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-218">Sign in to the [azure portal](https://portal.azure.com) (https://portal.azure.com).</span></span>
- <span data-ttu-id="f7f3e-219">В меню выберите **Azure Active Directory** > **Пользователи**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-219">In the menu, select **Azure Active Directory** > **Users**.</span></span>
- <span data-ttu-id="f7f3e-220">Выберите имя пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-220">Select the name of the user.</span></span>
- <span data-ttu-id="f7f3e-221">Выберите **Управление** > **Роль каталога**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-221">Select **Manage** > **Directory role**.</span></span>
- <span data-ttu-id="f7f3e-222">Выберите **Ограниченный администратор**и поставьте флажок **Читатель безопасности**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-222">Select **Limited administrator**, and choose the **Security reader** check box.</span></span>
- <span data-ttu-id="f7f3e-223">Нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-223">Choose **Save**.</span></span>

## <a name="create-an-authentication-code"></a><span data-ttu-id="f7f3e-224">Создание кода проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="f7f3e-224">Create an authentication code</span></span>

<span data-ttu-id="f7f3e-225">Чтобы создать код проверки подлинности, необходимо следующее:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-225">To create an authentication code, you'll need:</span></span>

- <span data-ttu-id="f7f3e-226">**Идентификатор приложения**. Идентификатор приложения из портала регистрации приложений.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-226">**Application ID** - The application ID from application registration portal.</span></span>
- <span data-ttu-id="f7f3e-227">**URL-адрес перенаправления** — URL-адрес, куда направляется ответ по проверке подлинности из Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-227">**Redirect URL** - The URL where the authentication response from Azure AD is sent.</span></span> <span data-ttu-id="f7f3e-228">Чтобы начать, можно использовать https://localhost или домашнюю страницу веб-приложения тестового клиента.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-228">To start, you can use https://localhost or the test client web app homepage.</span></span>
- <span data-ttu-id="f7f3e-229">**Ключ приложения** (необязательно) — ключ приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-229">**Application Key** (optional) - The key of the application.</span></span> <span data-ttu-id="f7f3e-230">Это применимо, если вы разрабатываете приложение, которое будет использовать код проверки подлинности только для приложения (т. е. не будет поддерживать проверку подлинности, делегированную пользователю).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-230">This applies when you're developing an application that will use application-only authentication code (that is, will not support user delegated authentication).</span></span>

<span data-ttu-id="f7f3e-231">В таблице ниже перечислены ресурсы, которые можно использовать для создания кода проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-231">The following table lists resources that you can use to create an authentication code.</span></span>

|<span data-ttu-id="f7f3e-232">**Тип приложения**</span><span class="sxs-lookup"><span data-stu-id="f7f3e-232">**Type of application**</span></span>|<span data-ttu-id="f7f3e-233">**Библиотека проверки подлинности**</span><span class="sxs-lookup"><span data-stu-id="f7f3e-233">**Authentication library**</span></span>|
|------------------------|----------------------------|
|[<span data-ttu-id="f7f3e-234">Классические приложения — iOS</span><span class="sxs-lookup"><span data-stu-id="f7f3e-234">Desktop apps - iOS</span></span>](https://docs.microsoft.com/ru-RU/azure/active-directory/develop/guidedsetups/active-directory-ios)|[<span data-ttu-id="f7f3e-235">MSAL.framework: предварительная версия библиотеки проверки подлинности (Майкрософт) для iOS</span><span class="sxs-lookup"><span data-stu-id="f7f3e-235">MSAL.framework: Microsoft Authentication Library Preview for iOS</span></span>](https://github.com/AzureAD/microsoft-authentication-library-for-objc)|
|[<span data-ttu-id="f7f3e-236">Классические приложения — Android</span><span class="sxs-lookup"><span data-stu-id="f7f3e-236">Desktop apps - Android</span></span>](https://docs.microsoft.com/ru-RU/azure/active-directory/develop/guidedsetups/active-directory-android)|[<span data-ttu-id="f7f3e-237">Библиотека проверки подлинности Майкрософт (MSAL)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-237">Microsoft Authentication Library (MSAL)</span></span>](https://javadoc.io/doc/com.microsoft.identity.client/msal)|
|[<span data-ttu-id="f7f3e-238">Классические приложения — .Net</span><span class="sxs-lookup"><span data-stu-id="f7f3e-238">Desktop apps - .Net</span></span>](https://docs.microsoft.com/ru-RU/azure/active-directory/develop/guidedsetups/active-directory-windesktop)|[<span data-ttu-id="f7f3e-239">Библиотека проверки подлинности Майкрософт (MSAL)</span><span class="sxs-lookup"><span data-stu-id="f7f3e-239">Microsoft Authentication Library (MSAL)</span></span>](https://www.nuget.org/packages/Microsoft.Identity.Client)|
|[<span data-ttu-id="f7f3e-240">Веб-приложения — JavaScript SPA</span><span class="sxs-lookup"><span data-stu-id="f7f3e-240">Web apps - JavaScript SPA</span></span>](https://docs.microsoft.com/ru-RU/azure/active-directory/develop/guidedsetups/active-directory-javascriptspa)|[<span data-ttu-id="f7f3e-241">Библиотека проверки подлинности Майкрософт для предварительной версии JavaScript</span><span class="sxs-lookup"><span data-stu-id="f7f3e-241">Microsoft Authentication Library for JavaScript Preview</span></span>](https://github.com/AzureAD/microsoft-authentication-library-for-js)|
|[<span data-ttu-id="f7f3e-242">Веб-приложения — веб-сервер .NET</span><span class="sxs-lookup"><span data-stu-id="f7f3e-242">Web apps - .NET Web Server</span></span>](https://docs.microsoft.com/ru-RU/azure/active-directory/develop/guidedsetups/active-directory-aspnetwebapp)|<span data-ttu-id="f7f3e-243">OpenIdConnection, Cookies, SystemWeb</span><span class="sxs-lookup"><span data-stu-id="f7f3e-243">OpenIdConnection, Cookies, SystemWeb</span></span>|
|[<span data-ttu-id="f7f3e-244">Веб-приложения — веб-приложение NodeJS</span><span class="sxs-lookup"><span data-stu-id="f7f3e-244">Web apps - NodeJS Web App</span></span>](https://docs.microsoft.com/ru-RU/azure/active-directory/develop/active-directory-v2-devquickstarts-node-web)||

<span data-ttu-id="f7f3e-245">Сведения о приложениях, которые не используют существующих библиотек, см. в статье [Получение доступа от имени пользователя](auth-v2-user.md).</span><span class="sxs-lookup"><span data-stu-id="f7f3e-245">For applications that don't use any of the existing libraries, see [Get access on behalf of a user](auth-v2-user.md).</span></span>

1. <span data-ttu-id="f7f3e-246">Получите код от Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-246">Get a code from Azure AD.</span></span> <span data-ttu-id="f7f3e-247">Запрос на вызов содержит параметр для идентификатора приложения, URL-адрес перенаправления и **необходимые разрешения**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-247">The query to call contains parameter for Application ID, Redirect URl, and **required permissions**.</span></span>
2. <span data-ttu-id="f7f3e-248">Используйте код, чтобы получить маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-248">Use the code to get an access token.</span></span>

<span data-ttu-id="f7f3e-249">Если вы используете библиотеку OpenId Connect, см. статью [Проверка подлинности с помощью Azure AD и OpenID Connect](https://docs.microsoft.com/ru-RU/azure/architecture/multitenant-identity/authenticate) и выполните вызов `app.UseOpenIdConnectAuthentication()`.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-249">If you use OpenId Connect library, see [Authenticate using Azure AD and OpenID Connect](https://docs.microsoft.com/ru-RU/azure/architecture/multitenant-identity/authenticate) and call `app.UseOpenIdConnectAuthentication()`.</span></span>

><span data-ttu-id="f7f3e-250">**Примечание.** Если вы запрашиваете маркеры проверки подлинности, делегированной пользователю, то параметр для библиотеки — **Требуемые области**.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-250">**Note:** If you're requesting user delegated authentication tokens, the parameter for the library is **Requested Scopes**.</span></span> <span data-ttu-id="f7f3e-251">Для этого параметра используйте User.Read, вместо того, что требует зарегистрированное приложение.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-251">Use User.Read for this parameter instead of what the registered application requires.</span></span> <span data-ttu-id="f7f3e-252">Параметр **требуемые области** НЕ влияет на разрешения, содержащиеся в возвращаемых маркерах проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-252">The **Requested Scopes** parameter does NOT affect the permissions contained in the returned authentication tokens.</span></span> <span data-ttu-id="f7f3e-253">Они определяются разрешениями, которые предоставил администратор клиента для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-253">These are determined by the permissions that the tenant admin granted the application.</span></span>

<span data-ttu-id="f7f3e-254">Например, если вы используете библиотеку MSAL .NET, выполните следующий вызов:</span><span class="sxs-lookup"><span data-stu-id="f7f3e-254">For example, if you're using the .NET MSAL library, call the following:</span></span>

`var accessToken = (await client.AcquireTokenAsync(scopes)).AccessToken;`

><span data-ttu-id="f7f3e-255">**Примечание.** В этом примере следует использовать наименее привилегированное разрешение, например, User.Read.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-255">**Note:** This example should use the least privileged permission, such as User.Read.</span></span> <span data-ttu-id="f7f3e-256">Тем не менее, возвращаемый маркер доступа может содержать разрешения, которые были предоставлены администратором клиента для текущего пользователя клиента, например User.Read.All или User.ReadWrite.All.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-256">However, the returned access token can contain permissions that were granted by the tenant admin for the current user tenant, such as User.Read.All or User.ReadWrite.All.</span></span>

<span data-ttu-id="f7f3e-257">Azure AD возвращает маркер (строку), который содержит сведения проверки подлинности и разрешения, требуемые для приложения.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-257">A token (string) is returned by Azure AD that contains your authentication information and the permissions required by the application.</span></span> <span data-ttu-id="f7f3e-258">Назначьте этот маркер для заголовка HTTP в качестве маркера носителя, как показано в примере ниже.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-258">Assign this token to the HTTP header as a bearer token, as shown in the following example.</span></span>

`request.Headers.Authorization = new AuthenticationHeaderValue("bearer", accessToken);`

<span data-ttu-id="f7f3e-259">Microsoft Graph проверяет сведения, содержащиеся в этом маркере и предоставляет или отклоняет доступ.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-259">Microsoft Graph will validate the information contained in this token and grant, or reject, access.</span></span>

<span data-ttu-id="f7f3e-260">Чтобы просмотреть утверждения, содержащиеся в возвращаемом маркере, используйте библиотеку NuGet System.IdentityModel.Tokens.Jwt.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-260">To view claims contained in the returned token, use NuGet library System.IdentityModel.Tokens.Jwt.</span></span>

`JwtSecurityTokenHandler tokenHandler = new JwtSecurityTokenHandler();`</br>
`var securityToken = tokenHandler.ReadToken(accessToken) as JwtSecurityToken;`

<span data-ttu-id="f7f3e-261">Ответ от Microsoft Graph содержит заголовок под названием идентификатор запроса клиента, который является идентификатором GUID.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-261">The response from Microsoft Graph contains a header called client-request-id, which is a GUID.</span></span> <span data-ttu-id="f7f3e-262">Если доступ отклонен, укажите GUID при обращении за помощью в [сообщество Microsoft Tech](https://techcommunity.microsoft.com/t5/Microsoft-Graph-Security-API/ct-p/SecurityGraphAPI), чтобы мы смогли помочь разобраться в причинах этой ошибки проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="f7f3e-262">If access is denied, please specify this GUID when seeking support at [Microsoft Tech Community](https://techcommunity.microsoft.com/t5/Microsoft-Graph-Security-API/ct-p/SecurityGraphAPI), so we can help investigate the cause of this authentication failure.</span></span>
