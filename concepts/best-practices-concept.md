# <a name="best-practices-for-working-with-microsoft-graph"></a><span data-ttu-id="fb542-101">Рекомендации по работе с Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="fb542-101">Best practices for working with Microsoft Graph</span></span>

<span data-ttu-id="fb542-102">Эта статья содержит рекомендации по эффективному использованию Microsoft Graph в приложениях, независимо от текущей задачи — знакомство с Microsoft Graph, увеличение производительности или повышение надежности приложения.</span><span class="sxs-lookup"><span data-stu-id="fb542-102">This article describes best practices that you can apply to help your applications get the most out of Microsoft Graph - whether that involves learning about Microsoft Graph, improving app performance, or making your application more reliable for end users.</span></span>

## <a name="use-graph-explorer-to-get-to-know-the-api"></a><span data-ttu-id="fb542-103">Знакомство с API с помощью песочницы Graph</span><span class="sxs-lookup"><span data-stu-id="fb542-103">Use Graph Explorer to get to know the API</span></span>

<span data-ttu-id="fb542-104">Самый простой способ ознакомиться с данными, доступными через Microsoft Graph, — использовать [песочницу Graph](https://aka.ms/ge).</span><span class="sxs-lookup"><span data-stu-id="fb542-104">The easiest way to start exploring the data available through Microsoft Graph is to use [Graph Explorer](https://aka.ms/ge).</span></span> <span data-ttu-id="fb542-105">Песочница Graph позволяет создавать запросы REST (с полной поддержкой CRUD), адаптировать заголовки HTTP-запросов и просматривать ответы с данными.</span><span class="sxs-lookup"><span data-stu-id="fb542-105">Graph Explorer lets you craft REST requests (with full CRUD support), adapt the HTTP request headers, and see the data responses.</span></span> <span data-ttu-id="fb542-106">Песочница Graph также содержит примеры запросов, которые помогут вам приступить к работе.</span><span class="sxs-lookup"><span data-stu-id="fb542-106">To help you get started, Graph Explorer also provides a set of sample queries.</span></span>

<span data-ttu-id="fb542-107">Поэкспериментируйте с новыми API, прежде чем интегрировать их в приложение.</span><span class="sxs-lookup"><span data-stu-id="fb542-107">Experiment with new APIs before you integrate them into your application.</span></span>

## <a name="authentication"></a><span data-ttu-id="fb542-108">Аутентификация</span><span class="sxs-lookup"><span data-stu-id="fb542-108">Authentication</span></span>

<span data-ttu-id="fb542-109">Для доступа к данным в Microsoft Graph приложению необходимо получить маркер доступа OAuth 2.0 и предоставить его службе Microsoft Graph в одном из следующих элементов:</span><span class="sxs-lookup"><span data-stu-id="fb542-109">To access the data in Microsoft Graph, your application will need to acquire an OAuth 2.0 access token, and present it to Microsoft Graph in either of the following:</span></span>

- <span data-ttu-id="fb542-110">заголовке HTTP-запроса *Authorization*, в виде токена *Bearer*;</span><span class="sxs-lookup"><span data-stu-id="fb542-110">The HTTP *Authorization* request header, as a *Bearer* token</span></span>
- <span data-ttu-id="fb542-111">графическом конструкторе клиента при использовании клиентской библиотеки Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="fb542-111">The graph client constructor, when using a Microsoft Graph client library</span></span>

<span data-ttu-id="fb542-112">Чтобы получить маркер доступа к Microsoft Graph, используйте API библиотеки проверки подлинности (Майкрософт) — [MSAL](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-libraries).</span><span class="sxs-lookup"><span data-stu-id="fb542-112">Use the Microsoft Authentication Library API, [MSAL](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-libraries) to acquire the access token to Microsoft Graph.</span></span>

## <a name="consent-and-authorization"></a><span data-ttu-id="fb542-113">Согласие и авторизация</span><span class="sxs-lookup"><span data-stu-id="fb542-113">Consent and authorization</span></span>

<span data-ttu-id="fb542-114">Реализуя согласие и авторизацию в приложении, следуйте приведенным ниже рекомендациям.</span><span class="sxs-lookup"><span data-stu-id="fb542-114">Apply the following best practices for consent and authorization in your app:</span></span>

- <span data-ttu-id="fb542-115">**Руководствуйтесь принципом минимальных прав**.</span><span class="sxs-lookup"><span data-stu-id="fb542-115">**Use least privilege**.</span></span> <span data-ttu-id="fb542-116">Запрашивайте только те разрешения, которые совершенно необходимы, и только тогда, когда они нужны.</span><span class="sxs-lookup"><span data-stu-id="fb542-116">Only request permissions that are absolutely necessary, and only when you need them.</span></span> <span data-ttu-id="fb542-117">По каждому API, вызываемому приложением, ознакомьтесь с разделом "Разрешения" в посвященной ему статье (например, статье [Создание пользователя](../api-reference/v1.0/api/user_post_users.md)) и выберите минимальные разрешения.</span><span class="sxs-lookup"><span data-stu-id="fb542-117">For the APIs your application calls, check the permissions section in the method topics (for example, see [creating a user](../api-reference/v1.0/api/user_post_users.md), and choose the least privileged permissions.</span></span> <span data-ttu-id="fb542-118">Полный список разрешений представлен в [справочнике по разрешениям](permissions_reference.md).</span><span class="sxs-lookup"><span data-stu-id="fb542-118">For a full list of permissions, see [permissions reference](permissions_reference.md).</span></span>

- <span data-ttu-id="fb542-119">**Используйте типы разрешений, подходящие для соответствующих сценариев**.</span><span class="sxs-lookup"><span data-stu-id="fb542-119">**Use the correct permission type based on scenarios**.</span></span> <span data-ttu-id="fb542-120">Если вы создаете интерактивное приложение, в котором присутствует вошедший пользователь, то оно должно использовать *делегированные* разрешения (то есть приложению делегируется разрешение действовать от имени вошедшего пользователя при вызове Microsoft Graph).</span><span class="sxs-lookup"><span data-stu-id="fb542-120">If you're building an interactive application where a signed in user is present, your application should use *delegated* permissions, where the application is delegated permission to act as the signed-in user when making calls to Microsoft Graph.</span></span> <span data-ttu-id="fb542-121">Однако если приложение работает без вошедшего пользователя (как, например, фоновая служба или управляющая программа), то следует использовать разрешения приложений.</span><span class="sxs-lookup"><span data-stu-id="fb542-121">If, however, your application runs without a signed-in user, such as a background service or daemon, your application should use application permissions.</span></span>

    ><span data-ttu-id="fb542-122">**Примечание.** При использовании разрешений для приложений в интерактивных сценариях могут возникать риски, связанные с соответствием требованиям и безопасностью.</span><span class="sxs-lookup"><span data-stu-id="fb542-122">**Note:** Using application permissions for interactive scenarios can put your application at compliance and security risk.</span></span> <span data-ttu-id="fb542-123">Права пользователя на доступ к данным могут быть непреднамеренно повышены в обход политик, настроенных администратором.</span><span class="sxs-lookup"><span data-stu-id="fb542-123">It can inadvertantly elevate a user's privileges to access data, circumnavigating policies configured by an administrator.</span></span>
<!-- LG: Use a more clear lead-in here, like "Consider the end user and admin experience"? -->
- <span data-ttu-id="fb542-124">**Будьте внимательны при настройке приложения**.</span><span class="sxs-lookup"><span data-stu-id="fb542-124">**Be thoughtful when configuring your app**.</span></span> <span data-ttu-id="fb542-125">Это непосредственно повлияет на работу пользователей и администраторов, а также на внедрение приложений и их безопасность.</span><span class="sxs-lookup"><span data-stu-id="fb542-125">This will directly affect end user and admin experiences, along with application adoption and security.</span></span> <span data-ttu-id="fb542-126">Примеры:</span><span class="sxs-lookup"><span data-stu-id="fb542-126">For example:</span></span>

    - <span data-ttu-id="fb542-127">Заявление о конфиденциальности, условия использования, название, логотип и домен приложения будут отображаться в окне согласия и других интерфейсах, поэтому их следует сделать понятными для пользователей.</span><span class="sxs-lookup"><span data-stu-id="fb542-127">Your application's privacy statement, terms of use, name, logo and domain will show up in consent and other experiences - so make sure to configure these carefully so they are understood by your end-users.</span></span>
    - <span data-ttu-id="fb542-128">Учитывайте, кто будет предоставлять согласие вашему приложению — пользователи или администраторы, — и настройте [запрашиваемые разрешения соответствующим образом](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-scopes).</span><span class="sxs-lookup"><span data-stu-id="fb542-128">Consider who will be consenting to your application - either end users or administrators - and configure your application to [request permissions appropriately](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-scopes).</span></span>
    - <span data-ttu-id="fb542-129">Убедитесь, что вы понимаете разницу между [статическим, динамическим и добавочным согласиями](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-compare#incremental-and-dynamic-consent).</span><span class="sxs-lookup"><span data-stu-id="fb542-129">Ensure that you understand the difference between [static, dynamic and incremental consent](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-compare#incremental-and-dynamic-consent).</span></span>

- <span data-ttu-id="fb542-130">**Учитывайте мультитенантные приложения**.</span><span class="sxs-lookup"><span data-stu-id="fb542-130">**Consider multi-tenant applications**.</span></span> <span data-ttu-id="fb542-131">Помните, что у клиентов могут быть разные правила относительно приложений и согласия в разных состояниях.</span><span class="sxs-lookup"><span data-stu-id="fb542-131">Expect customers to have various application and consent controls in different states.</span></span> <span data-ttu-id="fb542-132">Примеры:</span><span class="sxs-lookup"><span data-stu-id="fb542-132">For example:</span></span>

    - <span data-ttu-id="fb542-133">Администраторы клиентов могут запретить пользователям предоставлять согласие приложениям.</span><span class="sxs-lookup"><span data-stu-id="fb542-133">Tenant administrators can disable the ability for end users to consent to applications.</span></span> <span data-ttu-id="fb542-134">В этом случае администратор должен предоставить согласие от имени своих пользователей.</span><span class="sxs-lookup"><span data-stu-id="fb542-134">In this case, an administrator would need to consent on behalf of their users.</span></span>
    - <span data-ttu-id="fb542-135">Администраторы клиентов могут устанавливать специальные политики авторизации, например запрещать пользователям просматривать профили других пользователей или разрешать самостоятельное создание групп только определенным пользователям.</span><span class="sxs-lookup"><span data-stu-id="fb542-135">Tenant administrators can set custom authorization policies such as blocking users from reading other user's profiles, or limiting self-service group creation to a limited set of users.</span></span> <span data-ttu-id="fb542-136">В этом случае приложение должно уметь обрабатывать ошибку 403 при работе от имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="fb542-136">In this case, your application should expect to handle 403 error response when acting on behalf of a user.</span></span>

## <a name="handle-responses-effectively"></a><span data-ttu-id="fb542-137">Эффективная обработка ответов</span><span class="sxs-lookup"><span data-stu-id="fb542-137">Handle responses effectively</span></span>

<span data-ttu-id="fb542-138">В зависимости от того, какие запросы отправляются в Microsoft Graph, приложения должны быть готовы обрабатывать различные ответы.</span><span class="sxs-lookup"><span data-stu-id="fb542-138">Depending on the requests you make to Microsoft Graph, your applications should be prepared to handle different types of responses.</span></span> <span data-ttu-id="fb542-139">Ниже представлены некоторые важные рекомендации, соблюдении которых обеспечит надежную работу приложения.</span><span class="sxs-lookup"><span data-stu-id="fb542-139">The following are some of the most important practices to follow to ensure that your application behaves reliably and predictably for your end users.</span></span>

### <a name="pagination"></a><span data-ttu-id="fb542-140">Разбивка на страницы</span><span class="sxs-lookup"><span data-stu-id="fb542-140">Pagination</span></span>

<span data-ttu-id="fb542-141">Запрашивая информацию из коллекции ресурсов, следует ожидать, что Microsoft Graph вернет набор результатов на нескольких страницах, так как размер страниц на стороне сервера ограничен.</span><span class="sxs-lookup"><span data-stu-id="fb542-141">When querying a resource collection, you should expect that Microsoft Graph will the return result set in multiple pages, due to server-side page size limits.</span></span> <span data-ttu-id="fb542-142">Если набор результатов занимает несколько страниц, Microsoft Graph возвращает в ответе свойство `@odata.nextLink`, содержащее URL-адрес следующей страницы результатов.</span><span class="sxs-lookup"><span data-stu-id="fb542-142">When a result set spans multiple pages, Microsoft Graph returns an `@odata.nextLink` property in the response that contains a URL to the next page of results.</span></span>

<span data-ttu-id="fb542-143">Допустим, нужно получить список сообщений вошедшего пользователя:</span><span class="sxs-lookup"><span data-stu-id="fb542-143">For example, listing the signed-in users messages:</span></span>

```http
GET https://graph.microsoft.com/v1.0/me/messages
```

<span data-ttu-id="fb542-144">Ответ будет содержать свойство `@odata.nextLink`, если размер набора результатов превышает максимальный размер страницы на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="fb542-144">Would return a response containing an `@odata.nextLink` property, if the result set exceeds the server-side page size limit.</span></span>

```json
"@odata.nextLink": "https://graph.microsoft.com/v1.0/me/messages?$skip=23"
```

><span data-ttu-id="fb542-145">**Примечание.** Приложение **всегда** должно обрабатывать возможность разбивки ответов на страницы и использовать свойство `@odata.nextLink`, чтобы получить следующий набор результатов, пока не будут считаны все страницы.</span><span class="sxs-lookup"><span data-stu-id="fb542-145">**Note:** Your application should **always** handle the possibility that the responses are paged in nature, and use the `@odata.nextLink` property to obtain the next paged set of results, until all pages of the result set have been read.</span></span> <span data-ttu-id="fb542-146">Последняя страница не будет содержать свойство `@odata.nextLink`.</span><span class="sxs-lookup"><span data-stu-id="fb542-146">The final page will not contain an `@odata.nextLink` property.</span></span> <span data-ttu-id="fb542-147">В запросе следующей страницы результатов в свойство `@odata:nextLink` следует включить полный URL-адрес, рассматривая его как непрозрачную строку.</span><span class="sxs-lookup"><span data-stu-id="fb542-147">You should include the entire URL in the `@odata:nextLink` property in your request for the next page of results, treating the entire URL as an opaque string.</span></span>

<span data-ttu-id="fb542-148">Дополнительные сведения см. в [этой статье](paging.md).</span><span class="sxs-lookup"><span data-stu-id="fb542-148">For more details, see [paging](paging.md).</span></span>

### <a name="handling-expected-errors"></a><span data-ttu-id="fb542-149">Обработка ожидаемых ошибок</span><span class="sxs-lookup"><span data-stu-id="fb542-149">Handling expected errors</span></span>

<span data-ttu-id="fb542-150">Приложение должно обрабатывать все ошибки (в диапазонах 400 и 500), но некоторым ожидаемым ошибкам и ответам следует уделять особое внимание. Они перечислены в приведенной ниже таблице.</span><span class="sxs-lookup"><span data-stu-id="fb542-150">While your application should handle all error responses (in the 400 and 500 ranges), pay special attention to certain expected errors and responses, listed in the following table.</span></span>

| <span data-ttu-id="fb542-151">Тема</span><span class="sxs-lookup"><span data-stu-id="fb542-151">Topic</span></span>   | <span data-ttu-id="fb542-152">Код ошибки HTTP</span><span class="sxs-lookup"><span data-stu-id="fb542-152">HTTP error code</span></span>    | <span data-ttu-id="fb542-153">Рекомендация</span><span class="sxs-lookup"><span data-stu-id="fb542-153">Best practice</span></span>|
|:-----------|:--------|:----------|
| <span data-ttu-id="fb542-154">У пользователя нет доступа</span><span class="sxs-lookup"><span data-stu-id="fb542-154">User does not have access</span></span> | <span data-ttu-id="fb542-155">403</span><span class="sxs-lookup"><span data-stu-id="fb542-155">403</span></span> | <span data-ttu-id="fb542-156">Эта ошибка может возникнуть в запущенном приложении, даже если ему были предоставлены необходимые разрешения через интерфейс согласия.</span><span class="sxs-lookup"><span data-stu-id="fb542-156">If your application is up and running, it could encounter this error even if it has been granted the necessary permissions through a consent experience.</span></span>  <span data-ttu-id="fb542-157">В этом случае наиболее вероятно, что у вошедшего пользователя нет прав на доступ к запрашиваемому ресурсу.</span><span class="sxs-lookup"><span data-stu-id="fb542-157">In this case, it's most likely that the signed-in user does not have privileges to access the resource requested.</span></span> <span data-ttu-id="fb542-158">Приложение должно показывать вошедшему пользователю обычное сообщение "Отказано в доступе".</span><span class="sxs-lookup"><span data-stu-id="fb542-158">Your application should provide a generic "Access denied" error back to the signed-in user.</span></span> |
|<span data-ttu-id="fb542-159">Не найдено</span><span class="sxs-lookup"><span data-stu-id="fb542-159">Not found</span></span>| <span data-ttu-id="fb542-160">404</span><span class="sxs-lookup"><span data-stu-id="fb542-160">404</span></span> | <span data-ttu-id="fb542-161">В некоторых случаях запрашиваемый ресурс может быть не найден.</span><span class="sxs-lookup"><span data-stu-id="fb542-161">In certain cases, a requested resource might not be found.</span></span> <span data-ttu-id="fb542-162">К примеру, ресурс может не существовать, так как он еще не был подготовлен (как, например, фотография пользователя) или был удален.</span><span class="sxs-lookup"><span data-stu-id="fb542-162">For example a resource might not exist, because it has not yet been provisioned (like a user's photo) or because it has been deleted.</span></span> <span data-ttu-id="fb542-163">Некоторые удаленные ресурсы *можно* полностью восстановить в течение 30 дней после удаления. К таким ресурсам относятся пользователи, группы и приложения, поэтому ваше приложение также должно это учитывать.</span><span class="sxs-lookup"><span data-stu-id="fb542-163">Some deleted resources *might* be fully restored within 30 days of deletion - such as user, group and application resources, so your application should also take this into account.</span></span>|
|<span data-ttu-id="fb542-164">Регулирование</span><span class="sxs-lookup"><span data-stu-id="fb542-164">Throttling</span></span>|<span data-ttu-id="fb542-165">429</span><span class="sxs-lookup"><span data-stu-id="fb542-165">429</span></span>|<span data-ttu-id="fb542-166">API могут регулировать количество запросов в любой момент по ряду причину, поэтому приложение **всегда** должно быть готово обрабатывать ответы 429.</span><span class="sxs-lookup"><span data-stu-id="fb542-166">APIs might throttle at any time for a variety of reasons, so your application must **always** be prepared to handle 429 responses.</span></span> <span data-ttu-id="fb542-167">Эта ошибка включает поле *Retry-After* в заголовке HTTP-ответа.</span><span class="sxs-lookup"><span data-stu-id="fb542-167">This error response includes the *Retry-After* field in the HTTP response header.</span></span> <span data-ttu-id="fb542-168">Самый быстрый способ избавиться от регулирования — отложить запросы с помощью задержки *Retry-After*.</span><span class="sxs-lookup"><span data-stu-id="fb542-168">Backing off requests using the *Retry-After* delay is the fastest way to recover from throttling.</span></span> <span data-ttu-id="fb542-169">Дополнительные сведения см. в [этой статье](throttling.md).</span><span class="sxs-lookup"><span data-stu-id="fb542-169">For more information, see [throttling](throttling.md).</span></span>|
|<span data-ttu-id="fb542-170">Служба недоступна</span><span class="sxs-lookup"><span data-stu-id="fb542-170">Service unavailable</span></span>| <span data-ttu-id="fb542-171">503</span><span class="sxs-lookup"><span data-stu-id="fb542-171">503</span></span> | <span data-ttu-id="fb542-172">Скорее всего, служба занята.</span><span class="sxs-lookup"><span data-stu-id="fb542-172">This is likely because the services is busy.</span></span> <span data-ttu-id="fb542-173">Следует применять ту же стратегию, что и при обработке ошибки 429.</span><span class="sxs-lookup"><span data-stu-id="fb542-173">You should employ a back-off strategy similar to 429.</span></span> <span data-ttu-id="fb542-174">Кроме того, повторные запросы следует **всегда** выполнять через новое подключение HTTP.</span><span class="sxs-lookup"><span data-stu-id="fb542-174">Additionally, you should **always** make new retry requests over a new HTTP connection.</span></span>|

### <a name="evolvable-enums"></a><span data-ttu-id="fb542-175">Расширяемые перечисления</span><span class="sxs-lookup"><span data-stu-id="fb542-175">Evolvable enums</span></span>

<span data-ttu-id="fb542-176">Клиентские приложения могут выходить из строя при добавлении элементов в существующее перечисление.</span><span class="sxs-lookup"><span data-stu-id="fb542-176">Client applications can be broken by the addition of members to an existing enum.</span></span> <span data-ttu-id="fb542-177">Для некоторых новых перечислений в Microsoft Graph доступен механизм, позволяющий добавлять новые элементы, не выводя приложение из строя.</span><span class="sxs-lookup"><span data-stu-id="fb542-177">For some newer enums in Microsoft Graph, a mechanism is available to allow for adding new members without incurring a breaking change.</span></span> <span data-ttu-id="fb542-178">В этих перечислениях есть общий *ограждающий* элемент под названием `unknownFutureValue`, отделяющий известные элементы перечисления от неизвестных.</span><span class="sxs-lookup"><span data-stu-id="fb542-178">On these newer enums, you'll see a common *sentinel* member called `unknownFutureValue` that demarcates known and unknown enum members.</span></span> <span data-ttu-id="fb542-179">Номера известных элементов меньше номера ограждающего элемента, а неизвестных — больше.</span><span class="sxs-lookup"><span data-stu-id="fb542-179">Known members will have a number less than the sentinel member, while unknown members will be greater in value.</span></span>
<span data-ttu-id="fb542-180">По умолчанию Microsoft Graph не возвращает неизвестные элементы.</span><span class="sxs-lookup"><span data-stu-id="fb542-180">By default, unknown members are not returned by Microsoft Graph.</span></span> <span data-ttu-id="fb542-181">Однако если приложение рассчитано на обработку неизвестных элементов, оно может согласиться на их получение с помощью заголовка *Prefer* в HTTP-запросе.</span><span class="sxs-lookup"><span data-stu-id="fb542-181">If, however, your application is written to handle the appearance of unknown members, it can opt-in to receive unknown enum members, using an HTTP *Prefer* request header.</span></span>

><span data-ttu-id="fb542-182">**Примечание.** Если приложение подготовлено к обработке неизвестных элементов перечисления, оно должно согласиться на их получение с помощью заголовка *prefer* в HTTP-запросе: `Prefer: include-unknown-enum-members`.</span><span class="sxs-lookup"><span data-stu-id="fb542-182">**Note:** If your application is prepared to handle unknown enum members, it should opt-in by using an HTTP *prefer* request header: `Prefer: include-unknown-enum-members`.</span></span>

## <a name="storing-data-locally"></a><span data-ttu-id="fb542-183">Локальное хранение данных</span><span class="sxs-lookup"><span data-stu-id="fb542-183">Storing data locally</span></span>

<span data-ttu-id="fb542-184">В идеальном случае приложение должно вызывать Microsoft Graph для получения данных в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="fb542-184">Your application should ideally make calls to Microsoft Graph to retrieve data in real time as necessary.</span></span> <span data-ttu-id="fb542-185">Кэшировать данные или хранить их локально следует, только если это требуется для определенного сценария и если этот вариант использования предусмотрен условиями использованиями и политикой конфиденциальности, а также не противоречит [условиям использования Microsoft Graph](https://developer.microsoft.com/en-us/graph/docs/misc/terms-of-use).</span><span class="sxs-lookup"><span data-stu-id="fb542-185">You should only cache or store data locally if required for a specific scenario, and if that use case is covered by your terms of use and privacy policy, and does not violate the [Microsoft Graph terms of use](https://developer.microsoft.com/en-us/graph/docs/misc/terms-of-use).</span></span> <span data-ttu-id="fb542-186">В приложении также необходимо реализовать надлежащие политики хранения и удаления.</span><span class="sxs-lookup"><span data-stu-id="fb542-186">Your application should also implement proper retention and deletion policies.</span></span>

## <a name="optimizations"></a><span data-ttu-id="fb542-187">Оптимизация</span><span class="sxs-lookup"><span data-stu-id="fb542-187">Optimizations</span></span>

<span data-ttu-id="fb542-188">Как правило, из соображений производительности и даже безопасности или конфиденциальности, следует получать только те данные, которые действительно необходимы приложению.</span><span class="sxs-lookup"><span data-stu-id="fb542-188">In general, for performance and even security or privacy reasons, you should only get the data your application really needs, and nothing more.</span></span>

### <a name="use-projections"></a><span data-ttu-id="fb542-189">Использование проекций</span><span class="sxs-lookup"><span data-stu-id="fb542-189">Use projections</span></span>

<span data-ttu-id="fb542-190">Выбирайте только те свойства, которые действительно необходимы приложению. Это позволит сэкономить сетевой трафик и снизить нагрузку на приложение (и службу), связанную с обработкой данных.</span><span class="sxs-lookup"><span data-stu-id="fb542-190">Choose only the properties your application really needs and no more, because this saves unnecessary network traffic and data processing in your application (and in the service).</span></span>

><span data-ttu-id="fb542-191">**Примечание.** Используйте параметр запроса `$select`, чтобы по запросу возвращались только свойства, необходимые приложению.</span><span class="sxs-lookup"><span data-stu-id="fb542-191">**Note:** Use the `$select` query parameter to limit the properties returned by a query to those needed by your application.</span></span>

<span data-ttu-id="fb542-192">Например, при получении сообщений вошедшего пользователя можно указать, что необходимо вернуть только свойства **from** и **subject**:</span><span class="sxs-lookup"><span data-stu-id="fb542-192">For example, when retrieving the messages of the signed-in user, you can specify that only the **from** and **subject** properties be returned:</span></span>

```http
GET https://graph.microsoft.com/v1.0/me/messages?$select=from,subject
```

### <a name="getting-minimal-responses"></a><span data-ttu-id="fb542-193">Получение минимальных ответов</span><span class="sxs-lookup"><span data-stu-id="fb542-193">Getting minimal responses</span></span>

<span data-ttu-id="fb542-194">В случае некоторых операций, например PUT и PATCH (а в некоторых случаях — POST), если приложению не нужны полезные данные ответа, можно просить API возвращать минимальное количество данных.</span><span class="sxs-lookup"><span data-stu-id="fb542-194">For some operations, such as PUT and PATCH (and in some cases POST), if your application doesn't need to make use of a response payload, you can ask the API to return minimal data.</span></span> <span data-ttu-id="fb542-195">Обратите внимание, что некоторые службы уже возвращают ответ 204 No Content для операций PUT и PATCH.</span><span class="sxs-lookup"><span data-stu-id="fb542-195">Note that some services already return a 204 No Content response for PUT and PATCH operations.</span></span>

><span data-ttu-id="fb542-196">**Примечание.** Запрашивайте ответы с минимальным представлением, используя заголовок HTTP-запроса: *Prefer: return=minimal*.</span><span class="sxs-lookup"><span data-stu-id="fb542-196">**Note:** Request minimal representation responses using an HTTP request header where appropriate: *Prefer: return=minimal*.</span></span> <span data-ttu-id="fb542-197">Обратите внимание, что в случае операций создания это может быть неуместно, так как приложение может ожидать сгенерированный службой `id` для нового объекта в ответе.</span><span class="sxs-lookup"><span data-stu-id="fb542-197">Note that for creation operations, this might not be appropriate because your application may expect to get the service generated `id` for the newly created object in the response.</span></span>

### <a name="track-changes-delta-query-and-webhook-notifications"></a><span data-ttu-id="fb542-198">Отслеживание изменений: разностный запрос и уведомления веб-перехватчиков</span><span class="sxs-lookup"><span data-stu-id="fb542-198">Track changes: delta query and webhook notifications</span></span>

<span data-ttu-id="fb542-199">Если приложению нужно знать об изменениях данных, вы можете получать уведомление веб-перехватчика при каждом их изменении.</span><span class="sxs-lookup"><span data-stu-id="fb542-199">If your application needs to know about changes to data, you can get a webhook notification whenever data of interest has changed.</span></span> <span data-ttu-id="fb542-200">Это эффективнее, чем регулярные опросы.</span><span class="sxs-lookup"><span data-stu-id="fb542-200">This is more efficient than simply polling on a regular basis.</span></span>

<span data-ttu-id="fb542-201">Используйте [уведомления веб-перехватчиков](../api-reference/v1.0/resources/webhooks.md), чтобы получать push-уведомления при изменении данных.</span><span class="sxs-lookup"><span data-stu-id="fb542-201">Use [webhook notifications](../api-reference/v1.0/resources/webhooks.md) to get push notifications when data changes.</span></span>

<span data-ttu-id="fb542-202">Если приложение должно кэшировать или сохранять данные Microsoft Graph локально и поддерживать их в актуальном состоянии либо отслеживать изменения данных по каким-либо другим причинам, следует использовать разностный запрос.</span><span class="sxs-lookup"><span data-stu-id="fb542-202">If your application is required to cache or store Microsoft Graph data locally, and keep that data up to date, or track changes to data for any other reasons, you should use delta query.</span></span> <span data-ttu-id="fb542-203">Это избавит приложение от необходимости лишних вычислений для получения данных, уже доступных приложению, уменьшит количество сетевого трафика и снизит вероятность достижения порога регулирования.</span><span class="sxs-lookup"><span data-stu-id="fb542-203">This will avoid excessive computation by your application to retrieve data your application already has, minimize network traffic, and reduce the likelihood of reaching a throttling threshold.</span></span>

<span data-ttu-id="fb542-204">Используйте [разностный запрос](delta_query_overview.md), чтобы эффективно поддерживать данные в актуальном состоянии.</span><span class="sxs-lookup"><span data-stu-id="fb542-204">Use [delta query](delta_query_overview.md) to efficiently keep data up to date.</span></span>

### <a name="using-webhooks-and-delta-query-together"></a><span data-ttu-id="fb542-205">Использование веб-перехватчиков вместе с разностным запросом</span><span class="sxs-lookup"><span data-stu-id="fb542-205">Using webhooks and delta query together</span></span>

<span data-ttu-id="fb542-206">Как правило, веб-перехватчики и разностный запрос эффективнее работают вместе, так как при использовании разностного запроса необходимо подобрать подходящий интервал опроса. Если он слишком короткий, будет возвращаться много пустых ответов, что приведет к трате ресурсов. Если же он слишком длинный, ваши данные могут устареть.</span><span class="sxs-lookup"><span data-stu-id="fb542-206">Webhooks and delta query are often used better together, because if you use delta query alone, you need to figure out the right polling interval - too short and this might lead to empty responses which wastes resources, too long and you might end up with stale data.</span></span> <span data-ttu-id="fb542-207">Используя уведомления веб-перехватчиков в качестве триггера для отправки разностных запросов, вы получаете преимущества обеих функций.</span><span class="sxs-lookup"><span data-stu-id="fb542-207">If you use webhook notifications as the trigger to make delta query calls, you get the best of both worlds.</span></span>

<span data-ttu-id="fb542-208">Используйте [уведомления веб-перехватчиков](../api-reference/v1.0/resources/webhooks.md) в качестве триггера для отправки разностных запросов.</span><span class="sxs-lookup"><span data-stu-id="fb542-208">Use [webhook notifications](../api-reference/v1.0/resources/webhooks.md) as the trigger to make delta query calls.</span></span> <span data-ttu-id="fb542-209">Кроме того, следует убедиться, что в приложении задан предельный порог опроса на тот случай, если уведомлений не будет.</span><span class="sxs-lookup"><span data-stu-id="fb542-209">You should also ensure that your application has a backstop polling threshold, in case no notifications are triggered.</span></span>

### <a name="batching"></a><span data-ttu-id="fb542-210">Пакетная обработка</span><span class="sxs-lookup"><span data-stu-id="fb542-210">Batching</span></span>

<span data-ttu-id="fb542-211">Пакетная обработка JSON позволяет оптимизировать приложение, объединив несколько запросов в один объект JSON.</span><span class="sxs-lookup"><span data-stu-id="fb542-211">JSON batching allows you to optimize your application by combining multiple requests into a single JSON object.</span></span> <span data-ttu-id="fb542-212">Объединение отдельных запросов в один позволяет значительно снизить задержку в сети и сэкономить ресурсы подключения.</span><span class="sxs-lookup"><span data-stu-id="fb542-212">Combining individual requests into a single batch request can save the application significant network latency and can conserve connection resources.</span></span>

<span data-ttu-id="fb542-213">Используйте [пакетную обработку](json_batching.md) в тех случаях, когда задержка сети может существенно повлиять на производительность.</span><span class="sxs-lookup"><span data-stu-id="fb542-213">Use [batching](json_batching.md) where significant network latency can have a big impact on the performance.</span></span>

## <a name="reliability-and-support"></a><span data-ttu-id="fb542-214">Надежность и поддержка</span><span class="sxs-lookup"><span data-stu-id="fb542-214">Reliability and support</span></span>
<span data-ttu-id="fb542-215">Чтобы обеспечить надежность и поддержку приложения следуйте приведенным ниже рекомендациям.</span><span class="sxs-lookup"><span data-stu-id="fb542-215">To ensure reliability and facilitate support for your application:</span></span>

- <span data-ttu-id="fb542-216">Учитывайте срок жизни DNS и задайте соответствующий срок жизни для подключения.</span><span class="sxs-lookup"><span data-stu-id="fb542-216">Honor DNS TTL and set connection TTL to match it.</span></span> <span data-ttu-id="fb542-217">Это гарантирует доступность в случае отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="fb542-217">This ensures availability in case of failovers.</span></span>
- <span data-ttu-id="fb542-218">Откройте подключения ко всем объявленным ответам DNS.</span><span class="sxs-lookup"><span data-stu-id="fb542-218">Open connections to all advertised DNS answers.</span></span>
- <span data-ttu-id="fb542-219">Всегда записывайте значения *request-id* и *timestamp* из заголовка HTTP-ответа.</span><span class="sxs-lookup"><span data-stu-id="fb542-219">Always log the *request-id* and *timestamp* from the HTTP response header.</span></span> <span data-ttu-id="fb542-220">Без них вы не сможете сообщить о проблеме на сайте Stack Overflow или отправить запрос в службу поддержки клиентов Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="fb542-220">This is required when escalating issues or reporting issues in Stack Overflow or to Microsoft Customer Support.</span></span>
