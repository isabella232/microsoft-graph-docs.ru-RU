---
title: Политики и лицензирование подключения к данным Microsoft Graph
description: Описаны поддерживаемые политики и способ назначения номеров SKU для доступа независимых поставщиков программного обеспечения в организации.
author: tlenig
localization_priority: Priority
ms.prod: data-connect
ms.openlocfilehash: 77a3a99f3062b2d5c7f914799e41090297d54df0
ms.sourcegitcommit: 3fbc2249b307e8d3a9de18f22ef6911094ca272c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/26/2020
ms.locfileid: "48289290"
---
# <a name="microsoft-graph-data-connect-policies-and-licensing"></a>Политики и лицензирование подключения к данным Microsoft Graph

Подключение к данным Microsoft Graph осуществляется с помощью [управляемых приложений Azure](/azure/managed-applications/overview). С их помощью вы можете создать и развернуть решения в клиентской среде Azure. С помощью управляемых приложений вы можете поддерживать определенные политики Azure, обеспечивая клиентам более высокий доверительный уровень и комфортность при использовании приложений. Кроме того, необходимо приобрести у Майкрософт лицензии и применить их в своей организации или в организациях, установивших ваши приложения, чтобы обеспечить приложениям доступ к подключению к данным.

## <a name="policies"></a>Политики

Управляемые приложения Azure, созданные на основе данных Microsoft 365, поддерживают следующие политики Azure:

- [Политика обязательного шифрования ADLS Gen1](/azure/azure-policy/scripts/enforce-datalakestore-encryption)

После проверки состояния соответствия политике, выбранной во время публикации в Azure Marketplace, она применяется ко всем установленным экземплярам приложения. Все соответствующие выбранные политики отображаются для лиц, утверждающих данные, в рамках запроса данных. В случае нарушения соответствия политике происходит сбой в работе канала и прекращается извлечение данных.

Чтобы запросить поддержку дополнительных политик, свяжитесь с нами в [UserVoice](https://microsoftgraph.uservoice.com/forums/920506-microsoft-graph-feature-requests?category_id=359581).

## <a name="licensing"></a>Лицензирование

Доступ к набору инструментов для подключения к данным Microsoft Graph можно получить через Рабочую аналитику, получив лицензию пользователя на месяц.  Рабочая аналитика позволяет организациям дополнить аналитические сведения, полученные на основе данных Microsoft 365, путем предоставления приложениям (собственным и разработанным независимыми поставщиками программного обеспечения) управляемого доступа к масштабируемым данным. Подробнее, в том числе о приобретении, см. на [странице продукта "Рабочая аналитика"](https://products.office.com/business/workplace-analytics).

Независимые поставщики программного обеспечения могут создавать приложения для пользователей, которые не приобрели Рабочую аналитику. Для этого необходимо приобрести достаточное количество лицензий и связать их с пользователями, которые после приобретения приложения получат доступ через подключение к данным Microsoft Graph. Этот способ можно использовать одновременно с лицензиями на Рабочую аналитику. Необходимо выполнить действия, чтобы связать экземпляры лицензии на подключение к данным Microsoft Graph с каждой установкой пользователя.

### <a name="isvs-using-the-microsoft-graph-data-connect-license"></a>Независимые поставщики программного обеспечения, использующие лицензии на подключение к данным Microsoft Graph
Независимые поставщики программного обеспечения, использующие лицензии на подключение к данным, должны использовать [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) для хранения лицензий и обработки их назначения. Для этого необходимо [создать Key Vault](/azure/key-vault/quick-create-portal). Во время создания обратите внимание на значение универсального кода ресурса (URI) хранилища Key Vault. Его необходимо использовать в определении приложения как ссылку на хранилище Key Vault. После создания хранилища Key Vault убедитесь, что у имени субъекта-службы, которое использует связанная с источником служба шаблона ARM приложения, есть доступ к нему. Для этого перейдите в область **Политики доступа** экземпляра Key Vault, создайте политику доступа для приложения, на которое ссылается имя субъекта-службы, и назначьте приложению разрешения **Получить** и **Список**. 

![Создание политики доступа для Key Vault](images/data-connect-keyvault-access.png)

Назначение лицензий на подключение к данным Microsoft Graph для организаций осуществляется в виде секрета в хранилище Key Vault. Для этого:
1. Перейдите в хранилище Key Vault и в разделе **Создание/импорт** создайте секрет вручную. Имя секрета должно быть **MGdcSKUMapping**, а в его значение необходимо включить ИД клиента и количество выделенных ему лицензий в следующем формате.

`{"tenantId1" : 20, "tenantId2" : 35, "tenantId3" : 12}`

2. Задав значение, убедитесь, что оно включено, и нажмите **Создать**, чтобы начать развертывание. 

![Создание секрета в хранилище Key Vault](images/data-connect-keyvault-create.png)

3. Необходимо также обновить шаблон ARM приложения, который ссылается на созданное хранилище Key Vault. Для этого в свойстве **LicenseKeyVaultUri** необходимо указать значение **KeyVaultUri**, полученное во время создания. Это свойство находится в связанной с источником службе шаблона ARM приложения, как показано ниже. 

```
"properties": {
        "type": "Office365",
            "description": "Source O365 linked service",
            "typeProperties": {
                   "office365tenantId": "[subscription().tenantId]",
        "PrivacyPolicyUri": "http://www.wkw.com/privacy",
        "TermsOfUseUri": "http://www.wkw.com/tos",
        "servicePrincipalId": "[variables('sourceLinkedServicePrincipalId')]",
        "servicePrincipalKey": {
                           "type": "SecureString",
                "value": "[variables('sourceLinkedServicePrincipalKey')]"
        },
        "servicePrincipalTenantId": "[variables('sourceLinkedServicePrincipalTenantId')]",
        "LicenseKeyVaultUri": "<KeyVaultUri>",
            }
    }
```

Перед началом работы канала подключение к данным ссылается на секрет в хранилище Key Vault. В работе канала произойдет сбой, если в организации недостаточно лицензий для предоставления доступа каждому пользователю или при отсутствии доступа к хранилищу Key Vault. 

## <a name="next-steps"></a>Дальнейшие действия
Чтобы запросить поддержку дополнительных политик, свяжитесь с нами в [UserVoice](https://microsoftgraph.uservoice.com/forums/920506-microsoft-graph-feature-requests?category_id=359581). Дополнительные сведения о Рабочей аналитике, в том числе о приобретении доступа к ней, см. на [странице продукта "Рабочая аналитика"](https://products.office.com/business/workplace-analytics).