# <a name="known-issues-with-microsoft-graph"></a>Известные проблемы с Microsoft Graph

В этой статье описываются известные проблемы, связанные с Microsoft Graph. Сведения о последних обновлениях см. в [журнале изменений Microsoft Graph](changelog.md).

## <a name="users"></a>Пользователи

### <a name="no-instant-access-after-creation"></a>Нет мгновенного доступа после создания

Пользователей можно создавать мгновенно с помощью метода POST для объекта user. Для доступа к службам Office 365 пользователю нужна соответствующая лицензия. Из-за распределенного характера службы файлы, сообщения и события этого пользователя станут доступны посредством API Microsoft Graph через 15 минут после назначения лицензии. В течение этого времени приложения будут получать ошибку HTTP 404.

### <a name="photo-restrictions"></a>Ограничения для фотографий

Просмотреть и обновить фотографию профиля пользователя можно, только если у пользователя есть почтовый ящик. Кроме того, все фотографии, которые *могли* быть сохранены ранее с помощью свойства **thumbnailPhoto** (с помощью предварительной версии единого API Office 365, Azure AD Graph или службы синхронизации AD Connect), больше не доступны через свойство **photo** Microsoft Graph ресурса [user](../api-reference/v1.0/resources/user.md). В этом случае, если фотографию не удастся просмотреть или обновить, возникнет следующая ошибка:

```javascript
    {
      "error": {
        "code": "ErrorNonExistentMailbox",
        "message": "The SMTP address has no mailbox associated with it."
      }
    }
```


### <a name="using-delta-query"></a>Запрос изменений

Об известных проблемах, связанных с использованием запросов изменений, можно узнать в [соответствующем разделе](#delta-query) этой статьи.

## <a name="groups-and-microsoft-teams"></a>Группы и Microsoft Teams

>**Примечание.** В настоящее время служба Microsoft Teams доступна только в конечной точке бета-версии Microsoft Graph.

### <a name="policy"></a>Политика

С помощью Microsoft Graph можно создать группу Office 365 и присвоить ей название в обход всех групповых политик Office 365, настроенных через Outlook Web App.

### <a name="permissions-for-groups-and-microsoft-teams"></a>Разрешения для групп и Microsoft Teams

В Microsoft Graph доступны два разрешения (*Group.Read.All* и *Group.ReadWrite.All*) для доступа к API для групп и Microsoft Teams. На предоставление этих разрешений должен согласиться администратор (в предварительной версии было иначе). В будущем мы планируем добавить новые разрешения для групп и команд, на предоставление которых смогут соглашаться пользователи.

Кроме того, только API для базового администрирования групп и управления ими поддерживает доступ с помощью разрешений только для приложений или делегированных разрешений. Все остальные функции API групп поддерживают только делегированные разрешения.

Примеры функций групп, поддерживающих разрешения только для приложений и делегированные разрешения:

* создание и удаление групп;
* получение и обновление свойств групп, связанных с администрированием групп и управлением ими;
* синхронизация, типы и [параметры каталогов](../api-reference/v1.0/resources/directoryobject.md) групп;
* владельцы и члены групп.

Примеры функций групп, поддерживающих только делегированные разрешения:

* групповые беседы, события, фотографии;
* внешние отправители, разрешенные или запрещенные отправители, подписка на группы;
* избранное пользователей и счетчик непросмотренных элементов;
* Чаты и каналы Microsoft Teams

### <a name="teams-in-microsoft-teams-preview"></a>Рабочие группы в Microsoft Teams (предварительная версия)

Группы Office 365 и Microsoft Teams [имеют схожие функции](../api-reference/beta/resources/teams_api_overview.md). Все API групп можно использовать с рабочими группами за исключением того, что в настоящее время нельзя создать рабочую группу с помощью API создания групп.  Эта возможность появится в будущих выпусках API.

### <a name="microsoft-teams-chat-threads-and-chat-messages-preview"></a>Цепочки и сообщения чата Microsoft Teams (предварительная версия)

В настоящее время в каналах можно создавать цепочки чата, но нельзя читать существующие цепочки и добавлять в них ответы. Кроме того, нельзя читать или записывать прямые чаты между пользователями, которые выходят за рамки команды или канала.  В будущих выпусках API появятся дополнительные возможности в этой области.

### <a name="microsoft-teams-users-list-of-joined-teams-preview"></a>Список рабочих групп, в которых состоит пользователь Microsoft Teams (предварительная версия)

На данный момент [перечисление рабочих групп, к которым присоединился пользователь,](../api-reference/beta/api/user_list_joinedteams.md) возможно только в случае вошедшего пользователя, для которого у вызывающего есть [делегированные разрешения](permissions_reference.md).  Будущие выпуски будут поддерживать эту операцию для любого указанного ИД пользователя.

### <a name="adding-and-getting-attachments-of-group-posts"></a>Добавление и получение вложений в записях групп

В настоящее время при [добавлении](http://developer.microsoft.com/ru-RU/graph/docs/api-reference/v1.0/api/post_post_attachments) вложений в записи группы, [отображении](http://developer.microsoft.com/ru-RU/graph/docs/api-reference/v1.0/api/post_list_attachments) и получении вложений возвращается сообщение об ошибке "Запрос OData не поддерживается". Для версий `/v1.0` и `/beta` подготовлено исправление. Оно станет доступно всем пользователям в конце января 2016 года.

### <a name="setting-the-allowexternalsenders-property"></a>Установка свойства allowExternalSenders

В настоящее время существует проблема, из-за которой невозможно установить свойство **allowExternalSenders** группы в операции POST или PATCH как в `/v1.0`, так и в `/beta`.

### <a name="using-delta-query"></a>Работа с запросами изменений

Об известных проблемах, связанных с запросом изменений, можно узнать в [соответствующем разделе](#delta-query) этой статьи.


## <a name="bookings"></a>Bookings

### <a name="errorexceededfindcountlimit-when-querying-bookingbusinesses"></a>Ошибка ErrorExceededFindCountLimit при запросе bookingBusinesses

При получении списка по запросу `bookingBusinesses` возвращается ошибка с указанным ниже кодом, если у организации есть несколько компаний в Bookings, а учетная запись, с использованием которой отправлен запрос, не принадлежит администратору.

```json
{
  "error": {
    "code": "ErrorExceededFindCountLimit",
    "message":
      "The GetBookingMailboxes request returned too many results. Please specify a query to limit the results.",
  }
}
```

В качестве обходного решения можно ограничить группу компаний, возвращаемых по запросу, указав параметр `query`. Пример:

```
GET https://graph.microsoft.com/beta/bookingBusinesses?query=Fabrikam
```


## <a name="calendars"></a>Календари

### <a name="adding-and-accessing-ics-based-calendars-in-users-mailbox"></a>Добавление календарей ICS в почтовый ящик пользователя и доступ к ним

В настоящее время календари ICS поддерживаются частично:

* Вы можете добавить календарь ICS в почтовый ящик пользователя через интерфейс пользователя, но не через API Microsoft Graph.
* [Перечисление календарей пользователя](http://developer.microsoft.com/ru-RU/graph/docs/api-reference/v1.0/api/user_list_calendars) позволяет получить свойства **name**, **color** и **id** всех [календарей](http://developer.microsoft.com/ru-RU/graph/docs/api-reference/v1.0/resources/calendar) в группе календарей пользователя по умолчанию или указанной группе календарей, в том числе календарей ICS. URL-адрес ICS невозможно хранить и открывать в ресурсе calendar.
* Вы также можете [отобразить события](http://developer.microsoft.com/ru-RU/graph/docs/api-reference/v1.0/api/calendar_list_events) календаря ICS.

### <a name="accessing-a-shared-calendar"></a>Доступ к общему календарю

При использовании следующей операции для доступа к событиям в календаре другого пользователя:

```http
GET \users('{id}')\calendars('{id}')\events
```

Может возникнуть ошибка HTTP 500 `ErrorInternalServerTransientError`. Ошибка возникает, потому что:

- Существуют два способа реализации общего доступа к календарю, которые для ясности мы будем называть "старый" способ и "новый" способ.
- Новый способ в настоящее время доступен для предоставления доступа к календарям с разрешениями на просмотр или редактирование, но не с делегированными разрешениями.
- С помощью REST API календаря можно просматривать и редактировать общие календари, только если доступ к ним предоставлен **новым** способом.
- С помощью REST API календаря нельзя просматривать или редактировать общие календари (или их события), если доступ к ним предоставлен **старым** способом.


Если доступ к календарю был предоставлен с разрешениями на просмотр или редактирование, но старым способом, вы можете вручную обновить календарь, чтобы использовать новый способ.
Чтобы можно было использовать новый способ, со временем Outlook автоматически обновит все общие календари, в том числе те, доступ к которым предоставлен с делегированными разрешениями.

Чтобы с этой целью вручную обновить общий календарь, выполните следующие действия:
1.  Получатель удаляет календарь, доступ к которому был ранее ему предоставлен.
2.  Владелец повторно предоставляет доступ к календарю в Outlook в Интернете, Outlook на iOS или Outlook на Android.
3.  Получатель повторно принимает календарь, используя Outlook в Интернете. (Скоро можно будет использовать другие клиенты Outlook.)
4.  Доступ к календарю успешно предоставлен новым способом, если получатель может просмотреть его в Outlook на iOS или Outlook на Android.

Календарь, доступ к которому предоставлен новым способом, выглядит как один из стандартных календарей в вашем почтовом ящике. С помощью REST API календаря можно просматривать и редактировать события в общем календаре, как в своем собственном. Например:

```http
GET \me\calendars('{id}')\events
```


## <a name="contacts"></a>Контакты

### <a name="organization-contacts-available-in-only-beta"></a>Контакты организации доступны только в бета-версии

В настоящее время поддерживаются только личные контакты. В настоящее время контакты организации не поддерживаются в версии `/v1.0`, но их можно найти в версии `/beta`.

### <a name="default-contacts-folder"></a>Папка контактов по умолчанию

В версии `/v1.0` запрос `GET /me/contactFolders` не включает папку контактов пользователя по умолчанию.

Эта ошибка будет исправлена. Чтобы получить идентификатор папки контактов по умолчанию, вы можете использовать следующий запрос на [отображение контактов](http://developer.microsoft.com/ru-RU/graph/docs/api-reference/v1.0/api/user_list_contacts) и свойство **parentFolderId**:

```http
GET https://graph.microsoft.com/v1.0/me/contacts?$top=1&$select=parentFolderId
```

В указанном выше запросе:

1. `/me/contacts?$top=1` возвращает свойства [контакта](http://developer.microsoft.com/ru-RU/graph/docs/api-reference/v1.0/resources/contact) в папке контактов по умолчанию.
2. При добавлении `&$select=parentFolderId` возвращается только свойство контакта **parentFolderId** — идентификатор папки контактов по умолчанию.


### <a name="accessing-contacts-via-a-contact-folder-in-beta"></a>Доступ к контактам через папку контактов в бета-версии

В настоящее время в версии `/beta` существует проблема, из-за которой нельзя получить доступ к ресурсу [contact](../api-reference/beta/resources/contact.md), указав его родительскую папку в URL-адресе запроса REST, как показано в 2 приведенных ниже сценариях.

* Доступ к контакту из папки верхнего уровня [contactFolder](../api-reference/beta/resources/contactfolder.md).

```http
GET /me/contactfolders/{id}/contacts/{id}
GET /users/{id | userPrincipalName}/contactfolders/{id}/contacts/{id}
```

* Доступ к контакту в дочерней папке папки **contactFolder**.  В приведенном ниже примере показан один уровень вложения, но для хранения контакта допускается несколько.

```http
GET /me/contactFolder/{id}/childFolders/{id}/.../contacts/{id}
GET /users/{id | userPrincipalName}/contactFolders/{id}/childFolders/{id}/contacts/{id}
```

Кроме того, вы можете просто [получить](../api-reference/beta/api/contact_get.md) контакт по его идентификатору, как показано ниже, так как конечная точка /contacts для запроса GET в версии `/beta` применяется ко всем контактам в почтовом ящике пользователя:

```http
GET /me/contacts/{id}
GET /users/{id | userPrincipalName}/contacts/{id}
```

## <a name="messages"></a>Сообщения

### <a name="the-comment-parameter-for-creating-a-draft"></a>Параметр comment для создания черновика

Параметр **comment** для создания ответа или черновика ([createReply](../api-reference/v1.0/api/message_createreply.md), [createReplyAll](../api-reference/v1.0/api/message_createreplyall.md), [createForward](../api-reference/v1.0/api/message_createforward.md)) не включается в текст полученного черновика сообщения.


## <a name="drives-files-and-content-streaming"></a>Диски, файлы и потоковая передача контента

* При первом доступе к личному диску пользователя с помощью Microsoft Graph до открытия им своего личного сайта в браузере возвращается ответ 401.

## <a name="query-parameter-limitations"></a>Ограничения параметров запроса

* Не поддерживается несколько пространств имен.
* Не поддерживаются запросы GET для `$ref` и приведение для пользователей, групп, устройств, субъектов-служб и приложений.
* Не поддерживается `@odata.bind`. Это значит, что разработчики не смогут правильно задавать параметры `Accepted` и `RejectedSenders` для группы.
* Отсутствует `@odata.id` для навигации по объектам без вложений (например, сообщениям) при использовании минимальных метаданных.
* `$expand`:
  * Отсутствует поддержка `nextLink`.
  * Поддерживается не более одного уровня развертывания.
  * Не поддерживаются дополнительные параметры (`$filter`, `$select`).
* `$filter`:
  * Конечная точка `/attachments` не поддерживает фильтры. При ее наличии параметр `$filter` игнорируется.
  * Фильтрация нескольких рабочих нагрузок не поддерживается.
* `$search`:
  * Полнотекстовый поиск доступен только для некоторых объектов, например сообщений.
  * Поиск по нескольким рабочим нагрузкам не поддерживается.

## <a name="delta-query"></a>Разностный запрос

* При отслеживании изменений в отношениях иногда неправильно возвращается контекст OData.
* Расширения схемы (устаревшие) не возвращаются с оператором $select и возвращаются без него.
* Клиенты не могут отслеживать изменения в открытых расширениях и зарегистрированных расширениях схемы.

## <a name="application-and-serviceprincipal-api-changes"></a>Изменения в API application и servicePrincipal

Скоро в объекты [application](../api-reference/beta/resources/application.md) и [servicePrincipal](../api-reference/beta/resources/serviceprincipal.md) будут внесены изменения. Ниже приведено краткое описание текущих ограничений и возможностей API, находящихся в разработке.

Текущие ограничения:

* Некоторые свойства application (такие как appRoles и addIns) будут доступны только после внесения всех изменений.
* Регистрировать можно только мультитенантные приложения.
* Обновлять можно только приложения, зарегистрированные после первоначального обновления бета-версии.
* Пользователи Azure Active Directory могут регистрировать приложения и добавлять владельцев.
* Поддержка протоколов OpenID Connect и OAuth.
* Невозможно назначение политик приложению.
* Не выполняются операции с ownedObjects, для которых требуется код appId (например, users/{id|userPrincipalName}/ownedObjects/{id}/...).

В разработке:

* Возможность регистрировать однотенантные приложения.
* Обновления объекта servicePrincipal.
* Перевод существующих приложений Azure AD на обновленную модель.
* Поддержка appRoles, предварительно авторизованные клиенты, необязательные утверждения, утверждения членства в группе и брендинг.
* Пользователи учетной записи Майкрософт (MSA) могут регистрировать приложения.
* Поддержка протоколов SAML и WsFed.

## <a name="extensions"></a>Расширения

### <a name="change-tracking-is-not-supported"></a>Отслеживание изменений не поддерживается

Отслеживание изменений не поддерживается для свойств открытых расширений и расширений схемы.

### <a name="creating-a-resource-and-open-extension-at-the-same-time"></a>Одновременное создание ресурса и открытого расширения

Невозможно указать открытое расширение при создании экземпляра **administrativeUnit**, **device**, **group**, **organization** или **user**. Сначала необходимо создать экземпляр, а затем указать данные открытого расширения в последующем запросе ``POST`` к этому экземпляру.

### <a name="creating-a-resource-instance-and-adding-schema-extension-data-at-the-same-time"></a>Создание экземпляра ресурса с одновременным добавлением данных расширения схемы

Вы не можете указать расширение схемы в той же операции, которая создает экземпляр **contact**, **event**, **message** или **post**.
Сперва нужно создать экземпляр ресурса, а затем выполнить операцию `PATCH` для этого экземпляра, чтобы добавить расширение схемы и пользовательские данные.

### <a name="limit-of-100-schema-extension-property-values-allowed-per-resource-instance"></a>Для каждого экземпляра ресурса разрешено не более 100 значений свойства расширения схемы

В настоящее время для каждого экземпляра таких ресурсов каталога, как **device**, **group** и **user**, можно установить не более 100 значений свойства расширения схемы.

### <a name="filtering-on-schema-extension-properties-not-supported-on-all-entity-types"></a>Фильтрация по свойствам расширения схемы поддерживается не для всех типов объектов

Фильтрация по свойствам расширения схемы (с помощью выражения `$filter`) не поддерживается для типов сущностей Outlook **contact**, **event**, **message** или **post**.

## <a name="json-batching"></a>Пакетная обработка JSON

### <a name="no-nested-batch"></a>Не поддерживаются вложенные пакеты

Пакетные запросы JSON не должны содержать вложенных пакетных запросов.

### <a name="all-individual-requests-must-be-synchronous"></a>Все отдельные запросы должны быть синхронными

Все запросы, содержащиеся в пакетном запросе, должны выполняться синхронно. Параметр `respond-async`, если он имеется, будет игнорироваться.

### <a name="no-transactions"></a>Не поддерживается диалоговая обработка

В настоящее время Microsoft Graph не поддерживает диалоговую обработку отдельных запросов. Свойство `atomicityGroup` отдельных запросов будет игнорироваться.

### <a name="uris-must-be-relative"></a>URI должны быть относительными

Всегда указывайте относительные URI в пакетных запросах. Microsoft Graph сделает эти URL-адреса абсолютными с помощью конечной точки версии, включенной в URL-адрес пакета.

### <a name="limit-on-batch-size"></a>Ограничение на размер пакета

В настоящее время в пакетный запрос JSON можно включить не более 20 отдельных запросов.

### <a name="simplified-dependencies"></a>Упрощенные зависимости

Отдельные запросы могут зависеть от других отдельных запросов. В настоящее время запросы могут зависеть только от одного другого запроса и должны соответствовать одному из этих шаблонов:

1. Параллельный — для отдельных запросов не указаны зависимости в свойстве `dependsOn`.
2. Последовательный — все отдельные запросы зависят от предыдущего отдельного запроса.
3. Идентичный — для всех отдельных запросов в свойстве `dependsOn` указана одна и та же зависимость.

После усовершенствования пакетной обработки JSON эти ограничения будут удалены.

## <a name="cloud-solution-provider-apps"></a>Приложения Cloud Solution Provider

### <a name="csp-apps-must-use-azure-ad-endpoint"></a>Приложения CSP должны использовать конечную точку Azure AD

Приложения CSP должны получать маркеры из конечных точек Azure AD (версии 1) для успешного вызова Microsoft Graph в своих клиентах, управляемых партнерами. В настоящее время получение маркера через конечную точку Azure AD версии 2.0 не поддерживается.

### <a name="pre-consent-for-csp-apps-doesnt-work-in-some-customer-tenants"></a>В некоторых клиентах предоставленные приложениям CSP разрешения не работают

Предоставленные приложениям CSP разрешения могут не работать в некоторых клиентах.

- После первого входа в приложение, использующее делегированные разрешения, в новом клиенте может возникнуть эта ошибка: `AADSTS50000: There was an error issuing a token`.
- Приложение, использующее разрешения для приложений, может получить маркер, но ему может быть неожиданно отказано в доступе при вызове Microsoft Graph.

Мы делаем все возможное, чтобы как можно быстрее исправить эту ошибку.

Для целей разработки и тестирования можно использовать следующее временное решение.

>**ПРИМЕЧАНИЕ.** Это не окончательное решение и предназначено только для целей разработки.  Оно станет ненужным после исправления упомянутой выше ошибки.  Удалять указанный ниже субъект-службу не нужно.

1. Откройте сеанс Azure AD PowerShell 2 и подключитесь к клиенту `customer`, введя учетные данные администратора в окне входа. Скачать и установить Azure AD PowerShell 2 можно [здесь](https://www.powershellgallery.com/packages/AzureAD).

    ```PowerShell
    Connect-AzureAd -TenantId {customerTenantIdOrDomainName}
    ```

2. Создайте субъект-службу Microsoft Graph.

    ```PowerShell
    New-AzureADServicePrincipal -AppId 00000003-0000-0000-c000-000000000000
    ```

## <a name="functionality-available-only-in-office-365-rest-or-azure-ad-graph-apis"></a>Функции, доступные только в REST API Office 365 или API Graph Azure AD

Некоторые функции еще не доступны в Microsoft Graph. Если вы не нашли нужную функцию, можете использовать специальные [REST API Office 365](https://msdn.microsoft.com/ru-RU/office/office365/api/api-catalog). Сведения о функциях, доступных только через API Azure AD Graph, читайте в записи [Microsoft Graph или Azure AD Graph](https://dev.office.com/blogs/microsoft-graph-or-azure-ad-graph) в блоге.

## <a name="feedback"></a>Отзывы

> Ваш отзыв важен для нас. Для связи с нами используйте сайт [Stack Overflow](http://stackoverflow.com/questions/tagged/microsoftgraph).
