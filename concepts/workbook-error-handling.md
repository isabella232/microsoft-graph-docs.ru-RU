---
title: Обработка ошибок для API Excel в Microsoft Graph
description: Инструкции по обработке ошибок для API Excel в Microsoft Graph
author: grangeryy
localization_priority: Normal
ms.prod: excel
ms.openlocfilehash: e9968877e9b3153ad455ed7f0c693b4a70c2c2b1
ms.sourcegitcommit: acdf972e2f25fef2c6855f6f28a63c0762228ffa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/18/2020
ms.locfileid: "48018090"
---
# <a name="error-handling-for-excel-apis-in-microsoft-graph"></a>Обработка ошибок для API Excel в Microsoft Graph

В этой статье приводятся общие инструкции по обработке ошибок, возвращаемых API Excel в Microsoft Graph при сбое запроса, отправленного через API.

## <a name="types-of-error-responses"></a>Типы ответных сообщений об ошибках

API Excel в Microsoft Graph возвращают ошибки двух типов. Один из них — обычный ответ об ошибке, который выглядит следующим образом.

```http
HTTP/1.1 <HTTP status code>
Content-type: application/json

{
  "error": <Error object>
}
```

Второй — из шаблона долгосрочной операции, который может возвращать `200 OK` код состояния HTTP и `failed` состояние операции в теле отклика, как показано в следующем примере.

```http
HTTP/1.1 200 OK
Content-type: application/json

{
  "status": "failed",
  "error": <Error object>
}
```

Для обоих этих сообщений об ошибках объект Error имеет следующую структуру.

>**Примечание:** Ответы об ошибках, которые соответствуют определению в спецификации [OData версии 4](https://docs.oasis-open.org/odata/odata-json-format/v4.0/os/odata-json-format-v4.0-os.html#_Toc372793091) для ответов об ошибках.

```json
{
  "code": "string",
  "message": "string",
  "innerError": { "@odata.type": "odata.error" }
}
```

Объект `innerError` может рекурсивно содержать дополнительные объекты `innerError` с другими, более подробными кодами ошибок. Например, объект Error может содержать более подробные сведения об ошибке в коде и сообщении об ошибке второго уровня, как показано ниже.

```json
{
  "code": "Top-level error code",
  "message": "Top-level error message",
  "innerError": {
    "code": "Second-level error code",
    "message": "Second-level error message",
    "innerError": { "@odata.type": "odata.error" }
  }
}
```

## <a name="steps-to-handle-error-responses"></a>Действия для обработки откликов об ошибках

Клиенты Microsoft Graph могут использовать следующие действия для обработки ошибок, возникающих в API Excel.

### <a name="1-determine-whether-it-is-a-long-running-operation-error"></a>1. Определите, является ли ошибка длительной операции

Перед обработкой ошибки первым делом необходимо определить, является ли ответ на сообщение об ошибке шаблоном длительной операции или обычным шаблоном. При длительной операции с операцией будет возвращен `200 OK` код состояния HTTP и `failed` состояние операции в тексте отклика. Регулярный ответ об ошибке вернет соответствующий код состояния ошибки HTTP. 

### <a name="2-parse-second-level-error-code"></a>2. синтаксический анализ кода ошибки второго уровня

Как для долгосрочной операции, так и для обычного шаблона рекомендуется сначала выполнить инструкции для ошибок второго уровня. Код ошибки не зависит от регистра. В следующей таблице приведены инструкции по некоторым ошибкам. В любой момент служба может добавить новые коды ошибок.

| Код                               | Инструкции
|:-----------------------------------|:---------------------------------------------
| **акцессконфликт**   | Неудачный запрос конфликтует с другими клиентами, обращающимися к книге (например, другой клиент заблокировал книгу для изменения). Клиент Microsoft Graph не ожидается повторно отправлять невыполненный запрос до устранения конфликта. Конечный пользователь, xN, нажмите, чтобы вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **accessDenied**   | Невозможно выполнить запрошенную операцию (например, выполнить изменения в заблокированных ячейках). Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **бадрекуестункатегоризед**    | В неудачном запросе обнаружена неопределенная ошибка. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **конфликтункатегоризед**                   | Неудачный запрос конфликтует с определенным состоянием сервера. Клиент Microsoft Graph не ожидается повторно отправлять невыполненный запрос до устранения конфликта. Конечный пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **филтередранжеконфликт**                   | Не удалось выполнить операцию, так как она конфликтует с отфильтрованным диапазоном. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **форбидденункатегоризед**                    | Неудачный запрос не разрешен. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса. Конечный пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения об ограничениях.
| **гатевайтимеаутункатегоризед**         | Служба не смогла выполнить запрос в течение отведенного времени.
| **generalException**         | При обработке запроса возникла внутренняя ошибка. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **инсертделетеконфликт**         | Операция вставки или удаления привела к конфликту. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **интерналсервереррорункатегоризед**       | Произошла неуказанная ошибка. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса. Если сеанс указан в неудачном запросе, дальнейший доступ к сеансу не ожидается.
| **invalidArgument**         | Аргумент недопустим, отсутствует или имеет неправильный формат. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **инвалидреференце**         | Эта ссылка недопустима для текущей операции. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **инвалидсессионакцессконфликт**             | Сеанс, указанный в запросе, является недопустимым из-за конфликтов с другими клиентами, обращающимися к книге (например, другой клиент заблокировал книгу для изменения). Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с одним и тем же запросом **креатесессион** не ожидается, пока не будет устранен конфликт. Повторное создание сеансов с другим запросом **креатесессион** может завершиться неудачно. Конечный пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **инвалидсессионаусентикатион**         | Сеанс, указанный в запросе, является недопустимым из-за ошибки проверки подлинности. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с одним и тем же запросом **креатесессион** не ожидается, пока не будут предоставлены соответствующие сведения о проверке подлинности.
| **инвалидсессионнотфаунд**         | Сеанс, указанный в запросе, является недопустимым, так как не удается найти книгу. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с одним и тем же запросом **креатесессион** не ожидается.
| **инвалидсессионрекреатабле**             | Сеанс, указанный в запросе, не существует или является недопустимым из-за временной ошибки. Клиент Microsoft Graph может попытаться повторно создать сеанс и возобновить работу. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается.
| **инвалидсессионрестриктед**          | Сеанс, указанный в запросе, является недопустимым из-за конфигураций или ограничений службы. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с одним и тем же запросом **креатесессион** не ожидается до тех пор, пока ограничения или конфигурации не заблокировали изменения запроса. Повторное создание сеансов с другим запросом **креатесессион** может завершиться неудачно. Конечный пользователь может вручную выполнять те же операции с Excel Online, чтобы получить дополнительные сведения об ограничениях.
| **инвалидсессионунекспектед**                | Сеанс, указанный в запросе, является недопустимым из-за непредвиденной ошибки. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с одним и тем же запросом **креатесессион** не ожидается. Повторное создание сеансов с другим запросом **креатесессион** может завершиться неудачно.
| **инвалидсессионунсуппортедворкбук**              | Сеанс, указанный в запросе, является недопустимым, так как книга содержит неподдерживаемые функции или превышает предельный размер. Обычно неподдерживаемые факторы представлены другим клиентом, обращающимся к книге. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с одним и тем же запросом **креатесессион** не ожидается, пока не будут удалены неподдерживаемые факторы. Повторное создание сеансов с другим запросом Креатесессион может завершиться неудачно. Конечный пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о неподдерживаемых факторах, или на рабочем столе Excel, где эта книга может поддерживаться.
| **итемалреадексистс**         | Создаваемый ресурс уже существует. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **itemNotFound**         | Запрашиваемый ресурс не существует. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **месодноталловед**         | Метод HTTP, указанный в запросе, не разрешен для ресурса. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **месодноталловедункатегоризед**              | Метод HTTP, указанный в запросе, не разрешен для ресурса. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **нонбланкцеллоффшит**         | Не удается вставить новые ячейки, так как это приведет к поставке непустых ячеек за пределами листа. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **нотфаундункатегоризед**             | Не удается найти запрошенный ресурс. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **нотимплементедункатегоризед**            | Запрошенная функция в настоящее время не реализована. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **пайлоадтуларжеункатегоризед**              | Полезные данные запроса превышает предельный размер. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **ранжеексцеедслимит**         | Число ячеек в диапазоне превысило максимальное поддерживаемое число. Клиент Microsoft Graph может попытаться отправить запрос с меньшим размером диапазона.
| **рекуестабортед**         | Запрос был прерван во время выполнения, который обычно был вызван длительным расчетом времени из функций в книге. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **сервицеунаваилаблеункатегоризед**      | Служба временно недоступна или перегружена. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса до тех пор, пока не будет пройдена Указанная длительность кулдовн.
| **туманирекуестсункатегоризед**             | Неудачный запрос превышает определенную частоту. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса до тех пор, пока не будет пройдена Указанная длительность кулдовн.
| **трансиентфаилуре**           | Не удалось выполнить запрос из-за временной ошибки. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса до тех пор, пока не будет пройдена Указанная длительность кулдовн.
| **унаусоризедункатегоризед**         | Необходимые сведения для проверки подлинности для ресурса отсутствуют или не являются допустимыми. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **унсуппортедоператион**         | Выполняемая операция не поддерживается. Клиент Microsoft Graph не ожидал повторной отправки невыполненного запроса.
| **унсуппортедворкбук**         | Не удалось выполнить запрос. Книга содержит неподдерживаемые функции или превышает предельный размер. Клиент Microsoft Graph не должен повторно отправлять неподдерживаемый запрос, пока не будут удалены неподдерживаемые факторы.

>**Примечание:** Для обычного шаблона неудачный запрос определяется как запрос, соответствующий ответу. Для долгосрочной операции выполняется запрос, который запускает неудачную операцию.

### <a name="3-parse-the-top-level-error-code"></a>3. Проанализируйте код ошибки верхнего уровня.

Если вы не можете найти код ошибки второго уровня, указанный в разделе [Detailed Codes Errors](workbook-error-codes.md#detailed-error-code) , рекомендуется выполнить инструкции, приведенные для ошибок верхнего уровня. Коды ошибок верхнего уровня привязаны к коду состояния, и вы можете выполнить действия в соответствии с соответствующими кодами состояния. Подробные сведения о кодах ошибок и сообщениях об ошибках верхнего уровня приведены в статье [коды ошибок](workbook-error-codes.md#error-code).

### <a name="4-parse-the-status-code"></a>4. анализ кода состояния

Если код ошибки отсутствует в списке второго уровня или списке верхнего уровня, рекомендуется выполнить действия в соответствии с кодом состояния HTTP.

### <a name="5-error-recovery-cooldown"></a>5. кулдовн восстановления с ошибками

Для некоторых ответов в стандартном шаблоне продолжительность восстановления кулдовн в секундах может быть предоставлена через `Retry-After` заголовок. При наличии длительности восстановления кулдовн клиент Microsoft Graph не ожидает, что запросы на появление запросов не будут отправляться в течение указанного периода.

## <a name="special-case-handling"></a>Особая обработка обращений

Для [запросов с сеансом](excel-manage-sessions.md#request-types)рекомендуется повторно создать сеанс при возникновении `503/serviceUnavailable` `502/badGateway` ошибки или ошибки.
<!-- {
  "type": "#page.annotation",
  "description": "Error handling in Excel Graph.",
  "keywords": "error response, error object, error codes, innerError, error handling",
  "section": "documentation",
  "tocPath": ""
} -->
