---
title: Управление сеансами и хранением данных в Excel с помощью Microsoft Graph
description: Если приложению нужно вызывать API Excel более одного или двух раз, необходимо создать сеанс и передавать его ИД с каждым запросом. Наличие ИД сеанса в запросах гарантирует максимально эффективное использование API Excel.
localization_priority: Normal
author: lumine2008
ms.prod: excel
ms.openlocfilehash: 488637f53ffc1298420d40e93f3f5d9fd7a0b518
ms.sourcegitcommit: 3fbc2249b307e8d3a9de18f22ef6911094ca272c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/26/2020
ms.locfileid: "48289227"
---
# <a name="manage-sessions-and-persistence-in-excel-with-microsoft-graph"></a>Управление сеансами и хранением данных в Excel с помощью Microsoft Graph

Если приложению нужно вызывать API Excel более одного или двух раз, необходимо создать сеанс и передавать его ИД с каждым запросом. Наличие ИД сеанса в запросах гарантирует максимально эффективное использование API Excel.

API Excel вызываются в одном из трех режимов:

1. **Сохраняемый сеанс** — все изменения, внесенные в книгу, сохраняются в ней. Это наиболее эффективный и производительный способ использования API Excel.
2. **Временный сеанс** — изменения, внесенные интерфейсом API, не сохраняются в исходном расположении. Вместо этого внутренний сервер Excel сохраняет временную копию файла, в которой отражены изменения, внесенные во время конкретного сеанса API. Когда истечет срок действия сеанса Excel, изменения будут потеряны. Этот режим удобен для приложений, которым нужно выполнять анализ или получать результаты вычислений или изображение диаграммы, не меняя состояние документа.
3. **Без сеансов** — в вызовах API не передается ИД сеанса. Серверам Excel необходимо находить собственную копию книги для каждой операции. Этот способ вызова API Excel неэффективен, но подходит для отправки некоторых изолированных запросов.

Чтобы представить сеанс в API, используйте заголовок `workbook-session-id: {session-id}`.

>**Примечание.** Заголовок сеанса не является обязательным для работы API Excel. Тем не менее мы рекомендуем использовать заголовок сеанса для повышения производительности. Если вы не используете заголовок сеанса, изменения, внесенные во время вызова API _сохраняются_ в файл.  

## <a name="request-types"></a>Типы запросов
Рекомендуемая [Обработка ошибок](workbook-error-handling.md) для API Excel основана на типе запроса, коде ошибки и коде состояния. Ниже приведены типы запросов.

- **Креатесессион Request** — используется для создания постоянного или непостоянного сеанса. В ответе на Успешный ответ идентификатор сеанса возвращается в свойстве **ID** в тексте отклика. Подробнее: [CREATE SESSION](/graph/api/workbook-createsession?view=graph-rest-1.0).
- Запросы, выполняемые при **запросе с запросом** , которые следуют за запросом креатесессион. Обычно они содержат `workbook-session-id: {session-id}` заголовок. Исключением является запрос состояния опроса, который использует долгосрочный шаблон операции. Дополнительные сведения см. в статье [Работа с API, для выполнения которых требуется длительное время](./workbook-best-practice.md#working-with-apis-that-take-a-long-time-to-complete).
- **Запрос с Несеансом** используется в режиме, не поддерживающем сеансы. В этих запросах нет `workbook-session-id: {session-id}` заголовка.  

## <a name="next-steps"></a>Дальнейшие действия
Сведения о том, как создавать и использовать сеансы, см. в [справочной статье о создании сеанса](/graph/api/workbook-createsession?view=graph-rest-1.0).

## <a name="see-also"></a>См. также
* [Запись в книгу Excel с помощью Microsoft Graph](excel-write-to-workbook.md)
* [Использование функций книг в Excel с помощью Microsoft Graph](excel-use-functions.md)
* [Обновление формата диапазона в Excel с помощью Microsoft Graph](excel-update-range-format.md)
* [Показ изображения диаграммы в Excel с помощью Microsoft Graph](excel-display-chart-image.md)
* [Использование REST API для Excel](/graph/api/resources/excel?view=graph-rest-1.0)