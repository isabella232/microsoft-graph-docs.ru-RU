---
title: Управление сеансами и хранением данных в Excel с помощью Microsoft Graph
description: Если приложению нужно вызывать API Excel более одного или двух раз, необходимо создать сеанс и передавать его ИД с каждым запросом. Наличие ИД сеанса в запросах гарантирует максимально эффективное использование API Excel.
localization_priority: Normal
author: lumine2008
ms.prod: excel
ms.openlocfilehash: c3dda46a41c5c300642fb00bb1e96847bc9ebc92
ms.sourcegitcommit: 4a37678913c98f62b8174de6ca03908b9af864bd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2020
ms.locfileid: "47296549"
---
# <a name="manage-sessions-and-persistence-in-excel-with-microsoft-graph"></a><span data-ttu-id="ebf8c-104">Управление сеансами и хранением данных в Excel с помощью Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="ebf8c-104">Manage sessions and persistence in Excel with Microsoft Graph</span></span>

<span data-ttu-id="ebf8c-105">Если приложению нужно вызывать API Excel более одного или двух раз, необходимо создать сеанс и передавать его ИД с каждым запросом.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-105">If your application needs to make more than one or two calls to the Excel API, you should create a session and pass the session Id with each request.</span></span> <span data-ttu-id="ebf8c-106">Наличие ИД сеанса в запросах гарантирует максимально эффективное использование API Excel.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-106">The presence of a session Id in the requests ensures that you are using the Excel API in the most efficient way possible.</span></span>

<span data-ttu-id="ebf8c-107">API Excel вызываются в одном из трех режимов:</span><span class="sxs-lookup"><span data-stu-id="ebf8c-107">Excel APIs are called in one of three modes:</span></span>

1. <span data-ttu-id="ebf8c-108">**Сохраняемый сеанс** — все изменения, внесенные в книгу, сохраняются в ней.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-108">**Persistent session**  All changes made to the workbook are persisted (saved) to the workbook.</span></span> <span data-ttu-id="ebf8c-109">Это наиболее эффективный и производительный способ использования API Excel.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-109">This is the most efficient and best-performing way to use the Excel API.</span></span>
2. <span data-ttu-id="ebf8c-110">**Временный сеанс** — изменения, внесенные интерфейсом API, не сохраняются в исходном расположении.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-110">**Non-persistent session**  Changes made by the API are not saved to the source location.</span></span> <span data-ttu-id="ebf8c-111">Вместо этого внутренний сервер Excel сохраняет временную копию файла, в которой отражены изменения, внесенные во время конкретного сеанса API.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-111">Instead, the Excel backend server keeps a temporary copy of the file that reflects the changes made during that particular API session.</span></span> <span data-ttu-id="ebf8c-112">Когда истечет срок действия сеанса Excel, изменения будут потеряны.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-112">When the Excel session expires, the changes are lost.</span></span> <span data-ttu-id="ebf8c-113">Этот режим удобен для приложений, которым нужно выполнять анализ или получать результаты вычислений или изображение диаграммы, не меняя состояние документа.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-113">This mode is useful for apps that need to do analysis or obtain the results of a calculation or a chart image, but do not need to affect the document state.</span></span>
3. <span data-ttu-id="ebf8c-114">**Без сеансов** — в вызовах API не передается ИД сеанса. Серверам Excel необходимо находить собственную копию книги для каждой операции.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-114">**Sessionless**  The API calls do not pass a session Id. The Excel servers have to locate the server's copy of the workbook for each operation.</span></span> <span data-ttu-id="ebf8c-115">Этот способ вызова API Excel неэффективен, но подходит для отправки некоторых изолированных запросов.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-115">This is not an efficient way to call the Excel API, but it is suitable for making certain types of isolated requests.</span></span>

<span data-ttu-id="ebf8c-116">Чтобы представить сеанс в API, используйте заголовок `workbook-session-id: {session-id}`.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-116">To represent the session in the API, use the `workbook-session-id: {session-id}` header.</span></span>

><span data-ttu-id="ebf8c-p106">**Примечание.** Заголовок сеанса не является обязательным для работы API Excel. Тем не менее мы рекомендуем использовать заголовок сеанса для повышения производительности. Если вы не используете заголовок сеанса, изменения, внесенные во время вызова API _сохраняются_ в файл.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-p106">**Note:** The session header is not required for an Excel API to work. However, we recommend that you use the session header to improve performance. If you don't use a session header, changes made during the API call _are_ persisted to the file.</span></span>  

## <a name="request-types"></a><span data-ttu-id="ebf8c-120">Типы запросов</span><span class="sxs-lookup"><span data-stu-id="ebf8c-120">Request types</span></span>
<span data-ttu-id="ebf8c-121">Рекомендуемая [Обработка ошибок](workbook-error-handling.md) для API Excel основана на типе запроса, коде ошибки и коде состояния.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-121">Suggested [error handling](workbook-error-handling.md) for Excel APIs is based on request type, error code, and status code.</span></span> <span data-ttu-id="ebf8c-122">Ниже приведены типы запросов.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-122">The following are the request types:</span></span>

- <span data-ttu-id="ebf8c-123">**Креатесессион Request** — используется для создания постоянного или непостоянного сеанса.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-123">**CreateSession request** - Used to create either a persistent or a non-persistent session.</span></span> <span data-ttu-id="ebf8c-124">В ответе на Успешный ответ идентификатор сеанса возвращается в свойстве **ID** в тексте отклика.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-124">In a successful response, the session ID will be returned in the **id** property in the response body.</span></span> <span data-ttu-id="ebf8c-125">Подробнее: [CREATE SESSION](/graph/api/workbook-createsession?view=graph-rest-1.0).</span><span class="sxs-lookup"><span data-stu-id="ebf8c-125">For details, see [Create session](/graph/api/workbook-createsession?view=graph-rest-1.0).</span></span>
- <span data-ttu-id="ebf8c-126">Запросы, выполняемые при **запросе с запросом** , которые следуют за запросом креатесессион.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-126">**Sessionful request** - Subsequent requests that follow a CreateSession request.</span></span> <span data-ttu-id="ebf8c-127">Обычно они содержат `workbook-session-id: {session-id}` заголовок.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-127">They usually include a `workbook-session-id: {session-id}` header.</span></span> <span data-ttu-id="ebf8c-128">Исключением является запрос состояния опроса, который использует долгосрочный шаблон операции.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-128">The exception is a poll status request, which uses the long-running operation pattern.</span></span> <span data-ttu-id="ebf8c-129">Дополнительные сведения см. в статье [Работа с API, для выполнения которых требуется длительное время](/graph/workbook-best-practice#working-with-apis-that-take-a-long-time-to-complete).</span><span class="sxs-lookup"><span data-stu-id="ebf8c-129">For details, see [working with APIs that take a long time to complete](/graph/workbook-best-practice#working-with-apis-that-take-a-long-time-to-complete).</span></span>
- <span data-ttu-id="ebf8c-130">**Запрос с Несеансом** используется в режиме, не поддерживающем сеансы.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-130">**Sessionless request** - Used in Sessionless mode.</span></span> <span data-ttu-id="ebf8c-131">В этих запросах нет `workbook-session-id: {session-id}` заголовка.</span><span class="sxs-lookup"><span data-stu-id="ebf8c-131">These requests don't have a `workbook-session-id: {session-id}` header.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="ebf8c-132">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ebf8c-132">Next steps</span></span>
<span data-ttu-id="ebf8c-133">Сведения о том, как создавать и использовать сеансы, см. в [справочной статье о создании сеанса](/graph/api/workbook-createsession?view=graph-rest-1.0).</span><span class="sxs-lookup"><span data-stu-id="ebf8c-133">To learn how to create and use sessions, see the [Create session reference topic](/graph/api/workbook-createsession?view=graph-rest-1.0).</span></span>

## <a name="see-also"></a><span data-ttu-id="ebf8c-134">См. также</span><span class="sxs-lookup"><span data-stu-id="ebf8c-134">See also</span></span>
* [<span data-ttu-id="ebf8c-135">Запись в книгу Excel с помощью Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="ebf8c-135">Write to an Excel workbook using Microsoft Graph</span></span>](excel-write-to-workbook.md)
* [<span data-ttu-id="ebf8c-136">Использование функций книг в Excel с помощью Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="ebf8c-136">Use workbook functions in Excel with Microsoft Graph</span></span>](excel-use-functions.md)
* [<span data-ttu-id="ebf8c-137">Обновление формата диапазона в Excel с помощью Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="ebf8c-137">Update a range’s format in Excel with Microsoft Graph</span></span>](excel-update-range-format.md)
* [<span data-ttu-id="ebf8c-138">Показ изображения диаграммы в Excel с помощью Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="ebf8c-138">Display a chart image in Excel with Microsoft Graph</span></span>](excel-display-chart-image.md)
* [<span data-ttu-id="ebf8c-139">Использование REST API для Excel</span><span class="sxs-lookup"><span data-stu-id="ebf8c-139">Use the Excel REST API</span></span>](/graph/api/resources/excel?view=graph-rest-1.0)
