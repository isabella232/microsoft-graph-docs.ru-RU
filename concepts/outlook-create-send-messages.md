---
title: Создание и отправка сообщений Outlook
description: В Microsoft Graph электронные письма представлены ресурсом message.
ms.openlocfilehash: 49670df0d5d735e412a0fd97e3404fab044f6f50
ms.sourcegitcommit: 334e84b4aed63162bcc31831cffd6d363dafee02
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/29/2018
ms.locfileid: "27092678"
---
# <a name="create-and-send-outlook-messages"></a>Создание и отправка сообщений Outlook

В Microsoft Graph электронные письма представлены ресурсом [message](/graph/api/resources/message?view=graph-rest-1.0).

По умолчанию сообщения можно идентифицировать по уникальному идентификатору записи в свойстве **id**. При первом сохранении сообщения в качестве черновика или отправленного сообщения поставщик услуг хранилища назначает идентификатор записи этому сообщению. Этот идентификатор изменяется при копировании сообщения или его перемещении в другую папку, хранилище или PST-файл.

## <a name="creating-and-sending-mail"></a>Создание и отправка почты

В Outlook вы можете создавать и отправлять электронные письма в одном и том же действии [sendMail](/graph/api/user-sendmail?view=graph-rest-1.0). Вы также можете [создать](/graph/api/user-post-messages?view=graph-rest-1.0) черновик, затем [добавить содержимое](/graph/api/message-update?view=graph-rest-1.0) и [отправить](/graph/api/message-send?view=graph-rest-1.0) черновик.

Аналогично, при ответе на электронное письмо вы можете создавать и отправлять ответы в одном и том же действии ([ответить](/graph/api/message-reply?view=graph-rest-1.0), [ответить всем](/graph/api/message-replyall?view=graph-rest-1.0) или [переслать](/graph/api/message-forward?view=graph-rest-1.0)). Кроме того, вы можете создать черновик для ответа ([ответить](/graph/api/message-createreply?view=graph-rest-1.0), [ответить всем](/graph/api/message-createreplyall?view=graph-rest-1.0) или [переслать](/graph/api/message-createforward?view=graph-rest-1.0)), [добавить содержимое](/graph/api/message-update?view=graph-rest-1.0), а затем [отправить ](/graph/api/message-send?view=graph-rest-1.0) черновик позже.

Чтобы программным способом отличать черновики от отправленных писем, проверяйте свойство **isDraft**.

По умолчанию черновики сообщений сохраняются в папке `Drafts`, а отправленные сообщения — в папке `Sent Items`. Для удобства вы можете определить папки "Черновики" и "Отправленные", используя их [соответствующие хорошо известные имена папок](/graph/api/resources/mailfolder?view=graph-rest-1.0). Например, вы можете выполнить указанные ниже действия, чтобы [получить сообщения](/graph/api/user-list-messages?view=graph-rest-1.0) в папке "Черновики".

```http
GET /me/mailfolders('Drafts')
```

### <a name="body-format-and-malicious-script"></a>Формат текста и вредоносный скрипт

<!-- Remove the following 2 sections from the message.md topics
-->

Сообщение может иметь либо формат HTML, либо текстовый формат. По умолчанию в отклике GET текст сообщения возвращается в формате HTML.

При [получении сообщения](/graph/api/message-get?view=graph-rest-1.0) вы можете задать указанный ниже заголовок запроса, чтобы система возвратила свойства **body** и **uniqueBody** в текстовом формате.

```http
Prefer: outlook.body-content-type="text"
```

Чтобы получить текст сообщения в формате HTML, задайте указанный ниже заголовок или просто пропустите его.

```http
Prefer: outlook.body-content-type="html"
```

Когда вы указываете какой-либо заголовок, успешный отклик будет включать соответствующий заголовок `Preference-Applied`.

- Чтобы получить результат выполнения запроса в текстовом формате: `Preference-Applied: outlook.body-content-type="text"`
- Чтобы получить результат выполнения запроса в формате HTML: `Preference-Applied: outlook.body-content-type="html"`

Если текст сообщения имеет формат HTML, то по умолчанию прежде чем возвратить текст сообщения в отклике REST, Outlook удаляет весь потенциально небезопасный HTML-код (например, код JavaScript), внедренный в свойство **body**.

Чтобы получить все исходное содержимое в формате HTML, добавьте следующий заголовок HTTP-запроса:

```http
Prefer: outlook.allow-unsafe-html
```

### <a name="differentiating-the-from-and-sender-properties"></a>Различия между свойствами from и sender

В процессе создания сообщения в большинстве случаев Outlook указывает в качестве значения свойств **from** и **sender** одного и того же пользователя, вошедшего в систему. Вы можете изменить эти свойства в указанных ниже ситуациях.

- Свойство **from** можно изменить, если администратор Exchange назначил другим пользователям права **sendAs** для почтового ящика. Для этого администратор может назначить его владельца, выбрав элемент **Разрешения для почтового ящика** на портале Azure, либо использовать Центр администрирования Exchange или командлет Add-ADPermission в Windows PowerShell. Затем программным способом можно задать свойство **from** одному из этих пользователей, обладающих правами **sendAs** для этого почтового ящика.
- Свойство **sender** можно изменить, если владелец почтового ящика предоставил одному или нескольким пользователям права на отправку сообщений из этого почтового ящика. Владелец почтового ящика может делегировать разрешения в Outlook. Когда представитель отправляет сообщение от имени владельца почтового ящика, Outlook присваивает свойству **sender** учетную запись представителя, а в качестве значения свойства **from** остается владелец почтового ящика. Вы можете программным способом задать в качестве значения свойства **sender** пользователя, получившего разрешения представителя для этого почтового ящика.

## <a name="using-mailtips-to-check-recipient-status-and-save-time-preview"></a>Проверка состояния получателя и экономия времени с помощью подсказок (ознакомительная версия)

С помощью [подсказок](/graph/api/resources/mailtips?view=graph-rest-beta) вы можете принимать обоснованные решения перед отправкой электронных писем.
Благодаря подсказкам можно получить ряд сведений, например о том, что почтовый ящик получателя доступен только для определенных отправителей, либо о том, что для отправки электронного письма получателю необходимо утверждение.

## <a name="integrating-with--social-gesture-preview"></a>Интеграция с социальными жестами (ознакомительная версия)

@Упоминания — это уведомления для пользователей, о том, что их упомянули в сообщениях. С помощью ресурса [mention](/graph/api/resources/mention?view=graph-rest-beta) приложения могут задавать и получать стандартный социальный жест в Интернете (префикс @) в письмах.
Вы можете выполнить указанные ниже действия.

- Создавать @упоминания при [составлении сообщений](/graph/api/user-post-messages?view=graph-rest-beta#request-2)
- [Получать все сообщения в почтовом ящике пользователя, содержащие @упоминание пользователя](/graph/api/user-list-messages?view=graph-rest-beta#request-2)
- [Получать все @упоминания в сообщении](/graph/api/message-get?view=graph-rest-beta#request-2)

## <a name="other-shared-capabilities"></a>Другие общие возможности

Используйте указанные ниже стандартные возможности, имеющиеся в объектах Microsoft Graph.

- Вы можете подписаться на [уведомления об изменениях](/graph/api/resources/webhooks?view=graph-rest-1.0) сообщений. Вы будете получать их при возникновении изменений одного или нескольких типов, например при создании или изменении сообщений.
- [Вы можете отслеживать эти добавочные изменения сообщений в папке](delta-query-messages.md).
- Вы можете создавать [открытые расширения](extensibility-overview.md#open-extensions) или [расширения схемы](extensibility-overview.md#schema-extensions), чтобы добавлять пользовательские данные в экземпляры сообщений.
- Вы можете создавать [расширенные свойства](/graph/api/resources/extended-properties-overview?view=graph-rest-1.0) в экземплярах сообщений, чтобы хранить пользовательские данные для свойств MAPI Outlook, когда эти свойства еще недоступны в метаданных API Microsoft Graph.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения:

- [Зачем выполнять интеграцию с почтой Outlook?](outlook-mail-concept-overview.md)
- [Использование API почты](/graph/api/resources/mail-api-overview?view=graph-rest-1.0) и [варианты использования](/graph/api/resources/mail-api-overview?view=graph-rest-1.0#common-use-cases) в Microsoft Graph 1.0.
