# <a name="organize-outlook-messages"></a>Упорядочение сообщений Outlook

В Outlook пользователи могут упорядочивать свои сообщения по собственному усмотрению. Можно оставить все сообщения в одной папке "Входящие" или упорядочить их в древовидной структуре вложенных папок в соответствии со своими потребностями. Вы можете легко [фильтровать, искать и сортировать](query_parameters.md) сообщения во всем почтовом ящике пользователя или в определенных папках.

## <a name="accessing-mail-folders"></a>Доступ к почтовым папкам

Программно папки сообщений представляются ресурсом [mailFolder](../api-reference/v1.0/resources/mailfolder.md), а папка "Входящие" является одним из корневых элементов структуры папок.

Каждый объект **mailFolder** указывается по идентификатору папки и содержит записываемое свойство **displayName**. По умолчанию Outlook создает для пользователей еще несколько папок. Вы можете ссылаться на эти стандартные папки по их идентификаторам или известным именам. Список доступных известных имен см. в статье [Тип ресурса mailFolder](../api-reference/v1.0/resources/mailfolder.md).

Зная путь к нестандартной папке, вы можете получить доступ и к ней. Для этого используйте сокращение `/users/{id}/mailfolders`, чтобы перейти на корневой уровень и получить все папки верхнего уровня:

```http
GET https://graph.microsoft.com/v1.0/users/{id}/mailFolders
```

Затем укажите соответствующий идентификатор папки (`{folder_id}`) по мере перехода на каждый уровень дерева папок:

```http
GET https://graph.microsoft.com/v1.0/users/{id}/mailFolders/{folder_id}/childfolders
```

Повторяйте, пока не достигнете нужной папки в дереве.

## <a name="creating-and-organizing-the-folder-tree"></a>Создание и упорядочение дерева папок

Вы можете [создавать почтовые папки, вложенные в папку "Входящие"](../api-reference/v1.0/api/user_post_mailfolders.md), или [дочерние папки других папок](../api-reference/v1.0/api/mailfolder_post_childfolders.md). При создании, [копировании](../api-reference/v1.0/api/mailfolder_copy.md) или [перемещении](../api-reference/v1.0/api/mailfolder_move.md) папки и ее содержимого Outlook обновляет доступные только для чтения свойства **parentFolderId** и **childFolderCount** соответствующих папок. Если содержимое папки копируется или перемещается в другую папку, то по умолчанию также меняются идентификаторы отдельных записей содержимого.

На уровне содержимого свойства **totalItemCount** и **unreadItemCount** сообщают вам общее количество элементов и число непрочитанных элементов в почтовой папке, соответственно.
На уровне дочерних папок вы можете [получить список дочерних папок](../api-reference/v1.0/api/user_list_mailfolders.md) для папки "Входящие" или другой папки.
Свойство **childFolderCount** представляет количество непосредственных дочерних папок.

Помните, что почтовые папки Outlook могут содержать как сообщения, так и другие элементы, например события и контакты. В общем случае папки Outlook могут содержать разнородные элементы.

## <a name="using-rules-to-automate-copying-or-moving-messages"></a>Использование правил для автоматизации копирования или перемещения сообщений

В Outlook пользователи могут настраивать правила для автоматизации определенных действий с входящими сообщениями при соблюдении некоторых предварительно заданных условий. Вы можете [создать правило](../api-reference/v1.0/api/mailfolder_post_messagerules.md) для папки "Входящие" в виде объекта [messageRule](../api-reference/v1.0/resources/messagerule.md), чтобы сообщение копировалось или перемещалось в определенную папку при соблюдении заданных условий.
Условия — это объекты [messageRulePredicate](../api-reference/v1.0/resources/messagerulepredicates.md). Они могут включать тему или текст сообщения, определенные электронные адреса отправителей, отметку о важности и т. д.

## <a name="directing-only-the-messages-you-care-for-to-the-focused-inbox"></a>Отправка только нужных сообщений на сортировку почты

С помощью сортировки почты клиенты могут научить Outlook показывать входящие сообщения от нужных отправителей на вкладке **Отсортированные**, а остальные сообщения — на вкладке **Другие**. Изначально система классификации Outlook упорядочивает сообщения в папке "Входящие" стандартным способом. По мере использования системы вы можете исправлять ее поведение и обучать ее через пользовательский интерфейс или программным путем. Чем больше вы используете сортировку почты, тем лучше система классификации сможет определять, какие входящие сообщения вы хотите видеть на вкладке **Отсортированные**.

Вы можете обновить свойство **inferenceClassification** объекта [message](../api-reference/v1.0/resources/message.md) программным путем, чтобы указать, на какой вкладке должно отображаться сообщение: **Отсортированные** или **Другие**. Это свойство назначается отдельно для каждого сообщения. С другой стороны, если сообщения от определенного отправителя всегда должны отображаться на вкладке **Отсортированные** или **Другие**, то вы можете [задать инструкцию](../api-reference/v1.0/api/inferenceclassification_post_overrides.md) для Outlook. Каждая инструкция представляет собой экземпляр объекта [inferenceClassificationOverride](../api-reference/v1.0/resources/inferenceclassificationoverride.md), в котором указаны имя отправителя и вкладка для всех сообщений от этого отправителя: `focused` или `other`. Инструкции каждого пользователя для сортировки почты хранятся в виде коллекции экземпляров [inferenceClassificationOverride](../api-reference/v1.0/resources/inferenceclassificationoverride.md) в объекте [user](../api-reference/v1.0/resources/user.md).

## <a name="keeping-messages-and-mail-folders-up-to-date-in-apps"></a>Обновление сообщений и почтовых папок в приложениях

Многие приложения должны синхронизироваться и обновлять почтовые данные пользователя в его локальном хранилище. Microsoft Graph позволяет подписаться на уведомления об изменениях данных и запрашивать фактические изменения, как только они происходят.

Уведомления асинхронно доставляются через [веб-перехватчики](../api-reference/v1.0/resources/webhooks.md) при внесении изменений, избавляя приложение от необходимости частых опросов. Вы можете [подписаться на уведомления](../api-reference/v1.0/api/subscription_post_subscriptions.md) о добавлении, обновлении или удалении почтовых данных пользователя. Например, вы можете создать подписку на сообщения в определенной папке (т. е. `/me/mailFolders('{folderId'}')`) или на корневом уровне (т. е. `/me/messages`). В подписке указывается адрес **notificationUrl**, на который Microsoft Graph отправляет приложению уведомления об изменениях указанных типов.

Для первой синхронизации почтового ящика пользователя сначала отправьте [разностный запрос для почтовых папок, начиная с корневого уровня](../api-reference/v1.0/api/mailfolder_delta.md), чтобы синхронизировать все почтовые папки, а затем — [разностный запрос для сообщений в каждой папке](../api-reference/v1.0/api/message_delta.md), чтобы синхронизировать отдельные сообщения.

Чтобы найти именно те объекты, которые были изменены, не считывая ресурс полностью при каждом уведомлении, вы можете использовать [разностный запрос](delta_query_overview.md) для отслеживания интересующих вас изменений и синхронизировать с ними ваше локальное хранилище. Вы можете [отслеживать изменения сообщений в определенной папке](delta_query_messages.md). Вы также можете отслеживать изменения почтовых папок на корневом уровне (т. е. `/me/mailfolders`).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения:

- [Зачем выполнять интеграцию с почтой Outlook?](outlook-mail-concept-overview.md)
- [Использование API почты](../api-reference/v1.0/resources/mail_api_overview.md) и [варианты использования](../api-reference/v1.0/resources/mail_api_overview.md#common-use-cases) в Microsoft Graph 1.0.
